<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>ff26e05ae0884b6587c634f15c8f16bb</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<section id="capstone-project---cv---pneumonia-detection"
class="cell markdown" id="XZtMqmqkRxrs">
<h1>CAPSTONE PROJECT - CV - PNEUMONIA DETECTION</h1>
<h2 id="authors-cv1---group--4">Authors: CV1 - GROUP- 4</h2>
</section>
<section id="domain-health-care" class="cell markdown"
id="AwbZAguxZs_j">
<h1>DOMAIN: Health Care</h1>
<p><strong>• CONTEXT:</strong> Computer vision can be used in health
care for identifying diseases. In Pneumonia detection we need to detect
Inflammation of the lungs. In this challenge, you’re required to build
an algorithm to detect a visual signal for pneumonia in medical images.
Specifically, your algorithm needs to automatically locate lung
opacities on chest radiographs.</p>
<p><strong>• DATA DESCRIPTION:</strong> In the dataset, some of the
features are labeled “Not Normal No Lung Opacity”. This extra third
class indicates that while pneumonia was determined not to be present,
there was nonetheless some type of abnormality on the image and
oftentimes this finding may mimic the appearance of true pneumonia.
Dicom original images: - Medical images are stored in a special format
called DICOM files (*.dcm). They contain a combination of header
metadata as well as underlying raw image arrays for pixel data.</p>
<p>Dataset has been attached along with this project. Please use the
same for this capstone project. Original link to the dataset : <a
href="https://www.kaggle.com/c/rsna-pneumonia-detection-challenge/data"
class="uri">https://www.kaggle.com/c/rsna-pneumonia-detection-challenge/data</a>
[ for your reference only ]. You can refer to the details of the dataset
in the above link</p>
<p>Acknowledgements: <a
href="https://www.kaggle.com/c/rsna-pneumonia-detection-challenge/overview/acknowledgements"
class="uri">https://www.kaggle.com/c/rsna-pneumonia-detection-challenge/overview/acknowledgements</a>.</p>
<p><strong>• PROJECT OBJECTIVE:</strong> Design a DL based algorithm for
detecting pneumonia.</p>
<p><strong>• PROJECT TASK:</strong></p>
<p><strong>Milestone 1:</strong> [ Score: 40 points]</p>
<p>‣ Input: Context and Dataset</p>
<p>‣ Process:</p>
<p>‣ Step 1: Import the data. [ 3 points ]</p>
<p>‣ Step 2: Map training and testing images to its classes. [ 4 points
]</p>
<p>‣ Step 3: Map training and testing images to its annotations. [ 4
points ]</p>
<p>‣ Step 4: Preprocessing and Visualisation of different classes [4
Points]</p>
<p>‣ Step 5: Display images with bounding box. [ 5 points]</p>
<p>‣ Step 6: Design, train and test basic CNN models for classification.
[ 10 points ]</p>
</section>
<div class="cell code" data-execution_count="175"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:31:21.027534Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:31:21.026491Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:31:35.362507Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:31:35.361124Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:31:21.027478Z&quot;}"
id="U3hhoi1rRstG" data-outputId="0e0a2249-1b49-4882-c3af-9aad5d079699"
data-trusted="true">
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pip install pydicom</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Requirement already satisfied: pydicom in /opt/conda/lib/python3.10/site-packages (2.4.1)
Note: you may need to restart the kernel to use updated packages.
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="176"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:31:35.366015Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:31:35.365579Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:31:35.393163Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:31:35.392121Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:31:35.365963Z&quot;}"
id="ilAomRruaM2M" data-trusted="true">
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Import necessary libraries</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> csv</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> itertools</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> PIL</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torchvision</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pydicom</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">&quot;ignore&quot;</span>)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">&quot;axes.grid&quot;</span>] <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> preprocessing</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelBinarizer</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, confusion_matrix, precision_score, recall_score, f1_score, precision_recall_curve, auc,classification_report, roc_curve</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> skimage.transform <span class="im">import</span> resize</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow <span class="im">import</span> keras</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.optimizers <span class="im">import</span> SGD,Adam</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.models <span class="im">import</span> Sequential</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.utils <span class="im">import</span> Sequence</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras <span class="im">import</span> optimizers</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.applications.inception_v3 <span class="im">import</span> InceptionV3</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras <span class="im">import</span> regularizers</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Convolution2D, Activation, SpatialDropout2D</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Dense,Dropout,Flatten,Conv2D, MaxPooling2D, MaxPool2D, GlobalMaxPooling2D, BatchNormalization</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.applications.vgg16 <span class="im">import</span> VGG16</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.applications.vgg16 <span class="im">import</span> preprocess_input</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.applications.resnet50 <span class="im">import</span> ResNet50 </span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.applications.resnet50 <span class="im">import</span> preprocess_input</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras <span class="im">import</span> backend</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras <span class="im">import</span> layers, models</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Conv2D, Activation, BatchNormalization ,Conv2DTranspose</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> UpSampling2D, Input, Concatenate</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.models <span class="im">import</span> Model</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.applications <span class="im">import</span> MobileNet , VGG19</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.callbacks <span class="im">import</span> EarlyStopping, ReduceLROnPlateau</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.metrics <span class="im">import</span> Recall, Precision</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras <span class="im">import</span> backend <span class="im">as</span> K</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.applications.mobilenet <span class="im">import</span> MobileNet</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Concatenate, UpSampling2D, Conv2D, Reshape, GlobalAveragePooling2D</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.preprocessing.image <span class="im">import</span> ImageDataGenerator</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.optimizers <span class="im">import</span> RMSprop</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.utils <span class="im">import</span> to_categorical</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.utils <span class="im">import</span> to_categorical</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras <span class="im">import</span> regularizers</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.optimizers <span class="im">import</span> SGD</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.wrappers.scikit_learn <span class="im">import</span> KerasClassifier</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras <span class="im">import</span> optimizers</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.utils <span class="im">import</span> np_utils</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> glob <span class="im">import</span> glob</span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> zipfile <span class="im">import</span> ZipFile</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm <span class="im">import</span> tqdm_notebook</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.patches <span class="im">import</span> Rectangle</span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a><span class="co">#from imgaug import augmenters as iaa</span></span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a><span class="co">#from imgaug.augmentables.bbs import BoundingBox, BoundingBoxesOnImage</span></span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy <span class="im">import</span> asarray</span></code></pre></div>
</div>
<div class="cell markdown" id="HqM47gIHgdxf">
##Step 1: Import the data.
##Step 2: Map training and testing images to its classes.
<p>##Step 3: Map training and testing images to its annotations.</p>
</div>
<div class="cell code" data-execution_count="177"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:33:27.875595Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:33:27.875142Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:33:27.880311Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:33:27.879121Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:33:27.875559Z&quot;}"
id="UMaA5lwXZ346" data-outputId="4db96f12-1c2e-4a4f-d4e6-b5de5092d521"
data-trusted="true">
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#from google.colab import drive  #Google drive mount</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#drive.mount(&#39;/content/drive&#39;)</span></span></code></pre></div>
</div>
<div class="cell code" data-execution_count="178"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:33:28.641771Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:33:28.641352Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:33:28.753943Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:33:28.752856Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:33:28.641737Z&quot;}"
id="3CMrEthCZ57R" data-trusted="true">
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>classInfo <span class="op">=</span> pd.read_csv(<span class="st">&#39;/kaggle/input/pneumonia-detection/stage_2_detailed_class_info.csv&#39;</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>trainlabels <span class="op">=</span> pd.read_csv(<span class="st">&#39;/kaggle/input/pneumonia-detection/stage_2_train_labels.csv&#39;</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>trainImagesPath <span class="op">=</span> <span class="st">&quot;/kaggle/input/pneumonia-detection/stage_2_train_images/stage_2_train_images&quot;</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>testImagesPath <span class="op">=</span> <span class="st">&quot;/kaggle/input/pneumonia-detection/stage_2_test_images/stage_2_test_images&quot;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>sampleSubPath <span class="op">=</span> Path(<span class="st">&#39;/kaggle/input/pneumonia-detection/stage_2_sample_submission.csv&#39;</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="179"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:33:29.300999Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:33:29.300614Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:33:29.306536Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:33:29.305101Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:33:29.300966Z&quot;}"
id="O6dNT9hJZ-ih" data-trusted="true">
<div class="sourceCode" id="cb6"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Unzip the train images file</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Excluding this code as unzipping is done already</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#with ZipFile(trainImagesPath,&#39;r&#39;) as zipfile:</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#zipfile.extractall(&quot;/content/drive/My Drive/Colab Notebooks/My Python Projects/CAPSTONE PROJECT/Train images/&quot;)</span></span></code></pre></div>
</div>
<div class="cell code" data-execution_count="180"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:33:29.795123Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:33:29.794675Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:33:29.800367Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:33:29.798999Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:33:29.795085Z&quot;}"
id="9iWDDs0MalvF" data-trusted="true">
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Unzip the test images file</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Excluding this code as unzipping is done already</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#with ZipFile(testImagesPath,&#39;r&#39;) as zip1:</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#zip1.extractall(&quot;/content/drive/My Drive/Colab Notebooks/My Python Projects/CAPSTONE PROJECT/&quot;)</span></span></code></pre></div>
</div>
<div class="cell code" data-execution_count="181"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:206}"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:33:30.350623Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:33:30.350009Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:33:30.363255Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:33:30.362129Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:33:30.350587Z&quot;}"
id="JhF9kcNgavjU" data-outputId="511b8f99-d972-4513-a9e2-9b122b7e81ee"
data-trusted="true">
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>classInfo.head() <span class="co"># Top 5 records of class category</span></span></code></pre></div>
<div class="output execute_result" data-execution_count="181">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>patientId</th>
      <th>class</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0004cfab-14fd-4e49-80ba-63a80b6bddd6</td>
      <td>No Lung Opacity / Not Normal</td>
    </tr>
    <tr>
      <th>1</th>
      <td>00313ee0-9eaa-42f4-b0ab-c148ed3241cd</td>
      <td>No Lung Opacity / Not Normal</td>
    </tr>
    <tr>
      <th>2</th>
      <td>00322d4d-1c29-4943-afc9-b6754be640eb</td>
      <td>No Lung Opacity / Not Normal</td>
    </tr>
    <tr>
      <th>3</th>
      <td>003d8fa0-6bf1-40ed-b54c-ac657f8495c5</td>
      <td>Normal</td>
    </tr>
    <tr>
      <th>4</th>
      <td>00436515-870c-4b36-a041-de91049b9ab4</td>
      <td>Lung Opacity</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell code" data-execution_count="182"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:33:34.629916Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:33:34.629032Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:33:34.719859Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:33:34.718927Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:33:34.629869Z&quot;}"
id="rq3VVMkkazeD" data-outputId="2f37c99d-3398-479c-ebdd-232e893bcf64"
data-trusted="true">
<div class="sourceCode" id="cb9"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>classInfo.info() <span class="co"># Identify feature and target information</span></span></code></pre></div>
<div class="output stream stdout">
<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 30227 entries, 0 to 30226
Data columns (total 2 columns):
 #   Column     Non-Null Count  Dtype 
---  ------     --------------  ----- 
 0   patientId  30227 non-null  object
 1   class      30227 non-null  object
dtypes: object(2)
memory usage: 472.4+ KB
</code></pre>
</div>
</div>
<section id="there-are-two-features-1-patient-id-2-class"
class="cell markdown" id="-yb4zkgAfdYH">
<h4>There are two features 1. Patient ID 2. Class</h4>
</section>
<div class="cell code" data-execution_count="183"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:33:35.886992Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:33:35.886153Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:33:35.904872Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:33:35.903880Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:33:35.886950Z&quot;}"
id="okmsAo1Da2Oc" data-outputId="c8d5346b-a6f5-46f4-b912-ef0380edb2a5"
data-trusted="true">
<div class="sourceCode" id="cb11"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the number of unique patient IDs</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>num_unique_patients <span class="op">=</span> classInfo[<span class="st">&#39;patientId&#39;</span>].nunique()</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Number of unique patient IDs: </span><span class="sc">{</span>num_unique_patients<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Number of unique patient IDs: 26684
</code></pre>
</div>
</div>
<div class="cell markdown" id="43NcEDqmfp-W">
<h4 id="there-are-26k-unique-patients-info-available">There are 26K
unique patients info available.</h4>
<h4
id="total-numbers-of-records-are-30k--but-unqiue-patien-ids-are-26k-">Total
numbers of records are 30K , but unqiue patien ID's are 26K .</h4>
<h4
id="looks-there-is-some-duplicated-records-for-patient-id-lets-see">Looks
there is some duplicated records for patient Id lets see.</h4>
</div>
<section
id="step-4-preprocessing-and-visualisation-of-different-classes"
class="cell markdown" id="sngYZ2kRhogF">
<h2>Step 4: Preprocessing and Visualisation of different classes</h2>
</section>
<div class="cell code" data-execution_count="184"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:614}"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:33:37.941813Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:33:37.941096Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:33:38.270301Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:33:38.269302Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:33:37.941759Z&quot;}"
id="IGK3vc75fmph" data-outputId="fe10a34e-6d21-4677-8a03-dfc834bb36fd"
data-trusted="true">
<div class="sourceCode" id="cb13"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>sns.countplot(x<span class="op">=</span><span class="st">&#39;class&#39;</span>,data<span class="op">=</span>classInfo)<span class="op">;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Displaying labels, title, and rotate the x-axis labels for better visualization</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Class&#39;</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Count&#39;</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Distribution of Classes&#39;</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plot</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/bcca2045c29b0f1015649206156a8ecac3f19d7f.png" /></p>
</div>
</div>
<section id="images-from-different-classes" class="cell markdown"
id="KHSXPSz-iCpy">
<h4>Images from different classes</h4>
<p>1.Normal; 2.No Lung Opacity / Not Normal; 3.Lung Opacity</p>
</section>
<div class="cell code" data-execution_count="185"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:33:42.721328Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:33:42.720940Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:33:42.734029Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:33:42.732949Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:33:42.721290Z&quot;}"
id="CSIxEYaKfxqo" data-outputId="2c03fc29-9231-4871-8cd3-70ce484f899b"
data-trusted="true">
<div class="sourceCode" id="cb14"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_feature_distribution(data, feature):</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the count for each label</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    label_counts <span class="op">=</span> data[feature].value_counts()</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get total number of samples</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    total_samples <span class="op">=</span> <span class="bu">len</span>(data)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Count the number of items in each class</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Feature: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(feature))</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(label_counts)):</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>        label <span class="op">=</span> label_counts.index[i]</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>        count <span class="op">=</span> label_counts.values[i]</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>        percent <span class="op">=</span> <span class="bu">int</span>((count <span class="op">/</span> total_samples) <span class="op">*</span> <span class="dv">10000</span>) <span class="op">/</span> <span class="dv">100</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;</span><span class="sc">{:&lt;30s}</span><span class="st">:   </span><span class="sc">{}</span><span class="st"> or </span><span class="sc">{}</span><span class="st">%&quot;</span>.<span class="bu">format</span>(label, count, percent))</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>get_feature_distribution(classInfo, <span class="st">&#39;class&#39;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Feature: class
No Lung Opacity / Not Normal  :   11821 or 39.1%
Lung Opacity                  :   9555 or 31.61%
Normal                        :   8851 or 29.28%
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="186"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:423}"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:33:43.779465Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:33:43.779079Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:33:43.805057Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:33:43.804074Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:33:43.779430Z&quot;}"
id="fH2TaplaijAi" data-outputId="c97b55dd-d4ef-485c-b0af-f3eea15aa63f"
data-trusted="true">
<div class="sourceCode" id="cb16"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>classInfo[classInfo.duplicated()] <span class="co">#Detect duplicate Records</span></span></code></pre></div>
<div class="output execute_result" data-execution_count="186">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>patientId</th>
      <th>class</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>5</th>
      <td>00436515-870c-4b36-a041-de91049b9ab4</td>
      <td>Lung Opacity</td>
    </tr>
    <tr>
      <th>9</th>
      <td>00704310-78a8-4b38-8475-49f4573b2dbb</td>
      <td>Lung Opacity</td>
    </tr>
    <tr>
      <th>15</th>
      <td>00aecb01-a116-45a2-956c-08d2fa55433f</td>
      <td>Lung Opacity</td>
    </tr>
    <tr>
      <th>17</th>
      <td>00c0b293-48e7-4e16-ac76-9269ba535a62</td>
      <td>Lung Opacity</td>
    </tr>
    <tr>
      <th>20</th>
      <td>00f08de1-517e-4652-a04f-d1dc9ee48593</td>
      <td>Lung Opacity</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>30209</th>
      <td>c18d1138-ba74-4af5-af21-bdd4d2c96bb5</td>
      <td>Lung Opacity</td>
    </tr>
    <tr>
      <th>30215</th>
      <td>c1cddf32-b957-4753-acaa-472ab1447e86</td>
      <td>Lung Opacity</td>
    </tr>
    <tr>
      <th>30220</th>
      <td>c1e73a4e-7afe-4ec5-8af6-ce8315d7a2f2</td>
      <td>Lung Opacity</td>
    </tr>
    <tr>
      <th>30222</th>
      <td>c1ec14ff-f6d7-4b38-b0cb-fe07041cbdc8</td>
      <td>Lung Opacity</td>
    </tr>
    <tr>
      <th>30226</th>
      <td>c1f7889a-9ea9-4acb-b64c-b737c929599a</td>
      <td>Lung Opacity</td>
    </tr>
  </tbody>
</table>
<p>3543 rows × 2 columns</p>
</div>
</div>
</div>
<section id="as-suspected-there-are-3543-duplicated-records"
class="cell markdown" id="b18bFCVvi2bi">
<h4>As suspected, there are 3543 duplicated records</h4>
</section>
<div class="cell code" data-execution_count="187"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:33:45.524136Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:33:45.523761Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:33:45.542685Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:33:45.541693Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:33:45.524105Z&quot;}"
id="pl9nm2YGizAA" data-outputId="277598df-7414-4acb-f15f-9dc784d690b9"
data-trusted="true">
<div class="sourceCode" id="cb17"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The expression classInfo.duplicated() returns a boolean mask with True for duplicate rows and False for non-duplicates.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># When this boolean mask is used to index the DataFrame, only the duplicate rows are selected.</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>duplicate_rows <span class="op">=</span> classInfo[classInfo.duplicated()]</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the dimensions (number of rows and columns) of the DataFrame containing duplicate rows</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;shape&#39; attribute of the DataFrame returns a tuple (num_rows, num_columns) representing its dimensions.</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>shape_of_duplicate_rows <span class="op">=</span> duplicate_rows.shape</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(shape_of_duplicate_rows)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>(3543, 2)
</code></pre>
</div>
</div>
<section id="checking-for-missing-values" class="cell markdown"
id="s19tqAs5jen-">
<h4>Checking for Missing Values</h4>
</section>
<div class="cell code" data-execution_count="188"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:33:47.169870Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:33:47.169480Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:33:47.177837Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:33:47.176642Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:33:47.169840Z&quot;}"
id="9CiiEKf3jZCo" data-trusted="true">
<div class="sourceCode" id="cb19"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Defining a function to check for missing values in each column of a DataFrame</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> missing_check(df):</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the total number of missing values in each column and sort in descending order</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> df.isnull().<span class="bu">sum</span>().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the percentage of missing values in each column and sort in descending order</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    percent <span class="op">=</span> (df.isnull().<span class="bu">sum</span>() <span class="op">/</span> df.isnull().count()).sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Combine the &#39;total&#39; and &#39;percent&#39; Series into a new DataFrame named &#39;missing_data&#39;</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    missing_data <span class="op">=</span> pd.concat([total, percent], axis<span class="op">=</span><span class="dv">1</span>, keys<span class="op">=</span>[<span class="st">&#39;Total&#39;</span>, <span class="st">&#39;Percent&#39;</span>])</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the DataFrame containing information about missing values</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> missing_data</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="189"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:33:47.986547Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:33:47.985566Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:33:48.056731Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:33:48.055479Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:33:47.986510Z&quot;}"
id="8COPH-t7jxva" data-outputId="3a1d7aaf-82e8-422c-8d20-6ad0339ce6e4"
data-trusted="true">
<div class="sourceCode" id="cb20"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Call the missing_check function to check for missing values in each column of the DataFrame classInfo</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>missing_data <span class="op">=</span> missing_check(classInfo)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the DataFrame containing information about missing values</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(missing_data)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>           Total  Percent
patientId      0      0.0
class          0      0.0
</code></pre>
</div>
</div>
<section id="no-missing-values-found-in-the-dataset"
class="cell markdown" id="b8GN7itzkFeE">
<h4>No Missing Values found in the dataset</h4>
</section>
<div class="cell code" data-execution_count="190"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:33:49.636533Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:33:49.636099Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:33:49.663354Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:33:49.662110Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:33:49.636496Z&quot;}"
id="tH8urLhUj45J" data-outputId="f36ef3ce-9c2d-446d-b24a-be2b15c1a941"
data-trusted="true">
<div class="sourceCode" id="cb22"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The `info()` method provides a concise summary of the DataFrame&#39;s structure.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># It displays essential information about the DataFrame, including the number of non-null values,</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># data types of each column, and memory usage.</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>trainlabels.info()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 30227 entries, 0 to 30226
Data columns (total 6 columns):
 #   Column     Non-Null Count  Dtype  
---  ------     --------------  -----  
 0   patientId  30227 non-null  object 
 1   x          9555 non-null   float64
 2   y          9555 non-null   float64
 3   width      9555 non-null   float64
 4   height     9555 non-null   float64
 5   Target     30227 non-null  int64  
dtypes: float64(4), int64(1), object(1)
memory usage: 1.4+ MB
</code></pre>
</div>
</div>
<section id="train-labels-also-contains-30k-records-same-as-meta-data"
class="cell markdown" id="QohL-jgLkew5">
<h4>Train labels also contains 30K records same as meta data</h4>
</section>
<div class="cell code" data-execution_count="191"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:33:51.205058Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:33:51.204679Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:33:51.219956Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:33:51.218743Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:33:51.205024Z&quot;}"
id="yXXerN8bkaP_" data-trusted="true">
<div class="sourceCode" id="cb24"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The `trainlabels.patientId` selects the &#39;patientId&#39; column from the DataFrame.</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The `nunique()` method is then called on this column to get the number of unique patient IDs.</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>num_unique_patients <span class="op">=</span> trainlabels.patientId.nunique()</span></code></pre></div>
</div>
<div class="cell markdown" id="9NTC7m66ksmy">
<h4 id="unique-patient-id-count-also-matched-with-class-info-">Unique
patient Id count also matched with class info .</h4>
<h4
id="lets-check-for-same-patient-which-we-verified-the-class-info">Lets
check for same patient which we verified the class Info.</h4>
</div>
<div class="cell code" data-execution_count="192"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:33:52.904044Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:33:52.903630Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:33:52.921245Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:33:52.919860Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:33:52.904008Z&quot;}"
id="95YSuc0VkmWk" data-outputId="23c48266-7236-437d-e92c-d32fd686031f"
data-trusted="true">
<div class="sourceCode" id="cb25"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># It selects rows from the DataFrame where the &#39;patientId&#39; column has the value &#39;c1f7889a-9ea9-4acb-b64c-b737c929599a&#39;.</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>selected_data <span class="op">=</span> trainlabels[trainlabels.patientId <span class="op">==</span> <span class="st">&#39;c1f7889a-9ea9-4acb-b64c-b737c929599a&#39;</span>]</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the option to display all columns in a single line</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">&#39;display.expand_frame_repr&#39;</span>, <span class="va">False</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the DataFrame containing the selected rows</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(selected_data)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>                                  patientId      x      y  width  height  Target
30225  c1f7889a-9ea9-4acb-b64c-b737c929599a  570.0  393.0  261.0   345.0       1
30226  c1f7889a-9ea9-4acb-b64c-b737c929599a  233.0  424.0  201.0   356.0       1
</code></pre>
</div>
</div>
<div class="cell markdown" id="5HMTdM8ZlWj9">
<h4
id="from-the-above-result-it-is-observed-that-2-records-exists-for-same-patient-with-different-dimension">From
the above result, it is observed that 2 Records exists for same patient
with different dimension</h4>
<h4
id="this-may-be-due-to-in-the-x-ray-opacity-has-been-deteched-at-multiple-locations">This
may be due to in the X-ray opacity has been deteched at multiple
locations</h4>
</div>
<div class="cell code" data-execution_count="193"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:33:54.055683Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:33:54.054414Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:33:54.075919Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:33:54.074978Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:33:54.055637Z&quot;}"
id="xntpvqA1lCT8" data-outputId="55ab9d9f-5750-4798-ed1c-9a48ae277533"
data-trusted="true">
<div class="sourceCode" id="cb27"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># It selects rows from the DataFrame where all columns have duplicate values, indicating duplicate rows.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>duplicated_rows <span class="op">=</span> trainlabels[trainlabels.duplicated()]</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the DataFrame containing the duplicate rows</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(duplicated_rows)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Empty DataFrame
Columns: [patientId, x, y, width, height, Target]
Index: []
</code></pre>
</div>
</div>
<section id="no-duplicate-records-fround-from-the-above-result"
class="cell markdown" id="VZ27O_rymH3_">
<h4>No Duplicate Records fround from the above result</h4>
</section>
<div class="cell code" data-execution_count="194"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:472}"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:33:55.531790Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:33:55.531421Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:33:55.800055Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:33:55.799018Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:33:55.531760Z&quot;}"
id="L_uu4BKDmEdL" data-outputId="16415d65-f2a2-4064-db42-8cdc8269a108"
data-trusted="true">
<div class="sourceCode" id="cb29"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>plt.figure()  <span class="co"># Create a new figure to ensure the previous plot doesn&#39;t overlap</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>sns.countplot(x<span class="op">=</span><span class="st">&#39;Target&#39;</span>, data<span class="op">=</span>trainlabels, color<span class="op">=</span><span class="st">&#39;skyblue&#39;</span>,orient<span class="op">=</span><span class="st">&#39;h&#39;</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Distribution of Target Column&#39;</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Target Values&#39;</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Count&#39;</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Display all the countplots</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/b1e549ee51beabac9183c9f0c5b052b4212bd682.png" /></p>
</div>
</div>
<div class="cell markdown" id="XXTqAC7QnE_3">
<h4 id="there-are-2-values-in-target-column-0--1">There are 2 values in
Target column 0 &amp; 1</h4>
<h4 id="in-classinfo-dataframe-we-could-see-3-different-classes">In
classInfo Dataframe, we could see 3 different classes</h4>
<h4
id="lets-proceed-further-to-check-how-target-and-class-columns-are-related">Lets
proceed further to check how Target and Class columns are related.</h4>
</div>
<div class="cell code" data-execution_count="195"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:33:57.013594Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:33:57.013202Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:33:57.055035Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:33:57.053877Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:33:57.013560Z&quot;}"
id="9aM1yaJcm904" data-outputId="6acf069b-d6b9-40ed-b41d-1ed614817805"
data-trusted="true">
<div class="sourceCode" id="cb30"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Call the missing_check function to check for missing values in each column of the DataFrame &#39;trainlabels&#39;</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>missing_data_trainlabels <span class="op">=</span> missing_check(trainlabels)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the DataFrame containing information about missing values</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(missing_data_trainlabels)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>           Total   Percent
x          20672  0.683892
y          20672  0.683892
width      20672  0.683892
height     20672  0.683892
patientId      0  0.000000
Target         0  0.000000
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="196"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:33:57.716473Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:33:57.715232Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:33:57.731862Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:33:57.730765Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:33:57.716396Z&quot;}"
id="kmQuoQb0nqQS" data-outputId="33a95a79-4afd-486d-d152-353cc1d0f655"
data-trusted="true">
<div class="sourceCode" id="cb32"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select rows where the &#39;x&#39; column has missing values (NaN)</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>missing_x_rows <span class="op">=</span> trainlabels[trainlabels.x.isna()]</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the DataFrame containing rows with missing values in the &#39;x&#39; column</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(missing_x_rows)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>                                  patientId   x   y  width  height  Target
0      0004cfab-14fd-4e49-80ba-63a80b6bddd6 NaN NaN    NaN     NaN       0
1      00313ee0-9eaa-42f4-b0ab-c148ed3241cd NaN NaN    NaN     NaN       0
2      00322d4d-1c29-4943-afc9-b6754be640eb NaN NaN    NaN     NaN       0
3      003d8fa0-6bf1-40ed-b54c-ac657f8495c5 NaN NaN    NaN     NaN       0
6      00569f44-917d-4c86-a842-81832af98c30 NaN NaN    NaN     NaN       0
...                                     ...  ..  ..    ...     ...     ...
30216  c1cf3255-d734-4980-bfe0-967902ad7ed9 NaN NaN    NaN     NaN       0
30217  c1e228e4-b7b4-432b-a735-36c48fdb806f NaN NaN    NaN     NaN       0
30218  c1e3eb82-c55a-471f-a57f-fe1a823469da NaN NaN    NaN     NaN       0
30223  c1edf42b-5958-47ff-a1e7-4f23d99583ba NaN NaN    NaN     NaN       0
30224  c1f6b555-2eb1-4231-98f6-50a963976431 NaN NaN    NaN     NaN       0

[20672 rows x 6 columns]
</code></pre>
</div>
</div>
<section
id="some-of-xy-values-found-to-have-missing-for-few-records--this-can-be-due-to-the-fact-that-for-a-normal-patient-these-values-could-be-not-applicable"
class="cell markdown" id="MK9MMk7hoBzw">
<h4>Some of X,Y values found to have missing for few records . This can
be due to the fact that for a normal patient these values could be not
applicable.</h4>
</section>
<div class="cell code" data-execution_count="197"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:33:59.207891Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:33:59.207507Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:33:59.221399Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:33:59.219655Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:33:59.207859Z&quot;}"
id="xyRykeFpn7xF" data-outputId="9eac7ba9-6791-4456-fd4e-670819158a01"
data-trusted="true">
<div class="sourceCode" id="cb34"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Select rows where the &#39;x&#39; column has missing values (NaN)</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The expression &#39;trainlabels.x.isna()&#39; returns a boolean mask with &#39;True&#39; for rows where &#39;x&#39; is NaN and &#39;False&#39; otherwise.</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># This boolean mask is then used as an index to select specific rows from the DataFrame &#39;trainlabels&#39;.</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co"># The result is a new DataFrame containing only the rows where the &#39;x&#39; column has missing values.</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>missing_x_rows <span class="op">=</span> trainlabels[trainlabels.x.isna()]</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Retrieve the unique values in the &#39;Target&#39; column for the selected rows</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;Target&#39; column of the DataFrame &#39;missing_x_rows&#39; is accessed using [&#39;Target&#39;].</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;unique()&#39; method is then called on this column to retrieve the unique values in the &#39;Target&#39; column.</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>unique_target_values <span class="op">=</span> missing_x_rows[<span class="st">&#39;Target&#39;</span>].unique()</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the unique values in the &#39;Target&#39; column for the selected rows</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(unique_target_values)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>[0]
</code></pre>
</div>
</div>
<section
id="from-the-above-output-it-is-confirmed-that-for-normal-patients-dimensions-are-not-available"
class="cell markdown" id="Nk2492ato0sp">
<h4>From the above output, it is confirmed that for normal patients
dimensions are not available.</h4>
</section>
<div class="cell code" data-execution_count="198"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:34:00.661170Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:34:00.660793Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:34:00.695968Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:34:00.694786Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:34:00.661139Z&quot;}"
id="mSP9H5hroxS7" data-outputId="9532d5bb-3fd5-4cb2-8aba-ca2f79cf5203"
data-trusted="true">
<div class="sourceCode" id="cb36"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The code calls the &#39;describe()&#39; method on the DataFrame &#39;trainlabels&#39; to get summary statistics of the numerical columns.</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Display summary statistics of the DataFrame &#39;trainlabels&#39;</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;describe()&#39; method computes various summary statistics for each numerical column in the DataFrame.</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co"># The statistics include count, mean, standard deviation, minimum value, 25th percentile (Q1), median (50th percentile or Q2),</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 75th percentile (Q3), and maximum value.</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co"># The output will show these statistics for each numerical column in &#39;trainlabels&#39;.</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>summary_stats <span class="op">=</span> trainlabels.describe()</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the summary statistics of the DataFrame &#39;trainlabels&#39;</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(summary_stats)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>                 x            y        width       height        Target
count  9555.000000  9555.000000  9555.000000  9555.000000  30227.000000
mean    394.047724   366.839560   218.471376   329.269702      0.316108
std     204.574172   148.940488    59.289475   157.750755      0.464963
min       2.000000     2.000000    40.000000    45.000000      0.000000
25%     207.000000   249.000000   177.000000   203.000000      0.000000
50%     324.000000   365.000000   217.000000   298.000000      0.000000
75%     594.000000   478.500000   259.000000   438.000000      1.000000
max     835.000000   881.000000   528.000000   942.000000      1.000000
</code></pre>
</div>
</div>
<div class="cell markdown" id="82Hd9GjKpbu9">
<p>Looks , 75% of the data represents target value 1. Count plot also
shows the same. Hence,it is an imbalanced data set.</p>
</div>
<div class="cell code" data-execution_count="199"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:471}"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:34:02.065902Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:34:02.065130Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:34:02.696788Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:34:02.695598Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:34:02.065854Z&quot;}"
id="W6mU07JspWG3" data-outputId="1c355b82-908a-4bce-f05d-bcf1dde69fad"
data-trusted="true">
<div class="sourceCode" id="cb38"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a figure with two subplots and increase the figure size</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">24</span>, <span class="dv">7</span>))</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the percentage distribution of &#39;Target&#39; column using a pie chart</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>target_counts <span class="op">=</span> trainlabels[<span class="st">&#39;Target&#39;</span>].value_counts()</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>ax1.pie(target_counts, labels<span class="op">=</span>[<span class="st">&#39;Negative&#39;</span>, <span class="st">&#39;Pneumonia Evidence&#39;</span>], colors<span class="op">=</span>[<span class="st">&#39;lightgray&#39;</span>, <span class="st">&#39;brown&#39;</span>],</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>        autopct<span class="op">=</span><span class="st">&#39;%.0f</span><span class="sc">%%</span><span class="st">&#39;</span>, startangle<span class="op">=</span><span class="dv">90</span>, textprops<span class="op">=</span>{<span class="st">&#39;fontsize&#39;</span>: <span class="dv">12</span>})</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">&#39;Distribution of Target&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the percentage distribution of &#39;class&#39; column using a horizontal bar plot</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>class_counts <span class="op">=</span> classInfo[<span class="st">&#39;class&#39;</span>].value_counts().sort_index(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>ax2.barh(class_counts.index, class_counts, color<span class="op">=</span>[<span class="st">&#39;gainsboro&#39;</span>, <span class="st">&#39;lightgray&#39;</span>, <span class="st">&#39;brown&#39;</span>])</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">&#39;Count&#39;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">&#39;Distribution of Class&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Add data labels to the bar plot</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, v <span class="kw">in</span> <span class="bu">enumerate</span>(class_counts):</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>    ax2.text(v <span class="op">+</span> <span class="dv">10</span>, i, <span class="bu">str</span>(v), fontsize<span class="op">=</span><span class="dv">12</span>, color<span class="op">=</span><span class="st">&#39;black&#39;</span>, va<span class="op">=</span><span class="st">&#39;center&#39;</span>)</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a legend for the pie chart</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>ax1.legend(target_counts.index, loc<span class="op">=</span><span class="st">&#39;best&#39;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the layout for subplots and add an overall title for the figure</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">&#39;Target and Class Distribution&#39;</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>plt.tight_layout(rect<span class="op">=</span>[<span class="dv">0</span>, <span class="fl">0.03</span>, <span class="dv">1</span>, <span class="fl">0.9</span>])  <span class="co"># Adjust the &#39;rect&#39; parameter to control the figure layout</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plots</span></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/af8dbfd27a28a74337a86bbe4d1fa44fe166d458.png" /></p>
</div>
</div>
<section
id="lets-concatenate-classinfo-and-trainlabels--before-concatinating-them-lets-remove-duplicate-records-from-class-info"
class="cell markdown" id="N0mi-w1rrFIX">
<h4>Lets concatenate classInfo and trainlabels . Before concatinating
them lets remove duplicate records from class info</h4>
</section>
<div class="cell code" data-execution_count="200"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:34:03.553600Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:34:03.553216Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:34:03.575900Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:34:03.574995Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:34:03.553567Z&quot;}"
id="UkoCoFPmqMbQ" data-outputId="b2fd07be-c8a5-410b-e7cb-00ab61ef8ef5"
data-trusted="true">
<div class="sourceCode" id="cb39"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop duplicate rows from the DataFrame &#39;classInfo&#39;</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>classInfo.drop_duplicates(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the DataFrame after dropping duplicates</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classInfo)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>                                  patientId                         class
0      0004cfab-14fd-4e49-80ba-63a80b6bddd6  No Lung Opacity / Not Normal
1      00313ee0-9eaa-42f4-b0ab-c148ed3241cd  No Lung Opacity / Not Normal
2      00322d4d-1c29-4943-afc9-b6754be640eb  No Lung Opacity / Not Normal
3      003d8fa0-6bf1-40ed-b54c-ac657f8495c5                        Normal
4      00436515-870c-4b36-a041-de91049b9ab4                  Lung Opacity
...                                     ...                           ...
30219  c1e73a4e-7afe-4ec5-8af6-ce8315d7a2f2                  Lung Opacity
30221  c1ec14ff-f6d7-4b38-b0cb-fe07041cbdc8                  Lung Opacity
30223  c1edf42b-5958-47ff-a1e7-4f23d99583ba                        Normal
30224  c1f6b555-2eb1-4231-98f6-50a963976431                        Normal
30225  c1f7889a-9ea9-4acb-b64c-b737c929599a                  Lung Opacity

[26684 rows x 2 columns]
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="201"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:34:04.376610Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:34:04.375375Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:34:04.423072Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:34:04.421920Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:34:04.376563Z&quot;}"
id="ij4sHW0VrQX6" data-trusted="true">
<div class="sourceCode" id="cb41"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The code performs an inner join (merge) between the &#39;trainlabels&#39; and &#39;classInfo&#39; DataFrames based on the &#39;patientId&#39; column.</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the DataFrames &#39;trainlabels&#39; and &#39;classInfo&#39; based on the common &#39;patientId&#39; column.</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;left_on&#39; parameter specifies the column in the left DataFrame (trainlabels) to use for the merge.</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;right_on&#39; parameter specifies the column in the right DataFrame (classInfo) to use for the merge.</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;how&#39; parameter is set to &#39;inner&#39;, which means only the rows with matching &#39;patientId&#39; values in both DataFrames will be included in the result.</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>traindf <span class="op">=</span> trainlabels.merge(classInfo, left_on<span class="op">=</span><span class="st">&#39;patientId&#39;</span>, right_on<span class="op">=</span><span class="st">&#39;patientId&#39;</span>, how<span class="op">=</span><span class="st">&#39;inner&#39;</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="202"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:206}"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:34:05.203859Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:34:05.203488Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:34:05.220693Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:34:05.219466Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:34:05.203827Z&quot;}"
id="KXBGZ4INry61" data-outputId="14368962-1519-4c31-ad47-05203da8e25e"
data-trusted="true">
<div class="sourceCode" id="cb42"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>traindf.head() <span class="co">#Top 5 rows for traiing dataset</span></span></code></pre></div>
<div class="output execute_result" data-execution_count="202">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>patientId</th>
      <th>x</th>
      <th>y</th>
      <th>width</th>
      <th>height</th>
      <th>Target</th>
      <th>class</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0004cfab-14fd-4e49-80ba-63a80b6bddd6</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>No Lung Opacity / Not Normal</td>
    </tr>
    <tr>
      <th>1</th>
      <td>00313ee0-9eaa-42f4-b0ab-c148ed3241cd</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>No Lung Opacity / Not Normal</td>
    </tr>
    <tr>
      <th>2</th>
      <td>00322d4d-1c29-4943-afc9-b6754be640eb</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>No Lung Opacity / Not Normal</td>
    </tr>
    <tr>
      <th>3</th>
      <td>003d8fa0-6bf1-40ed-b54c-ac657f8495c5</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>Normal</td>
    </tr>
    <tr>
      <th>4</th>
      <td>00436515-870c-4b36-a041-de91049b9ab4</td>
      <td>264.0</td>
      <td>152.0</td>
      <td>213.0</td>
      <td>379.0</td>
      <td>1</td>
      <td>Lung Opacity</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<section
id="lets-check-for-specific-patient-how-data-has-been-concatinated"
class="cell markdown" id="Xtr7FDKRsMPa">
<h4>Lets check for specific patient how data has been concatinated.</h4>
</section>
<div class="cell code" data-execution_count="203"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:34:06.730989Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:34:06.730595Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:34:06.750264Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:34:06.748907Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:34:06.730958Z&quot;}"
id="8lOmB3qNsIKx" data-outputId="6e26dfa0-47a1-43fb-8c6b-0614d7ce2680"
data-trusted="true">
<div class="sourceCode" id="cb43"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The code filters the DataFrame &#39;traindf&#39; to select rows where the &#39;patientId&#39; column has the value &#39;c1f7889a-9ea9-4acb-b64c-b737c929599a&#39;.</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Select rows from the DataFrame &#39;traindf&#39; where the &#39;patientId&#39; column is equal to &#39;c1f7889a-9ea9-4acb-b64c-b737c929599a&#39;.</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>filtered_traindf <span class="op">=</span> traindf[traindf.patientId <span class="op">==</span> <span class="st">&#39;c1f7889a-9ea9-4acb-b64c-b737c929599a&#39;</span>]</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the output to see the DataFrame with filtered rows</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(filtered_traindf)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>                                  patientId      x      y  width  height  Target         class
30225  c1f7889a-9ea9-4acb-b64c-b737c929599a  570.0  393.0  261.0   345.0       1  Lung Opacity
30226  c1f7889a-9ea9-4acb-b64c-b737c929599a  233.0  424.0  201.0   356.0       1  Lung Opacity
</code></pre>
</div>
</div>
<div class="cell markdown" id="lxaDzDIEsmZV">
<h4
id="good-same-patient-has-different-dimension-values-with-same-target-value">Good,
same patient has different dimension values with same target value</h4>
<h4 id="now-lets-see-how-class-and-target-are-related-to-each-other">Now
lets see how class and target are related to each other</h4>
</div>
<div class="cell code" data-execution_count="204"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:34:08.197288Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:34:08.196898Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:34:08.204590Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:34:08.203468Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:34:08.197256Z&quot;}"
id="D7sKb9ZlshCH" data-outputId="7c952040-3dc2-42b9-b036-98c7c319b88d"
data-trusted="true">
<div class="sourceCode" id="cb45"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The code retrieves the unique values from the &#39;Target&#39; column in the DataFrame &#39;traindf&#39;.</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the unique values from the &#39;Target&#39; column in the DataFrame &#39;traindf&#39;.</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>unique_targets <span class="op">=</span> traindf.Target.unique()</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the unique values to see the distinct target values in the &#39;traindf&#39; DataFrame.</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(unique_targets)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>[0 1]
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="205"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:34:08.977954Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:34:08.977582Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:34:08.993801Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:34:08.992819Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:34:08.977924Z&quot;}"
id="wB5_54HitgDU" data-outputId="f080420d-fbcf-4155-8c02-43a727fdac5a"
data-trusted="true">
<div class="sourceCode" id="cb47"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The code groups the DataFrame &#39;traindf&#39; by the columns &#39;class&#39; and &#39;Target&#39;, and then calculates the size of each group (i.e., the number of patients) within each combination of &#39;class&#39; and &#39;Target&#39;.</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Group the DataFrame &#39;traindf&#39; by the columns &#39;class&#39; and &#39;Target&#39;, and calculate the size of each group (number of patients).</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>grouped_traindf <span class="op">=</span> traindf.groupby([<span class="st">&#39;class&#39;</span>, <span class="st">&#39;Target&#39;</span>]).size().reset_index(name<span class="op">=</span><span class="st">&#39;Patient Count&#39;</span>)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the output to see the DataFrame with the grouped results and patient counts.</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(grouped_traindf)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>                          class  Target  Patient Count
0                  Lung Opacity       1           9555
1  No Lung Opacity / Not Normal       0          11821
2                        Normal       0           8851
</code></pre>
</div>
</div>
<section
id="step-4-preprocessing-and-visualisation-of-different-classes"
class="cell markdown" id="ocnSgtQNt22h">
<h2>Step 4: Preprocessing and Visualisation of different classes</h2>
</section>
<div class="cell code" data-execution_count="206"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:577}"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:34:10.523058Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:34:10.522632Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:34:11.286301Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:34:11.285312Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:34:10.523023Z&quot;}"
id="zW9Rz_r6tvfc" data-outputId="17a56832-3151-4ff8-f97e-c789dec345e1"
data-trusted="true">
<div class="sourceCode" id="cb49"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The code groups the DataFrame &#39;traindf&#39; by the &#39;Target&#39; and &#39;class&#39; columns, and calculates the count of each unique combination.</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co"># It then creates a bar plot and a percentage bar chart to visualize the relationship between &#39;Target&#39; and &#39;class&#39; with improved visualizations.</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a figure with two subplots side by side and set the figure size to (15, 6).</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">1</span>, ncols<span class="op">=</span><span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">6</span>))</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Group the DataFrame &#39;traindf&#39; by &#39;Target&#39; and &#39;class&#39;, and calculate the count of each unique combination.</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>tmp <span class="op">=</span> traindf.groupby([<span class="st">&#39;Target&#39;</span>, <span class="st">&#39;class&#39;</span>]).size().reset_index(name<span class="op">=</span><span class="st">&#39;count&#39;</span>)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a bar plot using Seaborn&#39;s &#39;sns.barplot&#39;.</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;x&#39; represents the &#39;Target&#39; column, &#39;y&#39; represents the &#39;count&#39; column (count of each class per Target),</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="co"># and &#39;hue&#39; represents the &#39;class&#39; column to distinguish the classes in the plot.</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;palette&#39; sets the color palette for the bars.</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;alpha&#39; adjusts the transparency of the bars to improve visibility.</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>sns.barplot(ax<span class="op">=</span>ax1, x<span class="op">=</span><span class="st">&#39;Target&#39;</span>, y<span class="op">=</span><span class="st">&#39;count&#39;</span>, hue<span class="op">=</span><span class="st">&#39;class&#39;</span>, data<span class="op">=</span>tmp, palette<span class="op">=</span>[<span class="st">&#39;#1f77b4&#39;</span>, <span class="st">&#39;#ff7f0e&#39;</span>], alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Add data labels to the bars to display the exact count values.</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> ax1.patches:</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>    height <span class="op">=</span> p.get_height()</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pd.notnull(height):  <span class="co"># Check if height is not NaN before converting to integer</span></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>        ax1.annotate(<span class="ss">f&#39;</span><span class="sc">{</span><span class="bu">int</span>(height)<span class="sc">}</span><span class="ss">&#39;</span>, (p.get_x() <span class="op">+</span> p.get_width() <span class="op">/</span> <span class="dv">2</span>, height), ha<span class="op">=</span><span class="st">&#39;center&#39;</span>, va<span class="op">=</span><span class="st">&#39;bottom&#39;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:  <span class="co"># Handle NaN values and display &quot;0&quot; for zero counts</span></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>        ax1.annotate(<span class="st">&#39;0&#39;</span>, (p.get_x() <span class="op">+</span> p.get_width() <span class="op">/</span> <span class="dv">2</span>, <span class="dv">0</span>), ha<span class="op">=</span><span class="st">&#39;center&#39;</span>, va<span class="op">=</span><span class="st">&#39;bottom&#39;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Set a title for the first plot.</span></span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">&quot;Class and Target&quot;</span>)</span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the legend title and position for better readability in the first plot.</span></span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>ax1.legend(title<span class="op">=</span><span class="st">&#39;Class&#39;</span>, title_fontsize<span class="op">=</span><span class="dv">12</span>, fontsize<span class="op">=</span><span class="dv">12</span>, loc<span class="op">=</span><span class="st">&#39;upper right&#39;</span>)</span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the percentage of each class within each &#39;Target&#39; group.</span></span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>percentage_df <span class="op">=</span> tmp.pivot_table(index<span class="op">=</span><span class="st">&#39;Target&#39;</span>, columns<span class="op">=</span><span class="st">&#39;class&#39;</span>, values<span class="op">=</span><span class="st">&#39;count&#39;</span>, aggfunc<span class="op">=</span><span class="kw">lambda</span> x: x <span class="op">/</span> x.<span class="bu">sum</span>() <span class="op">*</span> <span class="dv">100</span>).reset_index()</span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a percentage bar chart using Seaborn&#39;s &#39;sns.barplot&#39; for the second subplot.</span></span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a>sns.barplot(ax<span class="op">=</span>ax2, x<span class="op">=</span><span class="st">&#39;Target&#39;</span>, y<span class="op">=</span><span class="st">&#39;Normal&#39;</span>, data<span class="op">=</span>percentage_df, color<span class="op">=</span><span class="st">&#39;#1f77b4&#39;</span>, label<span class="op">=</span><span class="st">&#39;Normal&#39;</span>, alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the &#39;Pneumonia&#39; class is present in &#39;percentage_df&#39;.</span></span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">&#39;Pneumonia&#39;</span> <span class="kw">in</span> percentage_df.columns:</span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a>    sns.barplot(ax<span class="op">=</span>ax2, x<span class="op">=</span><span class="st">&#39;Target&#39;</span>, y<span class="op">=</span><span class="st">&#39;Pneumonia&#39;</span>, data<span class="op">=</span>percentage_df, color<span class="op">=</span><span class="st">&#39;#ff7f0e&#39;</span>, label<span class="op">=</span><span class="st">&#39;Pneumonia&#39;</span>, alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb49-41"><a href="#cb49-41" aria-hidden="true" tabindex="-1"></a>    percentage_df[<span class="st">&#39;Pneumonia&#39;</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb49-42"><a href="#cb49-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-43"><a href="#cb49-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Add data labels to the percentage bars to display the exact percentage values.</span></span>
<span id="cb49-44"><a href="#cb49-44" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> ax2.patches:</span>
<span id="cb49-45"><a href="#cb49-45" aria-hidden="true" tabindex="-1"></a>    height <span class="op">=</span> p.get_height()</span>
<span id="cb49-46"><a href="#cb49-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pd.notnull(height):  <span class="co"># Check if height is not NaN before displaying data labels</span></span>
<span id="cb49-47"><a href="#cb49-47" aria-hidden="true" tabindex="-1"></a>        ax2.annotate(<span class="ss">f&#39;</span><span class="sc">{</span>height<span class="sc">:.1f}</span><span class="ss">%&#39;</span>, (p.get_x() <span class="op">+</span> p.get_width() <span class="op">/</span> <span class="dv">2</span>, height), ha<span class="op">=</span><span class="st">&#39;center&#39;</span>, va<span class="op">=</span><span class="st">&#39;bottom&#39;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb49-48"><a href="#cb49-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-49"><a href="#cb49-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Set a title for the second plot.</span></span>
<span id="cb49-50"><a href="#cb49-50" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">&quot;Percentage of Class within Target&quot;</span>)</span>
<span id="cb49-51"><a href="#cb49-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-52"><a href="#cb49-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the legend title and position for better readability in the second plot.</span></span>
<span id="cb49-53"><a href="#cb49-53" aria-hidden="true" tabindex="-1"></a>ax2.legend(title<span class="op">=</span><span class="st">&#39;Class&#39;</span>, title_fontsize<span class="op">=</span><span class="dv">12</span>, fontsize<span class="op">=</span><span class="dv">12</span>, loc<span class="op">=</span><span class="st">&#39;upper right&#39;</span>)</span>
<span id="cb49-54"><a href="#cb49-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-55"><a href="#cb49-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Set common y-axis label for both subplots.</span></span>
<span id="cb49-56"><a href="#cb49-56" aria-hidden="true" tabindex="-1"></a>fig.text(<span class="fl">0.5</span>, <span class="fl">0.04</span>, <span class="st">&#39;Target&#39;</span>, ha<span class="op">=</span><span class="st">&#39;center&#39;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb49-57"><a href="#cb49-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-58"><a href="#cb49-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plots.</span></span>
<span id="cb49-59"><a href="#cb49-59" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb49-60"><a href="#cb49-60" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/6ca48c1ad718c8da0a0758f41616dda530e422f3.png" /></p>
</div>
</div>
<div class="cell markdown" id="qafDvc2Qvn7O">
<h4
id="as-suspected-class-with-normal-and-no-lung-opacity--not-normal-has-been-classified-into-single-target-value-that-is-o-so-we-can-summarize-that-the-prediction-which-we-have-to-do-is-like-patient-has-lung-opacity-ir-not">As
suspected, class with Normal and No Lung Opacity / Not Normal has been
classified into single target value that is 'O'. So we can summarize
that the prediction which we have to do is like Patient has Lung Opacity
ir not.</h4>
<h4
id="because-normal-and-not-normal-patients-are-combines-in-same-target">Because
Normal and not normal patients are combines in same Target.</h4>
</div>
<section
id="prediction-binary-classification-ie-patient-has-lung-opacity-or-not-"
class="cell markdown" id="yKKKsbR2vwwj">
<h4>Prediction: Binary classification i.e. Patient has Lung Opacity or
not ?</h4>
</section>
<div class="cell code" data-execution_count="207"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:545}"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:34:12.872871Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:34:12.872497Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:34:13.239080Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:34:13.238043Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:34:12.872837Z&quot;}"
id="_XIbkcSpuYKD" data-outputId="d7404d64-c61f-4430-aff4-1f624b4aadc5"
data-trusted="true">
<div class="sourceCode" id="cb50"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a box plot to visualize the distribution of numerical columns in &#39;traindf&#39;.</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the figure size to (10, 6) for better visibility.</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the box plot using Seaborn.</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>traindf, palette<span class="op">=</span><span class="st">&#39;Set3&#39;</span>)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a title to the plot.</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Box Plot of Numerical Columns&quot;</span>)</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plot.</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/33a8050ee4967d2fdcb640f8bf55c84736987a30.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="208"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:699}"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:34:13.774912Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:34:13.774530Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:34:14.242289Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:34:14.241178Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:34:13.774882Z&quot;}"
id="45y-IoGZx_PV" data-outputId="c22c796b-24d9-44fb-da04-7a96913eb616"
data-trusted="true">
<div class="sourceCode" id="cb51"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;corr()&#39; function computes the pairwise correlation of columns in a DataFrame. It returns a new DataFrame</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="co"># where each entry is the correlation coefficient between two columns. The correlation coefficient varies</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co"># between -1 and 1. A positive value indicates a positive correlation (when one variable increases, the other tends</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co"># to increase as well), while a negative value indicates a negative correlation (when one variable increases, the</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="co"># other tends to decrease).</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s compute the correlation matrix for the &#39;traindf&#39; DataFrame:</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>correlation_matrix <span class="op">=</span> traindf.corr()</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a heatmap to visualize the correlation matrix using Seaborn&#39;s &#39;sns.heatmap&#39; function.</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the figure size to (10, 8) for better visibility.</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the heatmap using Seaborn.</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;annot&#39; parameter displays the correlation coefficient values on the heatmap.</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;fmt&#39; parameter sets the format of the annotation to show correlation coefficients with one decimal point.</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;cmap&#39; parameter sets the color map for the heatmap.</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>sns.heatmap(correlation_matrix, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">&quot;.1f&quot;</span>, cmap<span class="op">=</span><span class="st">&quot;coolwarm&quot;</span>)</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a title to the plot.</span></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Correlation Heatmap of Numerical Columns&quot;</span>)</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plot.</span></span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/c5d716ace5b23083366ffb61320e892bf88f4998.png" /></p>
</div>
</div>
<div class="cell markdown" id="zB90Pq7fzsUv">
<h4 id="width--height-has-highest-positive-correlation">Width &amp;
height has highest positive correlation</h4>
<h4 id="y--height-has-highest-negative-correlation">y &amp; height has
highest negative correlation</h4>
</div>
<div class="cell code" data-execution_count="209"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:1000}"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:34:15.249565Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:34:15.248582Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:34:16.930361Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:34:16.929311Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:34:15.249525Z&quot;}"
id="F5KwY8QLzVfe" data-outputId="02570f46-ff63-4825-d78d-c6b60ad249fa"
data-trusted="true">
<div class="sourceCode" id="cb52"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In this code, we are visualizing the distribution of numerical columns for the rows where &#39;Target&#39; equals 1.</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We create four subplots (2x2) to display the distribution of &#39;x&#39;, &#39;y&#39;, &#39;width&#39;, and &#39;height&#39;.</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s create the &#39;target1&#39; DataFrame containing rows where &#39;Target&#39; is equal to 1.</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>target1 <span class="op">=</span> traindf[traindf[<span class="st">&#39;Target&#39;</span>] <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the Seaborn style to &#39;whitegrid&#39; for better visibility of grids on the plots.</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&#39;whitegrid&#39;</span>)</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a figure and subplots with a size of (12, 12).</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">12</span>))</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the distribution of &#39;x&#39; with a KDE plot and a box plot on the first subplot.</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>sns.histplot(target1[<span class="st">&#39;x&#39;</span>], kde<span class="op">=</span><span class="va">True</span>, bins<span class="op">=</span><span class="dv">50</span>, color<span class="op">=</span><span class="st">&quot;red&quot;</span>, ax<span class="op">=</span>ax[<span class="dv">0</span>, <span class="dv">0</span>])</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>sns.boxplot(y<span class="op">=</span>target1[<span class="st">&#39;x&#39;</span>], color<span class="op">=</span><span class="st">&quot;blue&quot;</span>, width<span class="op">=</span><span class="fl">0.2</span>, ax<span class="op">=</span>ax[<span class="dv">0</span>, <span class="dv">0</span>])</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>, <span class="dv">0</span>].set_title(<span class="st">&quot;Distribution and Box Plot of &#39;x&#39; for Target 1&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the distribution of &#39;y&#39; with a KDE plot and a violin plot on the second subplot.</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>sns.histplot(target1[<span class="st">&#39;y&#39;</span>], kde<span class="op">=</span><span class="va">True</span>, bins<span class="op">=</span><span class="dv">50</span>, color<span class="op">=</span><span class="st">&quot;blue&quot;</span>, ax<span class="op">=</span>ax[<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>sns.violinplot(y<span class="op">=</span>target1[<span class="st">&#39;y&#39;</span>], color<span class="op">=</span><span class="st">&quot;green&quot;</span>, ax<span class="op">=</span>ax[<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>, <span class="dv">1</span>].set_title(<span class="st">&quot;Distribution and Violin Plot of &#39;y&#39; for Target 1&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the distribution of &#39;width&#39; with a KDE plot and a box plot on the third subplot.</span></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>sns.histplot(target1[<span class="st">&#39;width&#39;</span>], kde<span class="op">=</span><span class="va">True</span>, bins<span class="op">=</span><span class="dv">50</span>, color<span class="op">=</span><span class="st">&quot;green&quot;</span>, ax<span class="op">=</span>ax[<span class="dv">1</span>, <span class="dv">0</span>])</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>sns.boxplot(y<span class="op">=</span>target1[<span class="st">&#39;width&#39;</span>], color<span class="op">=</span><span class="st">&quot;magenta&quot;</span>, width<span class="op">=</span><span class="fl">0.2</span>, ax<span class="op">=</span>ax[<span class="dv">1</span>, <span class="dv">0</span>])</span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>, <span class="dv">0</span>].set_title(<span class="st">&quot;Distribution and Box Plot of &#39;width&#39; for Target 1&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the distribution of &#39;height&#39; with a KDE plot and a violin plot on the fourth subplot.</span></span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>sns.histplot(target1[<span class="st">&#39;height&#39;</span>], kde<span class="op">=</span><span class="va">True</span>, bins<span class="op">=</span><span class="dv">50</span>, color<span class="op">=</span><span class="st">&quot;magenta&quot;</span>, ax<span class="op">=</span>ax[<span class="dv">1</span>, <span class="dv">1</span>])</span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>sns.violinplot(y<span class="op">=</span>target1[<span class="st">&#39;height&#39;</span>], color<span class="op">=</span><span class="st">&quot;purple&quot;</span>, ax<span class="op">=</span>ax[<span class="dv">1</span>, <span class="dv">1</span>])</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>, <span class="dv">1</span>].set_title(<span class="st">&quot;Distribution and Violin Plot of &#39;height&#39; for Target 1&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove x-axis labels from KDE plots to avoid clutter.</span></span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>):</span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a>    ax[<span class="dv">1</span>, i].set_xlabel(<span class="st">&#39;&#39;</span>)</span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the tick label font size for better readability.</span></span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ax_row <span class="kw">in</span> ax:</span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ax_col <span class="kw">in</span> ax_row:</span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a>        ax_col.tick_params(axis<span class="op">=</span><span class="st">&#39;both&#39;</span>, which<span class="op">=</span><span class="st">&#39;major&#39;</span>, labelsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the layout to avoid overlapping titles and labels.</span></span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-45"><a href="#cb52-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the plot.</span></span>
<span id="cb52-46"><a href="#cb52-46" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/63c124ddc5959c823c72a1d69c8e3817137a6b44.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="210"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:1000}"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:34:16.933582Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:34:16.932856Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:34:19.463968Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:34:19.462834Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:34:16.933542Z&quot;}"
id="Lyk9Rp2d0HFE" data-outputId="133a7e83-e58d-4ec8-d1ca-8465437fae18"
data-trusted="true">
<div class="sourceCode" id="cb53"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In this code, we are visualizing the distribution of numerical columns for the rows where &#39;Target&#39; equals 1.</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We create four subplots (2x2) to display the distribution of &#39;x&#39;, &#39;y&#39;, &#39;width&#39;, and &#39;height&#39;.</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s create the &#39;target1&#39; DataFrame containing rows where &#39;Target&#39; is equal to 1.</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>target1 <span class="op">=</span> traindf[traindf[<span class="st">&#39;Target&#39;</span>] <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the Seaborn style to &#39;whitegrid&#39; for better visibility of grids on the plots.</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&#39;whitegrid&#39;</span>)</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a figure and subplots with a size of (12, 12).</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">12</span>))</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the distribution of &#39;x&#39; with a histogram and a KDE plot on the first subplot.</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>sns.histplot(target1[<span class="st">&#39;x&#39;</span>], bins<span class="op">=</span><span class="dv">50</span>, color<span class="op">=</span><span class="st">&quot;lightblue&quot;</span>, ax<span class="op">=</span>ax[<span class="dv">0</span>, <span class="dv">0</span>], kde<span class="op">=</span><span class="va">True</span>, line_kws<span class="op">=</span>{<span class="st">&#39;color&#39;</span>: <span class="st">&#39;red&#39;</span>, <span class="st">&#39;lw&#39;</span>: <span class="dv">2</span>})</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>mean_x <span class="op">=</span> target1[<span class="st">&#39;x&#39;</span>].mean()</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>median_x <span class="op">=</span> target1[<span class="st">&#39;x&#39;</span>].median()</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>, <span class="dv">0</span>].axvline(mean_x, color<span class="op">=</span><span class="st">&#39;orange&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;dashed&#39;</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">&#39;Mean&#39;</span>)</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>, <span class="dv">0</span>].axvline(median_x, color<span class="op">=</span><span class="st">&#39;purple&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;dashed&#39;</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">&#39;Median&#39;</span>)</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>, <span class="dv">0</span>].legend()</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>, <span class="dv">0</span>].set_title(<span class="st">&quot;Distribution and KDE Plot of &#39;x&#39; for Target 1&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the distribution of &#39;y&#39; with a histogram and a KDE plot on the second subplot.</span></span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>sns.histplot(target1[<span class="st">&#39;y&#39;</span>], bins<span class="op">=</span><span class="dv">50</span>, color<span class="op">=</span><span class="st">&quot;lightgreen&quot;</span>, ax<span class="op">=</span>ax[<span class="dv">0</span>, <span class="dv">1</span>], kde<span class="op">=</span><span class="va">True</span>, line_kws<span class="op">=</span>{<span class="st">&#39;color&#39;</span>: <span class="st">&#39;blue&#39;</span>, <span class="st">&#39;lw&#39;</span>: <span class="dv">2</span>})</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>mean_y <span class="op">=</span> target1[<span class="st">&#39;y&#39;</span>].mean()</span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>median_y <span class="op">=</span> target1[<span class="st">&#39;y&#39;</span>].median()</span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>, <span class="dv">1</span>].axvline(mean_y, color<span class="op">=</span><span class="st">&#39;orange&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;dashed&#39;</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">&#39;Mean&#39;</span>)</span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>, <span class="dv">1</span>].axvline(median_y, color<span class="op">=</span><span class="st">&#39;purple&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;dashed&#39;</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">&#39;Median&#39;</span>)</span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>, <span class="dv">1</span>].legend()</span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>, <span class="dv">1</span>].set_title(<span class="st">&quot;Distribution and KDE Plot of &#39;y&#39; for Target 1&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the distribution of &#39;width&#39; with a histogram and a KDE plot on the third subplot.</span></span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true" tabindex="-1"></a>sns.histplot(target1[<span class="st">&#39;width&#39;</span>], bins<span class="op">=</span><span class="dv">50</span>, color<span class="op">=</span><span class="st">&quot;lightpink&quot;</span>, ax<span class="op">=</span>ax[<span class="dv">1</span>, <span class="dv">0</span>], kde<span class="op">=</span><span class="va">True</span>, line_kws<span class="op">=</span>{<span class="st">&#39;color&#39;</span>: <span class="st">&#39;red&#39;</span>, <span class="st">&#39;lw&#39;</span>: <span class="dv">2</span>})</span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true" tabindex="-1"></a>mean_width <span class="op">=</span> target1[<span class="st">&#39;width&#39;</span>].mean()</span>
<span id="cb53-34"><a href="#cb53-34" aria-hidden="true" tabindex="-1"></a>median_width <span class="op">=</span> target1[<span class="st">&#39;width&#39;</span>].median()</span>
<span id="cb53-35"><a href="#cb53-35" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>, <span class="dv">0</span>].axvline(mean_width, color<span class="op">=</span><span class="st">&#39;orange&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;dashed&#39;</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">&#39;Mean&#39;</span>)</span>
<span id="cb53-36"><a href="#cb53-36" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>, <span class="dv">0</span>].axvline(median_width, color<span class="op">=</span><span class="st">&#39;purple&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;dashed&#39;</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">&#39;Median&#39;</span>)</span>
<span id="cb53-37"><a href="#cb53-37" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>, <span class="dv">0</span>].legend()</span>
<span id="cb53-38"><a href="#cb53-38" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>, <span class="dv">0</span>].set_title(<span class="st">&quot;Distribution and KDE Plot of &#39;width&#39; for Target 1&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb53-39"><a href="#cb53-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-40"><a href="#cb53-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the distribution of &#39;height&#39; with a histogram and a KDE plot on the fourth subplot.</span></span>
<span id="cb53-41"><a href="#cb53-41" aria-hidden="true" tabindex="-1"></a>sns.histplot(target1[<span class="st">&#39;height&#39;</span>], bins<span class="op">=</span><span class="dv">50</span>, color<span class="op">=</span><span class="st">&quot;lightcoral&quot;</span>, ax<span class="op">=</span>ax[<span class="dv">1</span>, <span class="dv">1</span>], kde<span class="op">=</span><span class="va">True</span>, line_kws<span class="op">=</span>{<span class="st">&#39;color&#39;</span>: <span class="st">&#39;blue&#39;</span>, <span class="st">&#39;lw&#39;</span>: <span class="dv">2</span>})</span>
<span id="cb53-42"><a href="#cb53-42" aria-hidden="true" tabindex="-1"></a>mean_height <span class="op">=</span> target1[<span class="st">&#39;height&#39;</span>].mean()</span>
<span id="cb53-43"><a href="#cb53-43" aria-hidden="true" tabindex="-1"></a>median_height <span class="op">=</span> target1[<span class="st">&#39;height&#39;</span>].median()</span>
<span id="cb53-44"><a href="#cb53-44" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>, <span class="dv">1</span>].axvline(mean_height, color<span class="op">=</span><span class="st">&#39;orange&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;dashed&#39;</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">&#39;Mean&#39;</span>)</span>
<span id="cb53-45"><a href="#cb53-45" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>, <span class="dv">1</span>].axvline(median_height, color<span class="op">=</span><span class="st">&#39;purple&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;dashed&#39;</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">&#39;Median&#39;</span>)</span>
<span id="cb53-46"><a href="#cb53-46" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>, <span class="dv">1</span>].legend()</span>
<span id="cb53-47"><a href="#cb53-47" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>, <span class="dv">1</span>].set_title(<span class="st">&quot;Distribution and KDE Plot of &#39;height&#39; for Target 1&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb53-48"><a href="#cb53-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-49"><a href="#cb53-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove x-axis labels from all plots to avoid clutter.</span></span>
<span id="cb53-50"><a href="#cb53-50" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>):</span>
<span id="cb53-51"><a href="#cb53-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>):</span>
<span id="cb53-52"><a href="#cb53-52" aria-hidden="true" tabindex="-1"></a>        ax[i, j].set_xlabel(<span class="st">&#39;&#39;</span>)</span>
<span id="cb53-53"><a href="#cb53-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-54"><a href="#cb53-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the tick label font size for better readability.</span></span>
<span id="cb53-55"><a href="#cb53-55" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ax_row <span class="kw">in</span> ax:</span>
<span id="cb53-56"><a href="#cb53-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ax_col <span class="kw">in</span> ax_row:</span>
<span id="cb53-57"><a href="#cb53-57" aria-hidden="true" tabindex="-1"></a>        ax_col.tick_params(axis<span class="op">=</span><span class="st">&#39;both&#39;</span>, which<span class="op">=</span><span class="st">&#39;major&#39;</span>, labelsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb53-58"><a href="#cb53-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-59"><a href="#cb53-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the layout to avoid overlapping titles and labels.</span></span>
<span id="cb53-60"><a href="#cb53-60" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb53-61"><a href="#cb53-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-62"><a href="#cb53-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the plot.</span></span>
<span id="cb53-63"><a href="#cb53-63" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/91c5dea8769e9c40ffe91eb9fb68d4675afbc51c.png" /></p>
</div>
</div>
<div class="cell markdown" id="3p351ZeI2M5Y">
<h4 id="width-is-more-evenly-ditributed">Width is more evenly
ditributed</h4>
<h4
id="height-is-left-skewed-distribution-with-majority-of-datapoints-is-towards-right">Height
is left skewed distribution with majority of datapoints is towards
right</h4>
</div>
<div class="cell code" data-execution_count="211"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:34:19.466475Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:34:19.466038Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:34:19.471890Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:34:19.470828Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:34:19.466440Z&quot;}"
id="vgs4m8Uh0t5w" data-trusted="true">
<div class="sourceCode" id="cb54"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the file paths for the train and test images directories using the &#39;Path&#39; class.</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co"># File path for the directory containing the train images.</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>trainImagesPath1 <span class="op">=</span> Path(<span class="st">&quot;/kaggle/input/pneumonia-detection/stage_2_train_images/stage_2_train_images&quot;</span>)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="co"># File path for the directory containing the test images.</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>testImagesPath1 <span class="op">=</span> Path(<span class="st">&quot;/kaggle/input/pneumonia-detection/stage_2_test_images/stage_2_test_images&quot;</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="212"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:34:19.474240Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:34:19.473537Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:34:19.839599Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:34:19.838376Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:34:19.474205Z&quot;}"
id="Oigu9bex2-Au" data-outputId="660d147d-e7e7-4252-c0b9-4d251e72e515"
data-trusted="true">
<div class="sourceCode" id="cb55"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;trainImagesPath1&#39; is the directory path containing the train images.</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;testImagesPath1&#39; is the directory path containing the test images.</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="co"># List all the filenames (images) present in the &#39;trainImagesPath1&#39; directory.</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>image_train_path <span class="op">=</span> os.listdir(trainImagesPath1)</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="co"># List all the filenames (images) present in the &#39;testImagesPath1&#39; directory.</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>image_test_path <span class="op">=</span> os.listdir(testImagesPath1)</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the number of images in the train set and the test set.</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Number of images in train set:&quot;</span>, <span class="bu">len</span>(image_train_path), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">Number of images in test set:&quot;</span>, <span class="bu">len</span>(image_test_path))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Number of images in train set: 26684 
Number of images in test set: 3000
</code></pre>
</div>
</div>
<section
id="train-images-length-matched-with-unique-patient-ids-in-traindf"
class="cell markdown" id="QUW0YZYp4I0X">
<h4>Train images length matched with unique patient id's in
traindf.</h4>
</section>
<section id="step-3-map-training-and-testing-images-to-its-annotations"
class="cell markdown" id="g_Vw5gqM4KxL">
<h2>Step 3: Map training and testing images to its annotations.</h2>
</section>
<div class="cell code" data-execution_count="213"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:34:20.821998Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:34:20.821574Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:34:20.836986Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:34:20.835680Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:34:20.821962Z&quot;}"
id="wpKV97-b3MhA" data-outputId="d24da72f-c07b-444a-a041-2026bae58272"
data-trusted="true">
<div class="sourceCode" id="cb57"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the patient ID from the first three rows of the &#39;traindf&#39; DataFrame and convert it to a list.</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, select the first element (the patient ID) from the list.</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>samplePatientID <span class="op">=</span> <span class="bu">list</span>(traindf[:<span class="dv">3</span>].T.to_dict().values())[<span class="dv">0</span>][<span class="st">&#39;patientId&#39;</span>]</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a file path to the DICOM file corresponding to the selected patient ID.</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;trainImagesPath1&#39; variable should contain the path to the directory containing the DICOM images.</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>dcm_path <span class="op">=</span> trainImagesPath1 <span class="op">/</span> samplePatientID</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Change the file extension of the file path to &#39;.dcm&#39; (assuming the original file has a different extension).</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>dcm_path <span class="op">=</span> dcm_path.with_suffix(<span class="st">&quot;.dcm&quot;</span>)</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the DICOM file using the &#39;pydicom.read_file()&#39; function and store it in the &#39;dcm&#39; variable.</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>dcm <span class="op">=</span> pydicom.read_file(dcm_path)</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the DICOM data.</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dcm)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Dataset.file_meta -------------------------------
(0002, 0000) File Meta Information Group Length  UL: 202
(0002, 0001) File Meta Information Version       OB: b&#39;\x00\x01&#39;
(0002, 0002) Media Storage SOP Class UID         UI: Secondary Capture Image Storage
(0002, 0003) Media Storage SOP Instance UID      UI: 1.2.276.0.7230010.3.1.4.8323329.28530.1517874485.775526
(0002, 0010) Transfer Syntax UID                 UI: JPEG Baseline (Process 1)
(0002, 0012) Implementation Class UID            UI: 1.2.276.0.7230010.3.0.3.6.0
(0002, 0013) Implementation Version Name         SH: &#39;OFFIS_DCMTK_360&#39;
-------------------------------------------------
(0008, 0005) Specific Character Set              CS: &#39;ISO_IR 100&#39;
(0008, 0016) SOP Class UID                       UI: Secondary Capture Image Storage
(0008, 0018) SOP Instance UID                    UI: 1.2.276.0.7230010.3.1.4.8323329.28530.1517874485.775526
(0008, 0020) Study Date                          DA: &#39;19010101&#39;
(0008, 0030) Study Time                          TM: &#39;000000.00&#39;
(0008, 0050) Accession Number                    SH: &#39;&#39;
(0008, 0060) Modality                            CS: &#39;CR&#39;
(0008, 0064) Conversion Type                     CS: &#39;WSD&#39;
(0008, 0090) Referring Physician&#39;s Name          PN: &#39;&#39;
(0008, 103e) Series Description                  LO: &#39;view: PA&#39;
(0010, 0010) Patient&#39;s Name                      PN: &#39;0004cfab-14fd-4e49-80ba-63a80b6bddd6&#39;
(0010, 0020) Patient ID                          LO: &#39;0004cfab-14fd-4e49-80ba-63a80b6bddd6&#39;
(0010, 0030) Patient&#39;s Birth Date                DA: &#39;&#39;
(0010, 0040) Patient&#39;s Sex                       CS: &#39;F&#39;
(0010, 1010) Patient&#39;s Age                       AS: &#39;51&#39;
(0018, 0015) Body Part Examined                  CS: &#39;CHEST&#39;
(0018, 5101) View Position                       CS: &#39;PA&#39;
(0020, 000d) Study Instance UID                  UI: 1.2.276.0.7230010.3.1.2.8323329.28530.1517874485.775525
(0020, 000e) Series Instance UID                 UI: 1.2.276.0.7230010.3.1.3.8323329.28530.1517874485.775524
(0020, 0010) Study ID                            SH: &#39;&#39;
(0020, 0011) Series Number                       IS: &#39;1&#39;
(0020, 0013) Instance Number                     IS: &#39;1&#39;
(0020, 0020) Patient Orientation                 CS: &#39;&#39;
(0028, 0002) Samples per Pixel                   US: 1
(0028, 0004) Photometric Interpretation          CS: &#39;MONOCHROME2&#39;
(0028, 0010) Rows                                US: 1024
(0028, 0011) Columns                             US: 1024
(0028, 0030) Pixel Spacing                       DS: [0.14300000000000002, 0.14300000000000002]
(0028, 0100) Bits Allocated                      US: 8
(0028, 0101) Bits Stored                         US: 8
(0028, 0102) High Bit                            US: 7
(0028, 0103) Pixel Representation                US: 0
(0028, 2110) Lossy Image Compression             CS: &#39;01&#39;
(0028, 2114) Lossy Image Compression Method      CS: &#39;ISO_10918_1&#39;
(7fe0, 0010) Pixel Data                          OB: Array of 142006 elements
</code></pre>
</div>
</div>
<section
id="we-have-available-some-useful-information-in-the-dicom-metadata-with-predictive-value-for-example-patient-sex-patient-age-modality-body-part-examined-view-position-rows--columns-pixel-spacing"
class="cell markdown" id="49_8_YqO4zGa">
<h4>We have available some useful information in the DICOM metadata with
predictive value, for example: Patient sex; Patient age; Modality; Body
part examined; View position; Rows &amp; Columns; Pixel Spacing.</h4>
</section>
<section id="step-5-display-images-with-bounding-box"
class="cell markdown" id="2ZGtYuYj4879">
<h2>Step 5: Display images with bounding box</h2>
</section>
<div class="cell code" data-execution_count="214"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:34:23.178829Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:34:23.178456Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:34:23.188992Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:34:23.187968Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:34:23.178798Z&quot;}"
id="P_Zu-bGA4q7R" data-trusted="true">
<div class="sourceCode" id="cb59"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function &#39;show_dicom_images&#39; that takes &#39;data&#39; as input (DataFrame containing DICOM information).</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_dicom_images(data):</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert the DataFrame &#39;data&#39; to a list of dictionaries and store it in &#39;img_data&#39;.</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    img_data <span class="op">=</span> <span class="bu">list</span>(data.T.to_dict().values())</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a 3x3 grid of subplots using matplotlib with a figure size of 16x18.</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>    f, ax <span class="op">=</span> plt.subplots(<span class="dv">3</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">18</span>))</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop through each item in &#39;img_data&#39; and extract DICOM information.</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, data_row <span class="kw">in</span> <span class="bu">enumerate</span>(img_data):</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create a file path to the DICOM file corresponding to the patient ID.</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>        dcm_path <span class="op">=</span> trainImagesPath1 <span class="op">/</span> data_row[<span class="st">&#39;patientId&#39;</span>]</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>        dcm_path <span class="op">=</span> dcm_path.with_suffix(<span class="st">&quot;.dcm&quot;</span>)</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Read the DICOM file using &#39;pydicom.read_file()&#39; and store the DICOM data in &#39;data_row_img_data&#39;.</span></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>        data_row_img_data <span class="op">=</span> pydicom.read_file(dcm_path)</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extract relevant metadata from the DICOM data.</span></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>        modality <span class="op">=</span> data_row_img_data.Modality</span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>        age <span class="op">=</span> data_row_img_data.PatientAge</span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>        sex <span class="op">=</span> data_row_img_data.PatientSex</span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Display the DICOM image using &#39;imshow&#39; on the appropriate subplot and set axis off.</span></span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>        ax[i <span class="op">//</span> <span class="dv">3</span>, i <span class="op">%</span> <span class="dv">3</span>].imshow(data_row_img_data.pixel_array, cmap<span class="op">=</span>plt.cm.bone)</span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>        ax[i <span class="op">//</span> <span class="dv">3</span>, i <span class="op">%</span> <span class="dv">3</span>].axis(<span class="st">&#39;off&#39;</span>)</span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Set the title of the subplot with patient information and other details.</span></span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a>        ax[i <span class="op">//</span> <span class="dv">3</span>, i <span class="op">%</span> <span class="dv">3</span>].set_title(<span class="st">&#39;ID: </span><span class="sc">{}</span><span class="ch">\n</span><span class="st">Modality: </span><span class="sc">{}</span><span class="st"> Age: </span><span class="sc">{}</span><span class="st"> Sex: </span><span class="sc">{}</span><span class="st"> Target: </span><span class="sc">{}</span><span class="ch">\n</span><span class="st">Class: </span><span class="sc">{}</span><span class="ch">\n</span><span class="st">Window: </span><span class="sc">{}</span><span class="st">:</span><span class="sc">{}</span><span class="st">:</span><span class="sc">{}</span><span class="st">:</span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(</span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a>                data_row[<span class="st">&#39;patientId&#39;</span>],</span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a>                modality, age, sex, data_row[<span class="st">&#39;Target&#39;</span>], data_row[<span class="st">&#39;class&#39;</span>],</span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a>                data_row[<span class="st">&#39;x&#39;</span>], data_row[<span class="st">&#39;y&#39;</span>], data_row[<span class="st">&#39;width&#39;</span>], data_row[<span class="st">&#39;height&#39;</span>]))</span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Display the grid of subplots containing the DICOM images and their information.</span></span>
<span id="cb59-34"><a href="#cb59-34" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="215"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:1000}"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:34:24.097877Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:34:24.097477Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:34:26.978898Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:34:26.976446Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:34:24.097844Z&quot;}"
id="QmNwarrG5HxC" data-outputId="cc41bba7-b0b9-434f-c662-0c31a65cc99d"
data-trusted="true">
<div class="sourceCode" id="cb60"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display a sample of 9 DICOM images from the &#39;traindf&#39; DataFrame where &#39;Target&#39; is equal to 1.</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>show_dicom_images(traindf[traindf[<span class="st">&#39;Target&#39;</span>] <span class="op">==</span> <span class="dv">1</span>].sample(<span class="dv">9</span>))</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/4203f07a664116257415664a81b06057053a4c4a.png" /></p>
</div>
</div>
<section
id="we-would-like-to-represent-the-images-with-the-overlay-boxes-superposed-for-this-we-will-need-first-to-parse-the-whole-dataset-with-target--1-and-gather-all-coordinates-of-the-windows-showing-a-lung-opacity-on-the-same-image"
class="cell markdown" id="h46JYTjc5roF">
<h4>We would like to represent the images with the overlay boxes
superposed. For this, we will need first to parse the whole dataset with
Target = 1 and gather all coordinates of the windows showing a Lung
Opacity on the same image.</h4>
</section>
<div class="cell code" data-execution_count="216"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:34:26.981636Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:34:26.980954Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:34:26.996906Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:34:26.995252Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:34:26.981598Z&quot;}"
id="AssunKJ45Spk" data-trusted="true">
<div class="sourceCode" id="cb61"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function &#39;show_dicom_images_with_boxes&#39; that takes &#39;data&#39; as input (DataFrame containing DICOM information).</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_dicom_images_with_boxes(data):</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert the DataFrame &#39;data&#39; to a list of dictionaries and store it in &#39;img_data&#39;.</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    img_data <span class="op">=</span> <span class="bu">list</span>(data.T.to_dict().values())</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a 3x3 grid of subplots using matplotlib with a figure size of 16x18.</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    f, ax <span class="op">=</span> plt.subplots(<span class="dv">3</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">18</span>))</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop through each item in &#39;img_data&#39; and extract DICOM information.</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, data_row <span class="kw">in</span> <span class="bu">enumerate</span>(img_data):</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create a file path to the DICOM file corresponding to the patient ID.</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>        dcm_path <span class="op">=</span> trainImagesPath1 <span class="op">/</span> data_row[<span class="st">&#39;patientId&#39;</span>]</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>        dcm_path <span class="op">=</span> dcm_path.with_suffix(<span class="st">&quot;.dcm&quot;</span>)</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Read the DICOM file using &#39;pydicom.read_file()&#39; and store the DICOM data in &#39;data_row_img_data&#39;.</span></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>        data_row_img_data <span class="op">=</span> pydicom.read_file(dcm_path)</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extract relevant metadata from the DICOM data.</span></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>        modality <span class="op">=</span> data_row_img_data.Modality</span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>        age <span class="op">=</span> data_row_img_data.PatientAge</span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>        sex <span class="op">=</span> data_row_img_data.PatientSex</span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Display the DICOM image using &#39;imshow&#39; on the appropriate subplot and set axis off.</span></span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a>        ax[i <span class="op">//</span> <span class="dv">3</span>, i <span class="op">%</span> <span class="dv">3</span>].imshow(data_row_img_data.pixel_array, cmap<span class="op">=</span>plt.cm.bone)</span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a>        ax[i <span class="op">//</span> <span class="dv">3</span>, i <span class="op">%</span> <span class="dv">3</span>].axis(<span class="st">&#39;off&#39;</span>)</span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Set the title of the subplot with patient information and class details.</span></span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a>        ax[i <span class="op">//</span> <span class="dv">3</span>, i <span class="op">%</span> <span class="dv">3</span>].set_title(<span class="st">&#39;ID: </span><span class="sc">{}</span><span class="ch">\n</span><span class="st">Modality: </span><span class="sc">{}</span><span class="st"> Age: </span><span class="sc">{}</span><span class="st"> Sex: </span><span class="sc">{}</span><span class="st"> Target: </span><span class="sc">{}</span><span class="ch">\n</span><span class="st">Class: </span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(</span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a>                data_row[<span class="st">&#39;patientId&#39;</span>],modality, age, sex, data_row[<span class="st">&#39;Target&#39;</span>], data_row[<span class="st">&#39;class&#39;</span>]))</span>
<span id="cb61-30"><a href="#cb61-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-31"><a href="#cb61-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Filter the DataFrame &#39;traindf&#39; to extract rows with the same patient ID as the current data_row.</span></span>
<span id="cb61-32"><a href="#cb61-32" aria-hidden="true" tabindex="-1"></a>        rows <span class="op">=</span> traindf[traindf[<span class="st">&#39;patientId&#39;</span>] <span class="op">==</span> data_row[<span class="st">&#39;patientId&#39;</span>]]</span>
<span id="cb61-33"><a href="#cb61-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-34"><a href="#cb61-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Convert the filtered DataFrame &#39;rows&#39; to a list of dictionaries and store it in &#39;box_data&#39;.</span></span>
<span id="cb61-35"><a href="#cb61-35" aria-hidden="true" tabindex="-1"></a>        box_data <span class="op">=</span> <span class="bu">list</span>(rows.T.to_dict().values())</span>
<span id="cb61-36"><a href="#cb61-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-37"><a href="#cb61-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Loop through each item in &#39;box_data&#39; and draw a red rectangle (box) on the corresponding subplot.</span></span>
<span id="cb61-38"><a href="#cb61-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, row <span class="kw">in</span> <span class="bu">enumerate</span>(box_data):</span>
<span id="cb61-39"><a href="#cb61-39" aria-hidden="true" tabindex="-1"></a>            ax[i <span class="op">//</span> <span class="dv">3</span>, i <span class="op">%</span> <span class="dv">3</span>].add_patch(Rectangle(xy<span class="op">=</span>(row[<span class="st">&#39;x&#39;</span>], row[<span class="st">&#39;y&#39;</span>]),</span>
<span id="cb61-40"><a href="#cb61-40" aria-hidden="true" tabindex="-1"></a>                                                 width<span class="op">=</span>row[<span class="st">&#39;width&#39;</span>], height<span class="op">=</span>row[<span class="st">&#39;height&#39;</span>],</span>
<span id="cb61-41"><a href="#cb61-41" aria-hidden="true" tabindex="-1"></a>                                                 linewidth<span class="op">=</span><span class="dv">2</span>, edgecolor<span class="op">=</span><span class="st">&#39;r&#39;</span>, facecolor<span class="op">=</span><span class="st">&#39;none&#39;</span>))</span>
<span id="cb61-42"><a href="#cb61-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-43"><a href="#cb61-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Display the grid of subplots containing the DICOM images with bounding boxes.</span></span>
<span id="cb61-44"><a href="#cb61-44" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="217"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:1000}"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:34:26.999404Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:34:26.998677Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:34:29.802672Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:34:29.801459Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:34:26.999356Z&quot;}"
id="ZxwekCTP56je" data-outputId="8959165c-3dcb-4a4e-a674-95819f4a11a4"
data-trusted="true">
<div class="sourceCode" id="cb62"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display a sample of 9 DICOM images with bounding boxes from the &#39;traindf&#39; DataFrame where &#39;Target&#39; is equal to 1.</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>show_dicom_images_with_boxes(traindf[traindf[<span class="st">&#39;Target&#39;</span>] <span class="op">==</span> <span class="dv">1</span>].sample(<span class="dv">9</span>))</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/e00fc805b15f02b268a6d344dcce6e342350afad.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="218"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:34:29.805406Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:34:29.805046Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:34:29.818694Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:34:29.817678Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:34:29.805359Z&quot;}"
id="ZnunryWp5-Z3" data-trusted="true">
<div class="sourceCode" id="cb63"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List of DICOM metadata variables to extract.</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="bu">vars</span> <span class="op">=</span> [<span class="st">&#39;Modality&#39;</span>, <span class="st">&#39;PatientAge&#39;</span>, <span class="st">&#39;PatientSex&#39;</span>, <span class="st">&#39;BodyPartExamined&#39;</span>, <span class="st">&#39;ViewPosition&#39;</span>, <span class="st">&#39;ConversionType&#39;</span>, <span class="st">&#39;Rows&#39;</span>, <span class="st">&#39;Columns&#39;</span>, <span class="st">&#39;PixelSpacing&#39;</span>]</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function &#39;process_dicom_data&#39; that takes &#39;data_df&#39; (DataFrame) and &#39;imagesPath&#39; (path to DICOM images) as input.</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_dicom_data(data_df, imagesPath):</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop through each variable in the &#39;vars&#39; list and add them as new columns in &#39;data_df&#39; with initial value as None.</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> var <span class="kw">in</span> <span class="bu">vars</span>:</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>        data_df[var] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the list of DICOM image file names from the specified &#39;imagesPath&#39; directory.</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>    image_names <span class="op">=</span> os.listdir(imagesPath)</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop through each DICOM image file and process its metadata.</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, img_name <span class="kw">in</span> tqdm_notebook(<span class="bu">enumerate</span>(image_names)):</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create the path to the DICOM file using the image file name.</span></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>        dcm_path <span class="op">=</span> imagesPath <span class="op">/</span> img_name</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>        dcm_path <span class="op">=</span> dcm_path.with_suffix(<span class="st">&quot;.dcm&quot;</span>)</span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Read the DICOM file using &#39;pydicom.read_file()&#39; and store the DICOM data in &#39;data_row_img_data&#39;.</span></span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>        data_row_img_data <span class="op">=</span> pydicom.read_file(dcm_path)</span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extract the index of rows in &#39;data_df&#39; where the &#39;patientId&#39; matches the DICOM&#39;s &#39;PatientID&#39;.</span></span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">=</span> (data_df[<span class="st">&#39;patientId&#39;</span>] <span class="op">==</span> data_row_img_data.PatientID)</span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Update the corresponding columns in &#39;data_df&#39; with DICOM metadata extracted from &#39;data_row_img_data&#39;.</span></span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a>        data_df.loc[idx, <span class="st">&#39;Modality&#39;</span>] <span class="op">=</span> data_row_img_data.Modality</span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a>        data_df.loc[idx, <span class="st">&#39;PatientAge&#39;</span>] <span class="op">=</span> pd.to_numeric(data_row_img_data.PatientAge)</span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a>        data_df.loc[idx, <span class="st">&#39;PatientSex&#39;</span>] <span class="op">=</span> data_row_img_data.PatientSex</span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a>        data_df.loc[idx, <span class="st">&#39;BodyPartExamined&#39;</span>] <span class="op">=</span> data_row_img_data.BodyPartExamined</span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a>        data_df.loc[idx, <span class="st">&#39;ViewPosition&#39;</span>] <span class="op">=</span> data_row_img_data.ViewPosition</span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a>        data_df.loc[idx, <span class="st">&#39;ConversionType&#39;</span>] <span class="op">=</span> data_row_img_data.ConversionType</span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a>        data_df.loc[idx, <span class="st">&#39;Rows&#39;</span>] <span class="op">=</span> data_row_img_data.Rows</span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a>        data_df.loc[idx, <span class="st">&#39;Columns&#39;</span>] <span class="op">=</span> data_row_img_data.Columns</span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true" tabindex="-1"></a>        data_df.loc[idx, <span class="st">&#39;PixelSpacing&#39;</span>] <span class="op">=</span> <span class="bu">str</span>.<span class="bu">format</span>(<span class="st">&quot;</span><span class="sc">{:4.3f}</span><span class="st">&quot;</span>, data_row_img_data.PixelSpacing[<span class="dv">0</span>])</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="219"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:360,&quot;referenced_widgets&quot;:[&quot;b6b906af6efb45e8ba1f1489d0ad9327&quot;,&quot;c655ecbb5c0b460cadf067d1d7f50c26&quot;,&quot;4f3a655c2a0e452582739a7a76b304e9&quot;,&quot;bcad9d90959b4bcdaa2f14a85ce7d339&quot;,&quot;cb517686bc3c4396bef4fff3ab256634&quot;,&quot;2f5233aa40ba48fba1b79ab9631705de&quot;,&quot;abd3b05b402143c69c10d4a1a229b047&quot;,&quot;c51ad3c1f16149999c3899384fa8ab9a&quot;,&quot;f626e3d6ef334a6aa494b36cdb7a5ffe&quot;,&quot;349134afd4734846a776745c321f22f1&quot;,&quot;98da15a803aa4bb9a34fdadc1a407130&quot;]}"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:34:29.820958Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:34:29.820459Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:41:11.885804Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:41:11.884744Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:34:29.820917Z&quot;}"
id="pwZxZUxG6UCG" data-outputId="4db4878d-cd34-4b74-af70-f8c3d2c9ee78"
data-trusted="true">
<div class="sourceCode" id="cb64"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Process DICOM metadata for the DataFrame &#39;traindf&#39;.</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>process_dicom_data(traindf, trainImagesPath1)</span></code></pre></div>
<div class="output display_data">
<div class="sourceCode" id="cb65"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;62f0101b425c4769835dc31053e7593f&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
</div>
<div class="cell code" data-execution_count="220"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:44:07.157580Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:44:07.157130Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:44:07.173092Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:44:07.171544Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:44:07.157545Z&quot;}"
id="E6uf4z2e6XD5" data-trusted="true">
<div class="sourceCode" id="cb66"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the CSV file named &#39;sampleSubPath&#39; into a pandas DataFrame and store it in the variable &#39;testdf&#39;.</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The CSV file likely contains the submission data for a machine learning model, which typically includes </span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the predictions or probabilities for each test sample in a competition or evaluation task.</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that &#39;sampleSubPath&#39; should be the path to the CSV file containing the submission data.</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>testdf <span class="op">=</span> pd.read_csv(sampleSubPath)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="221"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:44:08.948502Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:44:08.948112Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:44:38.317985Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:44:38.316974Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:44:08.948469Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb67"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop the &#39;PredictionString&#39; column from the DataFrame &#39;testdf&#39; using the &#39;drop&#39; method with axis=1.</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;PredictionString&#39; column likely contains the predictions or detection information made by the model,</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="co"># which is no longer needed for further processing.</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>testdf <span class="op">=</span> testdf.drop(<span class="st">&#39;PredictionString&#39;</span>, <span class="dv">1</span>)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Call the function &#39;process_dicom_data&#39; with &#39;testdf&#39; and &#39;testImagesPath1&#39; as arguments.</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="co"># The function &#39;process_dicom_data&#39; processes the DICOM data in &#39;testdf&#39; by extracting relevant information</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="co"># from the DICOM files located in the directory specified by &#39;testImagesPath1&#39;.</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a><span class="co"># It populates specific columns in &#39;testdf&#39; with metadata information, such as &#39;Modality&#39;, &#39;PatientAge&#39;,</span></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;PatientSex&#39;, &#39;BodyPartExamined&#39;, &#39;ViewPosition&#39;, &#39;ConversionType&#39;, &#39;Rows&#39;, &#39;Columns&#39;, and &#39;PixelSpacing&#39;.</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>process_dicom_data(testdf, testImagesPath1)</span></code></pre></div>
<div class="output display_data">
<div class="sourceCode" id="cb68"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;3b950773d479448093a681236ccb960c&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
</div>
<div class="cell code" data-execution_count="222"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:44:39.686933Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:44:39.686160Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:44:39.702788Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:44:39.701603Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:44:39.686890Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb69"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>testdf.head() <span class="co">#Display top 5 rows of Test dataframe</span></span></code></pre></div>
<div class="output execute_result" data-execution_count="222">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>patientId</th>
      <th>Modality</th>
      <th>PatientAge</th>
      <th>PatientSex</th>
      <th>BodyPartExamined</th>
      <th>ViewPosition</th>
      <th>ConversionType</th>
      <th>Rows</th>
      <th>Columns</th>
      <th>PixelSpacing</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0000a175-0e68-4ca4-b1af-167204a7e0bc</td>
      <td>CR</td>
      <td>46</td>
      <td>F</td>
      <td>CHEST</td>
      <td>PA</td>
      <td>WSD</td>
      <td>1024</td>
      <td>1024</td>
      <td>0.194</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0005d3cc-3c3f-40b9-93c3-46231c3eb813</td>
      <td>CR</td>
      <td>22</td>
      <td>F</td>
      <td>CHEST</td>
      <td>PA</td>
      <td>WSD</td>
      <td>1024</td>
      <td>1024</td>
      <td>0.143</td>
    </tr>
    <tr>
      <th>2</th>
      <td>000686d7-f4fc-448d-97a0-44fa9c5d3aa6</td>
      <td>CR</td>
      <td>64</td>
      <td>M</td>
      <td>CHEST</td>
      <td>PA</td>
      <td>WSD</td>
      <td>1024</td>
      <td>1024</td>
      <td>0.143</td>
    </tr>
    <tr>
      <th>3</th>
      <td>000e3a7d-c0ca-4349-bb26-5af2d8993c3d</td>
      <td>CR</td>
      <td>75</td>
      <td>F</td>
      <td>CHEST</td>
      <td>PA</td>
      <td>WSD</td>
      <td>1024</td>
      <td>1024</td>
      <td>0.143</td>
    </tr>
    <tr>
      <th>4</th>
      <td>00100a24-854d-423d-a092-edcf6179e061</td>
      <td>CR</td>
      <td>66</td>
      <td>F</td>
      <td>CHEST</td>
      <td>AP</td>
      <td>WSD</td>
      <td>1024</td>
      <td>1024</td>
      <td>0.139</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell code" data-execution_count="223"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:44:41.827979Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:44:41.827599Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:44:41.843715Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:44:41.842552Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:44:41.827948Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb70"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Access the &#39;Modality&#39; column in the DataFrame &#39;traindf&#39; and call the &#39;unique()&#39; method on it.</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;unique()&#39; method returns an array containing all the unique values present in the &#39;Modality&#39; column.</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="co"># This operation provides insights into the different modalities used in the DICOM data.</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>traindf.Modality.unique()</span></code></pre></div>
<div class="output execute_result" data-execution_count="223">
<pre><code>array([&#39;CR&#39;], dtype=object)</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="224"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:44:43.180869Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:44:43.180489Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:44:43.188384Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:44:43.187430Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:44:43.180830Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb72"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Access the &#39;Modality&#39; column in the DataFrame &#39;testdf&#39; and call the &#39;unique()&#39; method on it.</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;unique()&#39; method returns an array containing all the unique values present in the &#39;Modality&#39; column.</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="co"># This operation provides insights into the different modalities used in the DICOM data.</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>testdf.Modality.unique()</span></code></pre></div>
<div class="output execute_result" data-execution_count="224">
<pre><code>array([&#39;CR&#39;], dtype=object)</code></pre>
</div>
</div>
<div class="cell markdown">
<p>The meaning of this modality is CR - Computer Radiography</p>
</div>
<section id="check-patient-age-value-counts" class="cell markdown">
<h4>Check Patient Age value counts</h4>
</section>
<div class="cell code" data-execution_count="225"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:44:45.560879Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:44:45.560499Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:44:45.586554Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:44:45.585582Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:44:45.560849Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb74"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Access the &#39;PatientAge&#39; column in the DataFrame &#39;traindf&#39; and call the &#39;value_counts()&#39; method on it.</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;value_counts()&#39; method returns a Series containing counts of unique values in the &#39;PatientAge&#39; column.</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="co"># It provides a distribution of the number of occurrences for each unique patient age in the dataset.</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>traindf[<span class="st">&#39;PatientAge&#39;</span>].value_counts()</span></code></pre></div>
<div class="output execute_result" data-execution_count="225">
<pre><code>58     955
56     869
52     791
55     767
54     717
      ... 
148      1
151      1
153      1
150      1
155      1
Name: PatientAge, Length: 97, dtype: int64</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="226"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:44:46.705671Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:44:46.704897Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:44:46.720290Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:44:46.719216Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:44:46.705627Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb76"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>traindf[<span class="st">&#39;PatientAge&#39;</span>].<span class="bu">max</span>()</span></code></pre></div>
<div class="output execute_result" data-execution_count="226">
<pre><code>155</code></pre>
</div>
</div>
<section id="155-could-be-a-typo-error-during-data-collection"
class="cell markdown">
<h4>155 could be a typo error during data collection</h4>
</section>
<div class="cell code" data-execution_count="227"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:44:48.529615Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:44:48.529224Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:44:48.547819Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:44:48.546749Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:44:48.529580Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb78"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>traindf[<span class="st">&#39;PatientAge&#39;</span>].<span class="bu">min</span>()</span></code></pre></div>
<div class="output execute_result" data-execution_count="227">
<pre><code>1</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="228"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:44:49.353982Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:44:49.353574Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:44:51.955513Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:44:51.954587Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:44:49.353950Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb80"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a figure and a single subplot using &#39;plt.subplots&#39; function.</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;fig&#39; will store the figure object, and &#39;ax&#39; will store the axes object.</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Set &#39;nrows=1&#39; to create a single row for subplots, and &#39;figsize=(16, 6)&#39; to adjust the figure size.</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">6</span>))</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a count plot using Seaborn&#39;s &#39;sns.countplot&#39; function.</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Set &#39;ax=ax&#39; to specify the axes object to draw the plot on.</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Use &#39;x&#39; for the &#39;PatientAge&#39; column on the x-axis and &#39;hue&#39; for the &#39;class&#39; column to distinguish classes.</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;data=traindf&#39; specifies the DataFrame containing the data to be plotted.</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;order=traindf[&#39;PatientAge&#39;].value_counts().index&#39; ensures the bars are ordered based on the count of ages.</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;palette&#39; argument is used to provide custom colors for each class.</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>sns.countplot(ax<span class="op">=</span>ax, x<span class="op">=</span><span class="st">&#39;PatientAge&#39;</span>, hue<span class="op">=</span><span class="st">&#39;class&#39;</span>, data<span class="op">=</span>traindf, order<span class="op">=</span>traindf[<span class="st">&#39;PatientAge&#39;</span>].value_counts().index,</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>              palette<span class="op">=</span>{<span class="st">&quot;Lung Opacity&quot;</span>: <span class="st">&quot;red&quot;</span>, <span class="st">&quot;Normal&quot;</span>: <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;No Lung Opacity / Not Normal&quot;</span>: <span class="st">&quot;green&quot;</span>})</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the title for the plot.</span></span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Train set: Age and Class&quot;</span>)</span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Rotate the x-axis labels by 90 degrees to improve readability.</span></span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Set labels for x and y-axis.</span></span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Patient Age&quot;</span>)</span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Count&quot;</span>)</span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Display a legend on the plot.</span></span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">&#39;Class&#39;</span>, loc<span class="op">=</span><span class="st">&#39;upper right&#39;</span>, labels<span class="op">=</span>[<span class="st">&#39;Lung Opacity&#39;</span>, <span class="st">&#39;Normal&#39;</span>, <span class="st">&#39;No Lung Opacity / Not Normal&#39;</span>])</span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Add grid lines to the plot for better readability.</span></span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a>plt.grid(axis<span class="op">=</span><span class="st">&#39;y&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the plot.</span></span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/7c93f49397e9a6559289fe5233fc8a8265b3fae7.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="229"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:44:51.958444Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:44:51.957733Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:44:54.221208Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:44:54.220296Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:44:51.958390Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb81"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a figure and a single subplot using &#39;plt.subplots&#39; function.</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;fig&#39; will store the figure object, and &#39;ax&#39; will store the axes object.</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Set &#39;nrows=1&#39; to create a single row for subplots, and &#39;figsize=(16, 6)&#39; to adjust the figure size.</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">6</span>))</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a count plot using Seaborn&#39;s &#39;sns.countplot&#39; function.</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Set &#39;ax=ax&#39; to specify the axes object to draw the plot on.</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Use &#39;x&#39; for the &#39;PatientAge&#39; column on the x-axis and &#39;hue&#39; for the &#39;Target&#39; column to distinguish the target values.</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;data=traindf&#39; specifies the DataFrame containing the data to be plotted.</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;order=traindf[&#39;PatientAge&#39;].value_counts().index&#39; ensures the bars are ordered based on the count of ages.</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>sns.countplot(ax<span class="op">=</span>ax, x<span class="op">=</span><span class="st">&#39;PatientAge&#39;</span>, hue<span class="op">=</span><span class="st">&#39;Target&#39;</span>, data<span class="op">=</span>traindf, order<span class="op">=</span>traindf[<span class="st">&#39;PatientAge&#39;</span>].value_counts().index)</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the title for the plot.</span></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Train set: Age and Target&quot;</span>)</span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Rotate the x-axis labels by 90 degrees to improve readability.</span></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Set labels for x and y-axis.</span></span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Patient Age&quot;</span>)</span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Count&quot;</span>)</span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Display a legend on the plot.</span></span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">&#39;Target&#39;</span>, loc<span class="op">=</span><span class="st">&#39;upper right&#39;</span>, labels<span class="op">=</span>[<span class="st">&#39;0 (Negative)&#39;</span>, <span class="st">&#39;1 (Positive)&#39;</span>])</span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Add grid lines to the plot for better readability.</span></span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a>plt.grid(axis<span class="op">=</span><span class="st">&#39;y&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the plot.</span></span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/7b778743fcdb6bc868ed66896770273d88c2f555.png" /></p>
</div>
</div>
<section
id="most-of-the-data-has-been-captured-for-age-group-between-40-to-50-there-is-an-outlier-with-age-151-there-are-very-few-data-points-for-age-group-between-1-to-5-and-80-to-90"
class="cell markdown">
<h4>Most of the data has been captured for age group between 40 to 50.
There is an outlier with age 151. There are very few data points for age
group between 1 to 5 and 80 to 90.</h4>
</section>
<div class="cell code" data-execution_count="230"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:44:54.225872Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:44:54.224210Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:44:55.668008Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:44:55.666876Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:44:54.225803Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb82"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a figure and a single subplot using &#39;plt.subplots&#39; function.</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;fig&#39; will store the figure object, and &#39;ax&#39; will store the axes object.</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Set &#39;nrows=1&#39; to create a single row for subplots, and &#39;figsize=(16, 6)&#39; to adjust the figure size.</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">6</span>))</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a count plot using Seaborn&#39;s &#39;sns.countplot&#39; function.</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Set &#39;ax=ax&#39; to specify the axes object to draw the plot on.</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Use &#39;x&#39; for the &#39;PatientAge&#39; column on the x-axis.</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;data=testdf&#39; specifies the DataFrame containing the data to be plotted.</span></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;order=testdf[&#39;PatientAge&#39;].value_counts().index&#39; ensures the bars are ordered based on the count of ages.</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>sns.countplot(ax<span class="op">=</span>ax, x<span class="op">=</span><span class="st">&#39;PatientAge&#39;</span>, data<span class="op">=</span>testdf, order<span class="op">=</span>testdf[<span class="st">&#39;PatientAge&#39;</span>].value_counts().index)</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the title for the plot.</span></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Test set: Age and Target&quot;</span>)</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Rotate the x-axis labels by 90 degrees to improve readability.</span></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Set labels for x and y-axis.</span></span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Patient Age&quot;</span>)</span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Count&quot;</span>)</span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Add grid lines to the plot for better readability.</span></span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;axis=&#39;y&#39;&#39; specifies that we want to add grid lines along the y-axis.</span></span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;linestyle=&#39;--&#39;&#39; sets the style of grid lines to dashed lines, and &#39;alpha=0.7&#39; sets the transparency level of the grid lines.</span></span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a>plt.grid(axis<span class="op">=</span><span class="st">&#39;y&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-28"><a href="#cb82-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the plot.</span></span>
<span id="cb82-29"><a href="#cb82-29" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/fbcd3ae75dce2bfedcb9b5330d74a09d14c2d34c.png" /></p>
</div>
</div>
<section
id="in-test-set-also-similar-kind-of-behaviour-observed-in-data-among-different-age-groups-outlier-with-age-412"
class="cell markdown">
<h4>In test set also similar kind of behaviour observed in data among
different age groups. Outlier with Age 412</h4>
</section>
<section id="let-us-check-patientsex-feature" class="cell markdown">
<h4>Let us check PatientSex feature</h4>
</section>
<div class="cell code" data-execution_count="231"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:44:55.674493Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:44:55.674115Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:44:55.686108Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:44:55.684989Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:44:55.674462Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb83"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>traindf[<span class="st">&#39;PatientSex&#39;</span>].value_counts()</span></code></pre></div>
<div class="output execute_result" data-execution_count="231">
<pre><code>M    17216
F    13011
Name: PatientSex, dtype: int64</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="232"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:44:56.237345Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:44:56.237004Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:44:56.245901Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:44:56.244817Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:44:56.237314Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb85"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>testdf[<span class="st">&#39;PatientSex&#39;</span>].value_counts()</span></code></pre></div>
<div class="output execute_result" data-execution_count="232">
<pre><code>M    1714
F    1286
Name: PatientSex, dtype: int64</code></pre>
</div>
</div>
<section
id="most-of-the-data-points-for-male-gender-both-in-traing-and-testing-set-"
class="cell markdown">
<h4>Most of the data points for Male gender both in traing and testing
set .</h4>
</section>
<div class="cell code" data-execution_count="233"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:44:57.402518Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:44:57.401176Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:44:57.747274Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:44:57.746330Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:44:57.402470Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb87"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The code will create a single subplot figure with 1 row and 1 column, using &#39;plt.subplots()&#39;.</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The subplot figure will have a size of 10 inches in width and 5 inches in height.</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>fig, (ax) <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;sns.countplot()&#39; function is used to create a countplot on the subplot.</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;x&#39; parameter is set to &#39;PatientSex&#39;, which represents the column in the &#39;traindf&#39; DataFrame that contains gender information.</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;hue&#39; parameter is set to &#39;Target&#39;, which represents the column that contains the target variable (0 or 1) for each patient.</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;data&#39; parameter is set to &#39;traindf&#39;, indicating that the data for the plot will be taken from the &#39;traindf&#39; DataFrame.</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>sns.countplot(ax<span class="op">=</span>ax, x<span class="op">=</span><span class="st">&#39;PatientSex&#39;</span>, hue<span class="op">=</span><span class="st">&#39;Target&#39;</span>, data<span class="op">=</span>traindf)</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;plt.title()&#39; function is used to set the title of the plot to &quot;Train set: Gender and Target&quot;.</span></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Train set: Gender and Target&quot;</span>)</span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Finally, &#39;plt.show()&#39; is called to display the plot.</span></span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/a2845e9f43963812a831b08499ea4bfc513b5ec2.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="234"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:44:57.974572Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:44:57.973817Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:44:58.271414Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:44:58.270369Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:44:57.974529Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb88"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The code will create a single subplot figure with 1 row and 1 column, using &#39;plt.subplots()&#39;.</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The subplot figure will have a size of 10 inches in width and 5 inches in height.</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>fig, (ax) <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;sns.countplot()&#39; function is used to create a countplot on the subplot.</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;x&#39; parameter is set to &#39;PatientSex&#39;, which represents the column in the &#39;testdf&#39; DataFrame that contains gender information.</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;data&#39; parameter is set to &#39;testdf&#39;, indicating that the data for the plot will be taken from the &#39;testdf&#39; DataFrame.</span></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>sns.countplot(ax<span class="op">=</span>ax, x<span class="op">=</span><span class="st">&#39;PatientSex&#39;</span>, data<span class="op">=</span>testdf)</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;plt.title()&#39; function is used to set the title of the plot to &quot;Test set: Gender and Target&quot;.</span></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Test set: Gender and Target&quot;</span>)</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Finally, &#39;plt.show()&#39; is called to display the plot.</span></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/53e5e468cd96a3ceee99054686eddf170d6378cc.png" /></p>
</div>
</div>
<section id="let-us-examine-bodypartexamined-feature"
class="cell markdown">
<h4>Let us examine BodyPartExamined feature</h4>
</section>
<div class="cell code" data-execution_count="235"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:44:59.523544Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:44:59.522779Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:44:59.539545Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:44:59.538187Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:44:59.523501Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb89"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>traindf[<span class="st">&#39;BodyPartExamined&#39;</span>].value_counts()</span></code></pre></div>
<div class="output execute_result" data-execution_count="235">
<pre><code>CHEST    30227
Name: BodyPartExamined, dtype: int64</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="236"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:44:59.964199Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:44:59.963852Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:44:59.973145Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:44:59.972191Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:44:59.964166Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb91"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>testdf[<span class="st">&#39;BodyPartExamined&#39;</span>].value_counts()</span></code></pre></div>
<div class="output execute_result" data-execution_count="236">
<pre><code>CHEST    3000
Name: BodyPartExamined, dtype: int64</code></pre>
</div>
</div>
<div class="cell markdown">
<p>Unique values found for this column</p>
</div>
<section id="let-us-check-conversiontype-feature" class="cell markdown">
<h4>Let us check ConversionType feature</h4>
</section>
<div class="cell code" data-execution_count="237"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:45:02.146156Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:45:02.145599Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:45:02.166236Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:45:02.165124Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:45:02.146114Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb93"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>traindf[<span class="st">&#39;ConversionType&#39;</span>].value_counts()</span></code></pre></div>
<div class="output execute_result" data-execution_count="237">
<pre><code>WSD    30227
Name: ConversionType, dtype: int64</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="238"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:45:02.812581Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:45:02.812208Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:45:02.823658Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:45:02.822522Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:45:02.812548Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb95"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>testdf[<span class="st">&#39;ConversionType&#39;</span>].value_counts()</span></code></pre></div>
<div class="output execute_result" data-execution_count="238">
<pre><code>WSD    3000
Name: ConversionType, dtype: int64</code></pre>
</div>
</div>
<div class="cell markdown">
<p>Unique values found for this column</p>
</div>
<section id="let-us-review-rows-feature" class="cell markdown">
<h4>Let us review Rows feature</h4>
</section>
<div class="cell code" data-execution_count="239"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:45:05.052823Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:45:05.052457Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:45:05.066976Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:45:05.065717Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:45:05.052792Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb97"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>traindf[<span class="st">&#39;Rows&#39;</span>].value_counts()</span></code></pre></div>
<div class="output execute_result" data-execution_count="239">
<pre><code>1024    30227
Name: Rows, dtype: int64</code></pre>
</div>
</div>
<div class="cell markdown">
<p>Let us review Columns feature</p>
</div>
<div class="cell code" data-execution_count="240"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:45:06.451691Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:45:06.449380Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:45:06.465261Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:45:06.463942Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:45:06.451650Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb99"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>traindf[<span class="st">&#39;Columns&#39;</span>].value_counts()</span></code></pre></div>
<div class="output execute_result" data-execution_count="240">
<pre><code>1024    30227
Name: Columns, dtype: int64</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="241"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:45:07.147615Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:45:07.147242Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:45:07.157937Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:45:07.156924Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:45:07.147584Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb101"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>testdf[<span class="st">&#39;Rows&#39;</span>].value_counts(),testdf[<span class="st">&#39;Columns&#39;</span>].value_counts()</span></code></pre></div>
<div class="output execute_result" data-execution_count="241">
<pre><code>(1024    3000
 Name: Rows, dtype: int64,
 1024    3000
 Name: Columns, dtype: int64)</code></pre>
</div>
</div>
<div class="cell markdown">
<p>Unique values found.</p>
</div>
<div class="cell markdown">
<p>Let us check ViewPosition</p>
</div>
<div class="cell code" data-execution_count="242"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:45:09.332351Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:45:09.331992Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:45:09.349583Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:45:09.348533Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:45:09.332319Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb103"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>traindf[<span class="st">&#39;ViewPosition&#39;</span>].value_counts()</span></code></pre></div>
<div class="output execute_result" data-execution_count="242">
<pre><code>AP    15297
PA    14930
Name: ViewPosition, dtype: int64</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="243"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:45:09.972541Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:45:09.972189Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:45:10.331551Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:45:10.330090Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:45:09.972512Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb105"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a countplot to visualize the distribution of &#39;ViewPosition&#39; column in the &#39;traindf&#39; DataFrame.</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The countplot will be color-coded by the &#39;Target&#39; column, representing the target label (0 or 1) in the dataset.</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;x&#39; parameter is set to &#39;ViewPosition&#39;, indicating that the values of the &#39;ViewPosition&#39; column will be displayed on the x-axis.</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;hue&#39; parameter is set to &#39;Target&#39;, indicating that the color of each bar will be determined by the corresponding &#39;Target&#39; value.</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;data&#39; parameter is set to &#39;traindf&#39;, specifying that the data for the plot will be taken from the &#39;traindf&#39; DataFrame.</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.countplot(x<span class="op">=</span><span class="st">&#39;ViewPosition&#39;</span>, hue<span class="op">=</span><span class="st">&#39;Target&#39;</span>, data<span class="op">=</span>traindf)</span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize the appearance of the plot</span></span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Distribution of ViewPosition and Target in Train Set&quot;</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;View Position&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Count&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Add annotations above each bar to display the exact count for each category and target class.</span></span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a><span class="co"># The code iterates through each bar and its associated data to add text annotations above the bars.</span></span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> ax.patches:</span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a>    height <span class="op">=</span> p.get_height()</span>
<span id="cb105-17"><a href="#cb105-17" aria-hidden="true" tabindex="-1"></a>    ax.annotate(<span class="ss">f&#39;</span><span class="sc">{</span><span class="bu">int</span>(height)<span class="sc">}</span><span class="ss">&#39;</span>, (p.get_x() <span class="op">+</span> p.get_width() <span class="op">/</span> <span class="dv">2</span>, height), ha<span class="op">=</span><span class="st">&#39;center&#39;</span>, va<span class="op">=</span><span class="st">&#39;bottom&#39;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb105-18"><a href="#cb105-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-19"><a href="#cb105-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a legend to describe the color coding for the &#39;Target&#39; classes.</span></span>
<span id="cb105-20"><a href="#cb105-20" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">&quot;Target&quot;</span>, labels<span class="op">=</span>[<span class="st">&#39;Negative (0)&#39;</span>, <span class="st">&#39;Positive (1)&#39;</span>])</span>
<span id="cb105-21"><a href="#cb105-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-22"><a href="#cb105-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the plot</span></span>
<span id="cb105-23"><a href="#cb105-23" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/e594384b88fd109d60ad84029264595da922506d.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="244"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:45:10.660938Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:45:10.660619Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:45:11.200286Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:45:11.198633Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:45:10.660909Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb106"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a countplot to visualize the distribution of &#39;ViewPosition&#39; column in the &#39;traindf&#39; DataFrame.</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The countplot will be color-coded by the &#39;class&#39; column, representing the class label (Normal, Lung Opacity, or No Lung Opacity / Not Normal) in the dataset.</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;x&#39; parameter is set to &#39;ViewPosition&#39;, indicating that the values of the &#39;ViewPosition&#39; column will be displayed on the x-axis.</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;hue&#39; parameter is set to &#39;class&#39;, indicating that the color of each bar will be determined by the corresponding &#39;class&#39; value.</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;data&#39; parameter is set to &#39;traindf&#39;, specifying that the data for the plot will be taken from the &#39;traindf&#39; DataFrame.</span></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>sns.countplot(x<span class="op">=</span><span class="st">&#39;ViewPosition&#39;</span>, hue<span class="op">=</span><span class="st">&#39;class&#39;</span>, data<span class="op">=</span>traindf, ax<span class="op">=</span>ax)</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize the appearance of the plot</span></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Distribution of ViewPosition and Class in Train Set&quot;</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;View Position&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Count&quot;</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Rotate the x-axis labels to avoid overlapping</span></span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, ha<span class="op">=</span><span class="st">&#39;right&#39;</span>)</span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Add annotations above each bar to display the exact count for each category and class.</span></span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a><span class="co"># The code iterates through each bar and its associated data to add text annotations above the bars.</span></span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> ax.patches:</span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a>    height <span class="op">=</span> p.get_height()</span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a>    ax.annotate(<span class="ss">f&#39;</span><span class="sc">{</span><span class="bu">int</span>(height)<span class="sc">}</span><span class="ss">&#39;</span>, (p.get_x() <span class="op">+</span> p.get_width() <span class="op">/</span> <span class="dv">2</span>, height), ha<span class="op">=</span><span class="st">&#39;center&#39;</span>, va<span class="op">=</span><span class="st">&#39;bottom&#39;</span>, fontsize<span class="op">=</span><span class="dv">8</span>, xytext<span class="op">=</span>(<span class="dv">0</span>, <span class="dv">5</span>), textcoords<span class="op">=</span><span class="st">&#39;offset points&#39;</span>)</span>
<span id="cb106-22"><a href="#cb106-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-23"><a href="#cb106-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a legend to describe the color coding for the &#39;class&#39; labels.</span></span>
<span id="cb106-24"><a href="#cb106-24" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">&quot;Class&quot;</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb106-25"><a href="#cb106-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-26"><a href="#cb106-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the plot</span></span>
<span id="cb106-27"><a href="#cb106-27" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb106-28"><a href="#cb106-28" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/7b874e7088148f0500e19223985d5456b4eb4eb9.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="245"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:45:11.305341Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:45:11.304723Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:45:11.331826Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:45:11.330728Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:45:11.305288Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb107"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a label_encoder object from the LabelEncoder class.</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The label_encoder object is used to transform the categorical data in the &#39;ViewPosition&#39; column into numerical labels.</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The LabelEncoder class is designed to convert categorical text data (words) into numerical representations.</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>label_encoder <span class="op">=</span> preprocessing.LabelEncoder()</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the label_encoder object to encode the &#39;ViewPosition&#39; column in the &#39;traindf&#39; DataFrame.</span></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a><span class="co"># The label_encoder.fit_transform() method applies the encoding transformation to the column and returns the encoded numerical labels.</span></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a><span class="co"># The numerical labels represent each unique value in the &#39;ViewPosition&#39; column.</span></span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>traindf[<span class="st">&#39;ViewPosition&#39;</span>] <span class="op">=</span> label_encoder.fit_transform(traindf[<span class="st">&#39;ViewPosition&#39;</span>])</span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the unique classes (categories) that were encoded by the label_encoder object.</span></span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a><span class="co"># The label_encoder.classes_ attribute contains the original unique values in the &#39;ViewPosition&#39; column, which have been transformed into numerical labels.</span></span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(label_encoder.classes_)</span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the unique values in the &#39;ViewPosition&#39; column after the encoding process.</span></span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;ViewPosition&#39; column now contains numerical labels instead of the original categorical text values.</span></span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Each unique numerical label corresponds to a specific class in the &#39;ViewPosition&#39; column.</span></span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(traindf[<span class="st">&#39;ViewPosition&#39;</span>].unique())</span></code></pre></div>
<div class="output stream stdout">
<pre><code>[&#39;AP&#39; &#39;PA&#39;]
[1 0]
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="246"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:45:12.101172Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:45:12.100536Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:45:12.569845Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:45:12.568556Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:45:12.101131Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb109"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Increase the figure size for better visualization</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the countplot with &#39;ViewPosition&#39; on the x-axis and &#39;class&#39; on the hue for color differentiation.</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>sns.countplot(x<span class="op">=</span><span class="st">&#39;ViewPosition&#39;</span>, hue<span class="op">=</span><span class="st">&#39;class&#39;</span>, data<span class="op">=</span>traindf)</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Set a title for the plot</span></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Distribution of &#39;ViewPosition&#39; by &#39;class&#39;&quot;</span>)</span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Move the legend to the middle to avoid overlapping with the bars</span></span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">&#39;upper right&#39;</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.15</span>), ncol<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Add annotations for the counts above the bars</span></span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> plt.gca().patches:</span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a>    height <span class="op">=</span> p.get_height()</span>
<span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a>    plt.gca().annotate(<span class="ss">f&#39;</span><span class="sc">{</span><span class="bu">int</span>(height)<span class="sc">}</span><span class="ss">&#39;</span>, (p.get_x() <span class="op">+</span> p.get_width() <span class="op">/</span> <span class="dv">2</span>, height),</span>
<span id="cb109-17"><a href="#cb109-17" aria-hidden="true" tabindex="-1"></a>                       ha<span class="op">=</span><span class="st">&#39;center&#39;</span>, va<span class="op">=</span><span class="st">&#39;bottom&#39;</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb109-18"><a href="#cb109-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-19"><a href="#cb109-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Set labels for x and y axes</span></span>
<span id="cb109-20"><a href="#cb109-20" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;ViewPosition&#39;</span>)</span>
<span id="cb109-21"><a href="#cb109-21" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Count&#39;</span>)</span>
<span id="cb109-22"><a href="#cb109-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-23"><a href="#cb109-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the layout to avoid overlapping</span></span>
<span id="cb109-24"><a href="#cb109-24" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb109-25"><a href="#cb109-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-26"><a href="#cb109-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plot</span></span>
<span id="cb109-27"><a href="#cb109-27" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/d3f0ec1a679d82ac72172f9474fbd303b398d006.png" /></p>
</div>
</div>
<div class="cell markdown">
<p>AP-AnteriorPosterior=0 PA-PostereiorAterior=1</p>
</div>
<div class="cell code" data-execution_count="247"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:45:13.668897Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:45:13.668528Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:45:13.682732Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:45:13.681736Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:45:13.668865Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb110"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>testdf[<span class="st">&#39;ViewPosition&#39;</span>].value_counts()</span></code></pre></div>
<div class="output execute_result" data-execution_count="247">
<pre><code>PA    1618
AP    1382
Name: ViewPosition, dtype: int64</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="248"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:45:14.344864Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:45:14.344524Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:45:14.355369Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:45:14.354294Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:45:14.344837Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb112"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a label_encoder object, which is used to encode categorical labels as integer values.</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>label_encoder <span class="op">=</span> preprocessing.LabelEncoder()</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use label_encoder to transform the &#39;ViewPosition&#39; column in the test dataframe from categorical labels to numerical values.</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a><span class="co"># This step is necessary for many machine learning algorithms that cannot handle categorical data directly.</span></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>testdf[<span class="st">&#39;ViewPosition&#39;</span>] <span class="op">=</span> label_encoder.fit_transform(testdf[<span class="st">&#39;ViewPosition&#39;</span>])</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the classes that have been encoded to understand the mapping of numerical values to original categories.</span></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(label_encoder.classes_)</span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the unique numerical values of the &#39;ViewPosition&#39; column after label encoding.</span></span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>testdf[<span class="st">&#39;ViewPosition&#39;</span>].unique()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>[&#39;AP&#39; &#39;PA&#39;]
</code></pre>
</div>
<div class="output execute_result" data-execution_count="248">
<pre><code>array([1, 0])</code></pre>
</div>
</div>
<div class="cell markdown">
<p>Let us explore PixelSpacing feature</p>
</div>
<div class="cell code" data-execution_count="249"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:45:16.076965Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:45:16.076552Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:45:16.094956Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:45:16.093948Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:45:16.076931Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb115"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>traindf[<span class="st">&#39;PixelSpacing&#39;</span>].value_counts()</span></code></pre></div>
<div class="output execute_result" data-execution_count="249">
<pre><code>0.168    10677
0.143     9221
0.139     6585
0.171     2351
0.194     1380
0.115        8
0.199        5
Name: PixelSpacing, dtype: int64</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="250"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:45:16.348960Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:45:16.348403Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:45:17.754313Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:45:17.753281Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:45:16.348932Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb117"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a count plot for &#39;PixelSpacing&#39; column with &#39;class&#39; as hue using Seaborn&#39;s &#39;countplot&#39; function.</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the figure size to (12, 6) to make the plot larger and avoid overlapping of labels.</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Use Seaborn&#39;s &#39;countplot&#39; function to create the count plot.</span></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>sns.countplot(x<span class="op">=</span><span class="st">&#39;PixelSpacing&#39;</span>, hue<span class="op">=</span><span class="st">&#39;class&#39;</span>, data<span class="op">=</span>traindf, ax<span class="op">=</span>ax)</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the title for the plot.</span></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Distribution of &#39;PixelSpacing&#39; with respect to &#39;class&#39;&quot;</span>)</span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Rotate the x-axis labels to prevent overlapping.</span></span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-14"><a href="#cb117-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a legend to the plot to show the mapping of hue colors to &#39;class&#39; labels.</span></span>
<span id="cb117-15"><a href="#cb117-15" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">&#39;Class&#39;</span>, loc<span class="op">=</span><span class="st">&#39;upper right&#39;</span>)</span>
<span id="cb117-16"><a href="#cb117-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-17"><a href="#cb117-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plot.</span></span>
<span id="cb117-18"><a href="#cb117-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/e5378212b7c58472eb6033d7785e6123ea49dbad.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="251"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:45:17.757692Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:45:17.756468Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:45:18.214456Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:45:18.213326Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:45:17.757654Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb118"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a count plot for &#39;PixelSpacing&#39; column with &#39;Target&#39; as hue using Seaborn&#39;s &#39;countplot&#39; function.</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the figure size to (12, 6) to make the plot larger and avoid overlapping of labels.</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Use Seaborn&#39;s &#39;countplot&#39; function to create the count plot.</span></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>sns.countplot(x<span class="op">=</span><span class="st">&#39;PixelSpacing&#39;</span>, hue<span class="op">=</span><span class="st">&#39;Target&#39;</span>, data<span class="op">=</span>traindf, ax<span class="op">=</span>ax)</span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the title for the plot.</span></span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Distribution of &#39;PixelSpacing&#39; with respect to &#39;Target&#39;&quot;</span>)</span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Rotate the x-axis labels to prevent overlapping.</span></span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-14"><a href="#cb118-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a legend to the plot to show the mapping of hue colors to &#39;Target&#39; labels.</span></span>
<span id="cb118-15"><a href="#cb118-15" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">&#39;Target&#39;</span>, loc<span class="op">=</span><span class="st">&#39;upper right&#39;</span>)</span>
<span id="cb118-16"><a href="#cb118-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-17"><a href="#cb118-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plot.</span></span>
<span id="cb118-18"><a href="#cb118-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/65e972a6aa2ea2a417a77a03d48e76f991964d16.png" /></p>
</div>
</div>
<div class="cell markdown">
<p>0.115 Pixel spacing is for age between 2-11 years. and 0.199 is from
20-35 age group. we have very less data points for this.</p>
</div>
<div class="cell code" data-execution_count="252"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:45:18.572348Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:45:18.569989Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:45:18.612085Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:45:18.611064Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:45:18.572312Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb119"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>traindf[traindf[<span class="st">&#39;PixelSpacing&#39;</span>]<span class="op">==</span><span class="st">&#39;0.199&#39;</span>]</span></code></pre></div>
<div class="output execute_result" data-execution_count="252">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>patientId</th>
      <th>x</th>
      <th>y</th>
      <th>width</th>
      <th>height</th>
      <th>Target</th>
      <th>class</th>
      <th>Modality</th>
      <th>PatientAge</th>
      <th>PatientSex</th>
      <th>BodyPartExamined</th>
      <th>ViewPosition</th>
      <th>ConversionType</th>
      <th>Rows</th>
      <th>Columns</th>
      <th>PixelSpacing</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>673</th>
      <td>09714ab6-5dce-4ded-94cc-f79a47b4b171</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>No Lung Opacity / Not Normal</td>
      <td>CR</td>
      <td>25</td>
      <td>M</td>
      <td>CHEST</td>
      <td>0</td>
      <td>WSD</td>
      <td>1024</td>
      <td>1024</td>
      <td>0.199</td>
    </tr>
    <tr>
      <th>16521</th>
      <td>9fae656b-cf66-4c4b-a5ed-1962ebcafb7d</td>
      <td>651.0</td>
      <td>346.0</td>
      <td>275.0</td>
      <td>210.0</td>
      <td>1</td>
      <td>Lung Opacity</td>
      <td>CR</td>
      <td>38</td>
      <td>M</td>
      <td>CHEST</td>
      <td>0</td>
      <td>WSD</td>
      <td>1024</td>
      <td>1024</td>
      <td>0.199</td>
    </tr>
    <tr>
      <th>16522</th>
      <td>9fae656b-cf66-4c4b-a5ed-1962ebcafb7d</td>
      <td>262.0</td>
      <td>354.0</td>
      <td>240.0</td>
      <td>156.0</td>
      <td>1</td>
      <td>Lung Opacity</td>
      <td>CR</td>
      <td>38</td>
      <td>M</td>
      <td>CHEST</td>
      <td>0</td>
      <td>WSD</td>
      <td>1024</td>
      <td>1024</td>
      <td>0.199</td>
    </tr>
    <tr>
      <th>20838</th>
      <td>bda68f49-6eb2-4afa-86bf-89a3d4378100</td>
      <td>634.0</td>
      <td>436.0</td>
      <td>217.0</td>
      <td>167.0</td>
      <td>1</td>
      <td>Lung Opacity</td>
      <td>CR</td>
      <td>23</td>
      <td>F</td>
      <td>CHEST</td>
      <td>0</td>
      <td>WSD</td>
      <td>1024</td>
      <td>1024</td>
      <td>0.199</td>
    </tr>
    <tr>
      <th>20839</th>
      <td>bda68f49-6eb2-4afa-86bf-89a3d4378100</td>
      <td>389.0</td>
      <td>395.0</td>
      <td>142.0</td>
      <td>181.0</td>
      <td>1</td>
      <td>Lung Opacity</td>
      <td>CR</td>
      <td>23</td>
      <td>F</td>
      <td>CHEST</td>
      <td>0</td>
      <td>WSD</td>
      <td>1024</td>
      <td>1024</td>
      <td>0.199</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell code" data-execution_count="253"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:45:19.303875Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:45:19.303219Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:45:19.335304Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:45:19.334399Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:45:19.303841Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb120"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>traindf[traindf[<span class="st">&#39;PixelSpacing&#39;</span>]<span class="op">==</span><span class="st">&#39;0.115&#39;</span>]</span></code></pre></div>
<div class="output execute_result" data-execution_count="253">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>patientId</th>
      <th>x</th>
      <th>y</th>
      <th>width</th>
      <th>height</th>
      <th>Target</th>
      <th>class</th>
      <th>Modality</th>
      <th>PatientAge</th>
      <th>PatientSex</th>
      <th>BodyPartExamined</th>
      <th>ViewPosition</th>
      <th>ConversionType</th>
      <th>Rows</th>
      <th>Columns</th>
      <th>PixelSpacing</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>9834</th>
      <td>6a8a2a9b-b22e-471a-8b90-3c5f6496cee6</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>Normal</td>
      <td>CR</td>
      <td>6</td>
      <td>M</td>
      <td>CHEST</td>
      <td>1</td>
      <td>WSD</td>
      <td>1024</td>
      <td>1024</td>
      <td>0.115</td>
    </tr>
    <tr>
      <th>15480</th>
      <td>9746c15f-94d1-4528-aff0-8ef02ccccef0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>No Lung Opacity / Not Normal</td>
      <td>CR</td>
      <td>2</td>
      <td>F</td>
      <td>CHEST</td>
      <td>0</td>
      <td>WSD</td>
      <td>1024</td>
      <td>1024</td>
      <td>0.115</td>
    </tr>
    <tr>
      <th>17741</th>
      <td>a8f16478-b36a-4bc9-ac8a-75477d8ea168</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>No Lung Opacity / Not Normal</td>
      <td>CR</td>
      <td>5</td>
      <td>F</td>
      <td>CHEST</td>
      <td>1</td>
      <td>WSD</td>
      <td>1024</td>
      <td>1024</td>
      <td>0.115</td>
    </tr>
    <tr>
      <th>21089</th>
      <td>bf494059-4fe2-4f8f-a503-c340105e56ce</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>Normal</td>
      <td>CR</td>
      <td>4</td>
      <td>M</td>
      <td>CHEST</td>
      <td>1</td>
      <td>WSD</td>
      <td>1024</td>
      <td>1024</td>
      <td>0.115</td>
    </tr>
    <tr>
      <th>22215</th>
      <td>c908770d-5bb8-479e-9112-ff9c47d07277</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>No Lung Opacity / Not Normal</td>
      <td>CR</td>
      <td>11</td>
      <td>F</td>
      <td>CHEST</td>
      <td>0</td>
      <td>WSD</td>
      <td>1024</td>
      <td>1024</td>
      <td>0.115</td>
    </tr>
    <tr>
      <th>24190</th>
      <td>d9728525-2c4b-4526-bbf7-873831872a20</td>
      <td>227.0</td>
      <td>474.0</td>
      <td>250.0</td>
      <td>200.0</td>
      <td>1</td>
      <td>Lung Opacity</td>
      <td>CR</td>
      <td>7</td>
      <td>F</td>
      <td>CHEST</td>
      <td>0</td>
      <td>WSD</td>
      <td>1024</td>
      <td>1024</td>
      <td>0.115</td>
    </tr>
    <tr>
      <th>26339</th>
      <td>eb2225b3-b09e-408c-8c48-27b1bad103a9</td>
      <td>265.0</td>
      <td>643.0</td>
      <td>125.0</td>
      <td>102.0</td>
      <td>1</td>
      <td>Lung Opacity</td>
      <td>CR</td>
      <td>4</td>
      <td>M</td>
      <td>CHEST</td>
      <td>0</td>
      <td>WSD</td>
      <td>1024</td>
      <td>1024</td>
      <td>0.115</td>
    </tr>
    <tr>
      <th>28660</th>
      <td>fd6f8775-392d-4f85-bc25-398c02a30678</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>Normal</td>
      <td>CR</td>
      <td>7</td>
      <td>M</td>
      <td>CHEST</td>
      <td>0</td>
      <td>WSD</td>
      <td>1024</td>
      <td>1024</td>
      <td>0.115</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell code" data-execution_count="254"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:45:20.153103Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:45:20.152714Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:45:20.175222Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:45:20.174306Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:45:20.153073Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb121"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop specified columns from the &#39;traindf&#39; DataFrame.</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The columns to be dropped are &#39;Modality&#39;, &#39;ConversionType&#39;, &#39;BodyPartExamined&#39;, &#39;Rows&#39;, and &#39;Columns&#39;.</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The DataFrame will be updated in place, and the specified columns will be removed.</span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>traindf <span class="op">=</span> traindf.drop([<span class="st">&#39;Modality&#39;</span>, <span class="st">&#39;ConversionType&#39;</span>, <span class="st">&#39;BodyPartExamined&#39;</span>, <span class="st">&#39;Rows&#39;</span>, <span class="st">&#39;Columns&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="255"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:45:20.963925Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:45:20.963551Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:45:20.970914Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:45:20.969624Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:45:20.963896Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb122"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop specified columns from the &#39;testdf&#39; DataFrame.</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The columns to be dropped are &#39;Modality&#39;, &#39;ConversionType&#39;, &#39;BodyPartExamined&#39;, &#39;Rows&#39;, and &#39;Columns&#39;.</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The DataFrame will be updated in place, and the specified columns will be removed.</span></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>testdf <span class="op">=</span> testdf.drop([<span class="st">&#39;Modality&#39;</span>, <span class="st">&#39;ConversionType&#39;</span>, <span class="st">&#39;BodyPartExamined&#39;</span>, <span class="st">&#39;Rows&#39;</span>, <span class="st">&#39;Columns&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="256"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:45:21.718657Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:45:21.717931Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:45:21.781101Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:45:21.780082Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:45:21.718616Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb123"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>traindf.info()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 30227 entries, 0 to 30226
Data columns (total 11 columns):
 #   Column        Non-Null Count  Dtype  
---  ------        --------------  -----  
 0   patientId     30227 non-null  object 
 1   x             9555 non-null   float64
 2   y             9555 non-null   float64
 3   width         9555 non-null   float64
 4   height        9555 non-null   float64
 5   Target        30227 non-null  int64  
 6   class         30227 non-null  object 
 7   PatientAge    30227 non-null  object 
 8   PatientSex    30227 non-null  object 
 9   ViewPosition  30227 non-null  int64  
 10  PixelSpacing  30227 non-null  object 
dtypes: float64(4), int64(2), object(5)
memory usage: 2.8+ MB
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="257"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:45:22.418713Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:45:22.417981Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:45:22.436527Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:45:22.435442Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:45:22.418673Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb125"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>traindf[traindf[<span class="st">&#39;PatientAge&#39;</span>].isna()]</span></code></pre></div>
<div class="output execute_result" data-execution_count="257">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>patientId</th>
      <th>x</th>
      <th>y</th>
      <th>width</th>
      <th>height</th>
      <th>Target</th>
      <th>class</th>
      <th>PatientAge</th>
      <th>PatientSex</th>
      <th>ViewPosition</th>
      <th>PixelSpacing</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell code" data-execution_count="258"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:45:23.097014Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:45:23.096608Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:45:23.621331Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:45:23.620255Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:45:23.096978Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb126"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the correlation matrix for the &#39;traindf&#39; DataFrame.</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The correlation matrix shows the pairwise correlation between numerical columns.</span></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>correlation_matrix <span class="op">=</span> traindf.corr()</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up the figure and axis for the heatmap plot.</span></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the heatmap using the correlation matrix.</span></span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;cmap&#39; parameter sets the color map for the heatmap (e.g., &#39;coolwarm&#39;, &#39;viridis&#39;, &#39;RdBu_r&#39;, etc.).</span></span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;annot&#39; parameter is set to True to display the correlation coefficients on the heatmap.</span></span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;fmt&#39; parameter is used to specify the number format for the annotations (e.g., &#39;.2f&#39; for two decimal places).</span></span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;linewidths&#39; parameter controls the width of the lines separating each cell.</span></span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;cbar&#39; parameter is set to True to display the color bar on the side of the heatmap.</span></span>
<span id="cb126-12"><a href="#cb126-12" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;cbar_kws&#39; parameter is used to customize the color bar appearance (e.g., orientation, label, etc.).</span></span>
<span id="cb126-13"><a href="#cb126-13" aria-hidden="true" tabindex="-1"></a>sns.heatmap(correlation_matrix, cmap<span class="op">=</span><span class="st">&#39;coolwarm&#39;</span>, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">&#39;.2f&#39;</span>, linewidths<span class="op">=</span><span class="fl">0.5</span>, cbar<span class="op">=</span><span class="va">True</span>, cbar_kws<span class="op">=</span>{<span class="st">&#39;orientation&#39;</span>: <span class="st">&#39;vertical&#39;</span>})</span>
<span id="cb126-14"><a href="#cb126-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-15"><a href="#cb126-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the title for the heatmap plot.</span></span>
<span id="cb126-16"><a href="#cb126-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Correlation Matrix Heatmap for traindf&#39;</span>)</span>
<span id="cb126-17"><a href="#cb126-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the heatmap.</span></span>
<span id="cb126-18"><a href="#cb126-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/6b820c878eb25ff8de0f1c2ff686ce9ee0348ea2.png" /></p>
</div>
</div>
<div class="cell markdown">
<p>y &amp; height has highest negative correlation width &amp; height
has highest positive correlation</p>
</div>
<section
id="step-6-design-train-and-test-basic-cnn-models-for-classification"
class="cell markdown">
<h1>Step 6: Design, train and test basic CNN models for
classification.</h1>
</section>
<section id="split-data-into-train-and-validation"
class="cell markdown">
<h4>Split data into train and validation</h4>
</section>
<div class="cell code" data-execution_count="259"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:45:26.341148Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:45:26.340754Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:45:26.482352Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:45:26.480882Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:45:26.341114Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb127"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the path to the train images directory and the directory where the CSV file will be saved</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>TRAIN_PATH <span class="op">=</span> trainImagesPath1</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>SAVE_PATH <span class="op">=</span> <span class="st">&quot;/kaggle/working/&quot;</span></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an empty list to store the filenames of the images</span></span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>filenames <span class="op">=</span> []</span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the directory and save the filenames to a list</span></span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a>filenames <span class="op">=</span> os.listdir(TRAIN_PATH)</span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the filenames to a CSV file</span></span>
<span id="cb127-12"><a href="#cb127-12" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(filenames).to_csv(SAVE_PATH <span class="op">+</span> <span class="st">&#39;train_path_listdir.csv&#39;</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb127-13"><a href="#cb127-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-14"><a href="#cb127-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify the percentage of data used for training (e.g., 100% of the data)</span></span>
<span id="cb127-15"><a href="#cb127-15" aria-hidden="true" tabindex="-1"></a>percentage_data_used <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb127-16"><a href="#cb127-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-17"><a href="#cb127-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the number of files to use based on the specified percentage</span></span>
<span id="cb127-18"><a href="#cb127-18" aria-hidden="true" tabindex="-1"></a>file_count <span class="op">=</span> <span class="bu">int</span>(<span class="bu">len</span>(filenames) <span class="op">*</span> percentage_data_used <span class="op">/</span> <span class="dv">100</span>)</span>
<span id="cb127-19"><a href="#cb127-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-20"><a href="#cb127-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the total number of files available</span></span>
<span id="cb127-21"><a href="#cb127-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Total files available:&quot;</span>, file_count)</span>
<span id="cb127-22"><a href="#cb127-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-23"><a href="#cb127-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Shuffle the list of filenames randomly to introduce randomness in the data</span></span>
<span id="cb127-24"><a href="#cb127-24" aria-hidden="true" tabindex="-1"></a>random.shuffle(filenames)</span>
<span id="cb127-25"><a href="#cb127-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-26"><a href="#cb127-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the number of validation samples based on the specified percentage (30% in this case)</span></span>
<span id="cb127-27"><a href="#cb127-27" aria-hidden="true" tabindex="-1"></a>n_valid_samples <span class="op">=</span> <span class="bu">int</span>(file_count <span class="op">*</span> <span class="fl">0.3</span>)</span>
<span id="cb127-28"><a href="#cb127-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-29"><a href="#cb127-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the filenames into train and validation sets based on the number of validation samples</span></span>
<span id="cb127-30"><a href="#cb127-30" aria-hidden="true" tabindex="-1"></a>train_filenames <span class="op">=</span> filenames[n_valid_samples:file_count]</span>
<span id="cb127-31"><a href="#cb127-31" aria-hidden="true" tabindex="-1"></a>valid_filenames <span class="op">=</span> filenames[:n_valid_samples]</span>
<span id="cb127-32"><a href="#cb127-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-33"><a href="#cb127-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the number of train and validation samples</span></span>
<span id="cb127-34"><a href="#cb127-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;n train samples:&#39;</span>, <span class="bu">len</span>(train_filenames))</span>
<span id="cb127-35"><a href="#cb127-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;n valid samples:&#39;</span>, <span class="bu">len</span>(valid_filenames))</span>
<span id="cb127-36"><a href="#cb127-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-37"><a href="#cb127-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the number of train samples</span></span>
<span id="cb127-38"><a href="#cb127-38" aria-hidden="true" tabindex="-1"></a>n_train_samples <span class="op">=</span> <span class="bu">len</span>(filenames) <span class="op">-</span> n_valid_samples</span>
<span id="cb127-39"><a href="#cb127-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-40"><a href="#cb127-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the image dimension to be used (e.g., 128x128)</span></span>
<span id="cb127-41"><a href="#cb127-41" aria-hidden="true" tabindex="-1"></a>image_dimension <span class="op">=</span> <span class="dv">128</span></span>
<span id="cb127-42"><a href="#cb127-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-43"><a href="#cb127-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the chosen image dimension and the filename of a sample image</span></span>
<span id="cb127-44"><a href="#cb127-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Image Dimension to use:&#39;</span>, image_dimension)</span>
<span id="cb127-45"><a href="#cb127-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;sample file:&#39;</span>, filenames[<span class="dv">0</span>])</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Total files available: 26684
n train samples: 18679
n valid samples: 8005
Image Dimension to use: 128
sample file: 6c2fb392-4762-4aa6-9878-ac6fc82ff6a1.dcm
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="260"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:45:27.139479Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:45:27.138743Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:45:27.161153Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:45:27.160227Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:45:27.139438Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb129"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co"># identifying if there are any files beside dcm in the folder</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name <span class="kw">in</span> filenames:</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>  le <span class="op">=</span> <span class="bu">len</span>(name)</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(name[le<span class="op">-</span><span class="dv">3</span>:le] <span class="op">!=</span> <span class="st">&#39;dcm&#39;</span>):</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(name)</span></code></pre></div>
</div>
<section id="create-a-dictionary-of-pneumonia-locations-in-one-place"
class="cell markdown">
<h2>Create a dictionary of pneumonia locations in one place.</h2>
</section>
<div class="cell code" data-execution_count="261"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:45:29.697338Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:45:29.696108Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:45:29.799379Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:45:29.798416Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:45:29.697276Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb130"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the project path where the CSV file is located</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>PROJECT_PATH <span class="op">=</span> <span class="st">&quot;/kaggle/input/pneumonia-detection&quot;</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an empty dictionary to store pneumonia locations for each image</span></span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>pneumonia_locations <span class="op">=</span> {}</span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the CSV file that contains pneumonia labels and image locations</span></span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(os.path.join(PROJECT_PATH, <span class="st">&#39;stage_2_train_labels.csv&#39;</span>), mode<span class="op">=</span><span class="st">&#39;r&#39;</span>) <span class="im">as</span> infile:</span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a CSV reader to read the contents of the file</span></span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a>    reader <span class="op">=</span> csv.reader(infile)</span>
<span id="cb130-11"><a href="#cb130-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Skip the header row of the CSV file</span></span>
<span id="cb130-12"><a href="#cb130-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">next</span>(reader, <span class="va">None</span>)</span>
<span id="cb130-13"><a href="#cb130-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop through each row in the CSV file</span></span>
<span id="cb130-14"><a href="#cb130-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> rows <span class="kw">in</span> reader:</span>
<span id="cb130-15"><a href="#cb130-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Retrieve the filename and pneumonia location information from the current row</span></span>
<span id="cb130-16"><a href="#cb130-16" aria-hidden="true" tabindex="-1"></a>        filename <span class="op">=</span> rows[<span class="dv">0</span>]</span>
<span id="cb130-17"><a href="#cb130-17" aria-hidden="true" tabindex="-1"></a>        location <span class="op">=</span> rows[<span class="dv">1</span>:<span class="dv">5</span>]</span>
<span id="cb130-18"><a href="#cb130-18" aria-hidden="true" tabindex="-1"></a>        pneumonia <span class="op">=</span> rows[<span class="dv">5</span>]</span>
<span id="cb130-19"><a href="#cb130-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-20"><a href="#cb130-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check if the current row represents a pneumonia case (indicated by pneumonia=1)</span></span>
<span id="cb130-21"><a href="#cb130-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> pneumonia <span class="op">==</span> <span class="st">&#39;1&#39;</span>:</span>
<span id="cb130-22"><a href="#cb130-22" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Convert the location values from string to float and then to integer</span></span>
<span id="cb130-23"><a href="#cb130-23" aria-hidden="true" tabindex="-1"></a>            location <span class="op">=</span> [<span class="bu">int</span>(<span class="bu">float</span>(i)) <span class="cf">for</span> i <span class="kw">in</span> location]</span>
<span id="cb130-24"><a href="#cb130-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-25"><a href="#cb130-25" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Save the pneumonia location in the dictionary</span></span>
<span id="cb130-26"><a href="#cb130-26" aria-hidden="true" tabindex="-1"></a>            <span class="co"># If the filename is already present in the dictionary, append the location to the existing list</span></span>
<span id="cb130-27"><a href="#cb130-27" aria-hidden="true" tabindex="-1"></a>            <span class="co"># If the filename is not present in the dictionary, create a new entry with the location list</span></span>
<span id="cb130-28"><a href="#cb130-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> filename <span class="kw">in</span> pneumonia_locations:</span>
<span id="cb130-29"><a href="#cb130-29" aria-hidden="true" tabindex="-1"></a>                pneumonia_locations[filename].append(location)</span>
<span id="cb130-30"><a href="#cb130-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb130-31"><a href="#cb130-31" aria-hidden="true" tabindex="-1"></a>                pneumonia_locations[filename] <span class="op">=</span> [location]</span></code></pre></div>
</div>
<section id="creation-of-generator-class" class="cell markdown">
<h2>Creation of Generator class</h2>
</section>
<div class="cell code" data-execution_count="262"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:45:31.623892Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:45:31.623527Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:45:31.644597Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:45:31.643328Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:45:31.623861Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb131"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the custom data generator class</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> generator(keras.utils.Sequence):</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, folder, filenames, pneumonia_locations<span class="op">=</span><span class="va">None</span>, batch_size<span class="op">=</span><span class="dv">32</span>, image_size<span class="op">=</span><span class="dv">256</span>, shuffle<span class="op">=</span><span class="va">True</span>, augment<span class="op">=</span><span class="va">False</span>, predict<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize the generator with required parameters</span></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.folder <span class="op">=</span> folder</span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.filenames <span class="op">=</span> filenames</span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.pneumonia_locations <span class="op">=</span> pneumonia_locations</span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.batch_size <span class="op">=</span> batch_size</span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.image_size <span class="op">=</span> image_size</span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.shuffle <span class="op">=</span> shuffle</span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.augment <span class="op">=</span> augment</span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.predict <span class="op">=</span> predict</span>
<span id="cb131-13"><a href="#cb131-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Execute this method after every epoch</span></span>
<span id="cb131-14"><a href="#cb131-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.on_epoch_end()</span>
<span id="cb131-15"><a href="#cb131-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-16"><a href="#cb131-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> __load__(<span class="va">self</span>, filename):</span>
<span id="cb131-17"><a href="#cb131-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Load DICOM file as a numpy array</span></span>
<span id="cb131-18"><a href="#cb131-18" aria-hidden="true" tabindex="-1"></a>        img <span class="op">=</span> pydicom.dcmread(os.path.join(<span class="va">self</span>.folder, filename)).pixel_array</span>
<span id="cb131-19"><a href="#cb131-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create an empty mask with zeros</span></span>
<span id="cb131-20"><a href="#cb131-20" aria-hidden="true" tabindex="-1"></a>        msk <span class="op">=</span> np.zeros(img.shape)</span>
<span id="cb131-21"><a href="#cb131-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get the filename without extension</span></span>
<span id="cb131-22"><a href="#cb131-22" aria-hidden="true" tabindex="-1"></a>        filename <span class="op">=</span> filename.split(<span class="st">&#39;.&#39;</span>)[<span class="dv">0</span>]</span>
<span id="cb131-23"><a href="#cb131-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check if the image contains pneumonia</span></span>
<span id="cb131-24"><a href="#cb131-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> filename <span class="kw">in</span> <span class="va">self</span>.pneumonia_locations:</span>
<span id="cb131-25"><a href="#cb131-25" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Loop through each pneumonia location and set corresponding pixels to 1</span></span>
<span id="cb131-26"><a href="#cb131-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> location <span class="kw">in</span> <span class="va">self</span>.pneumonia_locations[filename]:</span>
<span id="cb131-27"><a href="#cb131-27" aria-hidden="true" tabindex="-1"></a>                x, y, w, h <span class="op">=</span> location</span>
<span id="cb131-28"><a href="#cb131-28" aria-hidden="true" tabindex="-1"></a>                msk[y:y<span class="op">+</span>h, x:x<span class="op">+</span>w] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb131-29"><a href="#cb131-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Resize both image and mask to the specified image size</span></span>
<span id="cb131-30"><a href="#cb131-30" aria-hidden="true" tabindex="-1"></a>        img <span class="op">=</span> resize(img, (<span class="va">self</span>.image_size, <span class="va">self</span>.image_size), mode<span class="op">=</span><span class="st">&#39;reflect&#39;</span>)</span>
<span id="cb131-31"><a href="#cb131-31" aria-hidden="true" tabindex="-1"></a>        msk <span class="op">=</span> resize(msk, (<span class="va">self</span>.image_size, <span class="va">self</span>.image_size), mode<span class="op">=</span><span class="st">&#39;reflect&#39;</span>) <span class="op">&gt;</span> <span class="fl">0.5</span></span>
<span id="cb131-32"><a href="#cb131-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If augmentation is enabled, horizontally flip the images and masks half the time</span></span>
<span id="cb131-33"><a href="#cb131-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.augment <span class="kw">and</span> random.random() <span class="op">&gt;</span> <span class="fl">0.5</span>:</span>
<span id="cb131-34"><a href="#cb131-34" aria-hidden="true" tabindex="-1"></a>            img <span class="op">=</span> np.fliplr(img)</span>
<span id="cb131-35"><a href="#cb131-35" aria-hidden="true" tabindex="-1"></a>            msk <span class="op">=</span> np.fliplr(msk)</span>
<span id="cb131-36"><a href="#cb131-36" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add trailing channel dimension to the images and masks</span></span>
<span id="cb131-37"><a href="#cb131-37" aria-hidden="true" tabindex="-1"></a>        img <span class="op">=</span> np.expand_dims(img, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb131-38"><a href="#cb131-38" aria-hidden="true" tabindex="-1"></a>        msk <span class="op">=</span> np.expand_dims(msk, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb131-39"><a href="#cb131-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> img, msk</span>
<span id="cb131-40"><a href="#cb131-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-41"><a href="#cb131-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> __loadpredict__(<span class="va">self</span>, filename):</span>
<span id="cb131-42"><a href="#cb131-42" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check if the file is a DICOM file</span></span>
<span id="cb131-43"><a href="#cb131-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> filename.lower().endswith(<span class="st">&quot;.dcm&quot;</span>):</span>
<span id="cb131-44"><a href="#cb131-44" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Load the DICOM file as a numpy array</span></span>
<span id="cb131-45"><a href="#cb131-45" aria-hidden="true" tabindex="-1"></a>            img <span class="op">=</span> pydicom.dcmread(os.path.join(<span class="va">self</span>.folder, filename)).pixel_array</span>
<span id="cb131-46"><a href="#cb131-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb131-47"><a href="#cb131-47" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Load the image file using PIL</span></span>
<span id="cb131-48"><a href="#cb131-48" aria-hidden="true" tabindex="-1"></a>            img <span class="op">=</span> Image.<span class="bu">open</span>(os.path.join(<span class="va">self</span>.folder, filename))</span>
<span id="cb131-49"><a href="#cb131-49" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Convert the image to a numpy array</span></span>
<span id="cb131-50"><a href="#cb131-50" aria-hidden="true" tabindex="-1"></a>            img <span class="op">=</span> np.array(img)</span>
<span id="cb131-51"><a href="#cb131-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-52"><a href="#cb131-52" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Resize the image to the specified image size</span></span>
<span id="cb131-53"><a href="#cb131-53" aria-hidden="true" tabindex="-1"></a>        img <span class="op">=</span> resize(img, (<span class="va">self</span>.image_size, <span class="va">self</span>.image_size), mode<span class="op">=</span><span class="st">&#39;reflect&#39;</span>)</span>
<span id="cb131-54"><a href="#cb131-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-55"><a href="#cb131-55" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Normalize pixel values to a range between 0 and 1</span></span>
<span id="cb131-56"><a href="#cb131-56" aria-hidden="true" tabindex="-1"></a>        img <span class="op">/=</span> <span class="fl">255.</span></span>
<span id="cb131-57"><a href="#cb131-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-58"><a href="#cb131-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> img</span>
<span id="cb131-59"><a href="#cb131-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-60"><a href="#cb131-60" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__getitem__</span>(<span class="va">self</span>, index):</span>
<span id="cb131-61"><a href="#cb131-61" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Select a batch of filenames based on the index</span></span>
<span id="cb131-62"><a href="#cb131-62" aria-hidden="true" tabindex="-1"></a>        filenames <span class="op">=</span> <span class="va">self</span>.filenames[index<span class="op">*</span><span class="va">self</span>.batch_size:(index<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span><span class="va">self</span>.batch_size]</span>
<span id="cb131-63"><a href="#cb131-63" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If in prediction mode, return images and filenames</span></span>
<span id="cb131-64"><a href="#cb131-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.predict:</span>
<span id="cb131-65"><a href="#cb131-65" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Load files and create a numpy batch of images</span></span>
<span id="cb131-66"><a href="#cb131-66" aria-hidden="true" tabindex="-1"></a>            imgs <span class="op">=</span> [<span class="va">self</span>.__loadpredict__(filename) <span class="cf">for</span> filename <span class="kw">in</span> filenames]</span>
<span id="cb131-67"><a href="#cb131-67" aria-hidden="true" tabindex="-1"></a>            imgs <span class="op">=</span> np.array(imgs)</span>
<span id="cb131-68"><a href="#cb131-68" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> imgs, filenames</span>
<span id="cb131-69"><a href="#cb131-69" aria-hidden="true" tabindex="-1"></a>        <span class="co"># In training mode, return images and masks</span></span>
<span id="cb131-70"><a href="#cb131-70" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb131-71"><a href="#cb131-71" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Load files and create a numpy batch of images and masks</span></span>
<span id="cb131-72"><a href="#cb131-72" aria-hidden="true" tabindex="-1"></a>            items <span class="op">=</span> [<span class="va">self</span>.__load__(filename) <span class="cf">for</span> filename <span class="kw">in</span> filenames]</span>
<span id="cb131-73"><a href="#cb131-73" aria-hidden="true" tabindex="-1"></a>            imgs, msks <span class="op">=</span> <span class="bu">zip</span>(<span class="op">*</span>items)</span>
<span id="cb131-74"><a href="#cb131-74" aria-hidden="true" tabindex="-1"></a>            imgs <span class="op">=</span> np.array(imgs)</span>
<span id="cb131-75"><a href="#cb131-75" aria-hidden="true" tabindex="-1"></a>            msks <span class="op">=</span> np.array(msks)</span>
<span id="cb131-76"><a href="#cb131-76" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> imgs, msks</span>
<span id="cb131-77"><a href="#cb131-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-78"><a href="#cb131-78" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> on_epoch_end(<span class="va">self</span>):</span>
<span id="cb131-79"><a href="#cb131-79" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If shuffle is enabled, shuffle the list of filenames after every epoch</span></span>
<span id="cb131-80"><a href="#cb131-80" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.shuffle:</span>
<span id="cb131-81"><a href="#cb131-81" aria-hidden="true" tabindex="-1"></a>            random.shuffle(<span class="va">self</span>.filenames)</span>
<span id="cb131-82"><a href="#cb131-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-83"><a href="#cb131-83" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__len__</span>(<span class="va">self</span>):</span>
<span id="cb131-84"><a href="#cb131-84" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Determine the number of batches based on the predict mode</span></span>
<span id="cb131-85"><a href="#cb131-85" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.predict:</span>
<span id="cb131-86"><a href="#cb131-86" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Return the total number of batches to predict everything</span></span>
<span id="cb131-87"><a href="#cb131-87" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">int</span>(np.ceil(<span class="bu">len</span>(<span class="va">self</span>.filenames) <span class="op">/</span> <span class="va">self</span>.batch_size))</span>
<span id="cb131-88"><a href="#cb131-88" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb131-89"><a href="#cb131-89" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Return the total number of full batches for training</span></span>
<span id="cb131-90"><a href="#cb131-90" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">int</span>(<span class="bu">len</span>(<span class="va">self</span>.filenames) <span class="op">/</span> <span class="va">self</span>.batch_size)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="89"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T09:37:17.884819Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T09:37:17.884362Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T09:37:17.903072Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T09:37:17.902076Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T09:37:17.884788Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb132"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the IoU (Intersection over Union) or Jaccard loss function.</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="co"># This loss function calculates the similarity between the predicted and true masks.</span></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> iou_loss(y_true, y_pred):</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>    y_true <span class="op">=</span> tf.cast(y_true, tf.float32)</span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> tf.cast(y_pred, tf.float32)</span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>    y_true <span class="op">=</span> tf.reshape(y_true, [<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> tf.reshape(y_pred, [<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a>    intersection <span class="op">=</span> tf.reduce_sum(y_true <span class="op">*</span> y_pred)</span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a>    score <span class="op">=</span> (intersection <span class="op">+</span> <span class="fl">1.</span>) <span class="op">/</span> (tf.reduce_sum(y_true) <span class="op">+</span> tf.reduce_sum(y_pred) <span class="op">-</span> intersection <span class="op">+</span> <span class="fl">1.</span>)</span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span> <span class="op">-</span> score</span>
<span id="cb132-11"><a href="#cb132-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine binary cross-entropy loss and IoU loss to create a new loss function.</span></span>
<span id="cb132-12"><a href="#cb132-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> iou_bce_loss(y_true, y_pred):</span>
<span id="cb132-13"><a href="#cb132-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fl">0.5</span> <span class="op">*</span> keras.losses.binary_crossentropy(y_true, y_pred) <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> iou_loss(y_true, y_pred)</span>
<span id="cb132-14"><a href="#cb132-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the mean IoU (Intersection over Union) as a metric.</span></span>
<span id="cb132-15"><a href="#cb132-15" aria-hidden="true" tabindex="-1"></a><span class="co"># This metric calculates the average IoU for all predictions compared to the true masks.</span></span>
<span id="cb132-16"><a href="#cb132-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mean_iou(y_true, y_pred):</span>
<span id="cb132-17"><a href="#cb132-17" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> tf.<span class="bu">round</span>(y_pred)</span>
<span id="cb132-18"><a href="#cb132-18" aria-hidden="true" tabindex="-1"></a>    intersect <span class="op">=</span> tf.reduce_sum(y_true <span class="op">*</span> y_pred, axis<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>])</span>
<span id="cb132-19"><a href="#cb132-19" aria-hidden="true" tabindex="-1"></a>    union <span class="op">=</span> tf.reduce_sum(y_true, axis<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]) <span class="op">+</span> tf.reduce_sum(y_pred, axis<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>])</span>
<span id="cb132-20"><a href="#cb132-20" aria-hidden="true" tabindex="-1"></a>    smooth <span class="op">=</span> tf.ones(tf.shape(intersect))</span>
<span id="cb132-21"><a href="#cb132-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tf.reduce_mean((intersect <span class="op">+</span> smooth) <span class="op">/</span> (union <span class="op">-</span> intersect <span class="op">+</span> smooth))</span>
<span id="cb132-22"><a href="#cb132-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a downsample layer using Batch Normalization, LeakyReLU activation, and 1x1 Convolution.</span></span>
<span id="cb132-23"><a href="#cb132-23" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_downsample(channels, inputs):</span>
<span id="cb132-24"><a href="#cb132-24" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> keras.layers.BatchNormalization(momentum<span class="op">=</span><span class="fl">0.9</span>)(inputs)</span>
<span id="cb132-25"><a href="#cb132-25" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> keras.layers.LeakyReLU(<span class="dv">0</span>)(x)</span>
<span id="cb132-26"><a href="#cb132-26" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> keras.layers.Conv2D(channels, <span class="dv">1</span>, padding<span class="op">=</span><span class="st">&#39;same&#39;</span>, use_bias<span class="op">=</span><span class="va">False</span>)(x)</span>
<span id="cb132-27"><a href="#cb132-27" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> keras.layers.MaxPool2D(<span class="dv">2</span>)(x)</span>
<span id="cb132-28"><a href="#cb132-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x</span>
<span id="cb132-29"><a href="#cb132-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a residual block with two Convolution layers.</span></span>
<span id="cb132-30"><a href="#cb132-30" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_resblock(channels, inputs):</span>
<span id="cb132-31"><a href="#cb132-31" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> keras.layers.BatchNormalization(momentum<span class="op">=</span><span class="fl">0.9</span>)(inputs)</span>
<span id="cb132-32"><a href="#cb132-32" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> keras.layers.LeakyReLU(<span class="dv">0</span>)(x)</span>
<span id="cb132-33"><a href="#cb132-33" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> keras.layers.Conv2D(channels, <span class="dv">3</span>, padding<span class="op">=</span><span class="st">&#39;same&#39;</span>, use_bias<span class="op">=</span><span class="va">False</span>)(x)</span>
<span id="cb132-34"><a href="#cb132-34" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> keras.layers.BatchNormalization(momentum<span class="op">=</span><span class="fl">0.9</span>)(x)</span>
<span id="cb132-35"><a href="#cb132-35" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> keras.layers.LeakyReLU(<span class="dv">0</span>)(x)</span>
<span id="cb132-36"><a href="#cb132-36" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> keras.layers.Conv2D(channels, <span class="dv">3</span>, padding<span class="op">=</span><span class="st">&#39;same&#39;</span>, use_bias<span class="op">=</span><span class="va">False</span>)(x)</span>
<span id="cb132-37"><a href="#cb132-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> keras.layers.add([x, inputs])</span>
<span id="cb132-38"><a href="#cb132-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the U-Net architecture-based neural network.</span></span>
<span id="cb132-39"><a href="#cb132-39" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_network(input_size, channels, n_blocks<span class="op">=</span><span class="dv">2</span>, depth<span class="op">=</span><span class="dv">4</span>):</span>
<span id="cb132-40"><a href="#cb132-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Input layer</span></span>
<span id="cb132-41"><a href="#cb132-41" aria-hidden="true" tabindex="-1"></a>    inputs <span class="op">=</span> keras.Input(shape<span class="op">=</span>(input_size, input_size, <span class="dv">1</span>))</span>
<span id="cb132-42"><a href="#cb132-42" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> keras.layers.Conv2D(channels, <span class="dv">3</span>, padding<span class="op">=</span><span class="st">&#39;same&#39;</span>, use_bias<span class="op">=</span><span class="va">False</span>)(inputs)</span>
<span id="cb132-43"><a href="#cb132-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Residual blocks</span></span>
<span id="cb132-44"><a href="#cb132-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> d <span class="kw">in</span> <span class="bu">range</span>(depth):</span>
<span id="cb132-45"><a href="#cb132-45" aria-hidden="true" tabindex="-1"></a>        channels <span class="op">=</span> channels <span class="op">*</span> <span class="dv">2</span></span>
<span id="cb132-46"><a href="#cb132-46" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> create_downsample(channels, x)</span>
<span id="cb132-47"><a href="#cb132-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> b <span class="kw">in</span> <span class="bu">range</span>(n_blocks):</span>
<span id="cb132-48"><a href="#cb132-48" aria-hidden="true" tabindex="-1"></a>            x <span class="op">=</span> create_resblock(channels, x)</span>
<span id="cb132-49"><a href="#cb132-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Output layer</span></span>
<span id="cb132-50"><a href="#cb132-50" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> keras.layers.BatchNormalization(momentum<span class="op">=</span><span class="fl">0.9</span>)(x)</span>
<span id="cb132-51"><a href="#cb132-51" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> keras.layers.LeakyReLU(<span class="dv">0</span>)(x)</span>
<span id="cb132-52"><a href="#cb132-52" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> keras.layers.Conv2D(<span class="dv">1</span>, <span class="dv">1</span>, activation<span class="op">=</span><span class="st">&#39;sigmoid&#39;</span>)(x)</span>
<span id="cb132-53"><a href="#cb132-53" aria-hidden="true" tabindex="-1"></a>    outputs <span class="op">=</span> keras.layers.UpSampling2D(<span class="dv">2</span><span class="op">**</span>depth)(x)</span>
<span id="cb132-54"><a href="#cb132-54" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> keras.Model(inputs<span class="op">=</span>inputs, outputs<span class="op">=</span>outputs)</span>
<span id="cb132-55"><a href="#cb132-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="90"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-05T14:15:32.789152Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-05T14:15:32.788786Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-05T14:15:38.631997Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-05T14:15:38.630993Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-05T14:15:32.789121Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb133"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the batch size to 128, which determines the number of samples processed in each training iteration.</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>BATCH_SIZE <span class="op">=</span> <span class="dv">128</span></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the image size to 128x128 pixels, which will be used as the input size for the U-Net model.</span></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>IMAGE_SIZE <span class="op">=</span> <span class="dv">128</span></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the U-Net model using the &#39;create_network&#39; function with the specified parameters:</span></span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a><span class="co"># input_size: The size of the input images (both width and height) for the U-Net model.</span></span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a><span class="co"># channels: The number of channels in the initial convolutional layer of the U-Net model.</span></span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a><span class="co"># n_blocks: The number of residual blocks to include in each downsampling stage of the U-Net.</span></span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a><span class="co"># depth: The number of downsampling stages in the U-Net model.</span></span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> create_network(input_size<span class="op">=</span>IMAGE_SIZE, channels<span class="op">=</span><span class="dv">32</span>, n_blocks<span class="op">=</span><span class="dv">2</span>, depth<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb133-13"><a href="#cb133-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-14"><a href="#cb133-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Compile the U-Net model for training:</span></span>
<span id="cb133-15"><a href="#cb133-15" aria-hidden="true" tabindex="-1"></a><span class="co"># optimizer: &#39;adam&#39; is used as the optimization algorithm, which is an adaptive learning rate optimization algorithm.</span></span>
<span id="cb133-16"><a href="#cb133-16" aria-hidden="true" tabindex="-1"></a><span class="co"># loss: The loss function used during training is &#39;iou_bce_loss&#39;, which combines the binary cross-entropy loss and</span></span>
<span id="cb133-17"><a href="#cb133-17" aria-hidden="true" tabindex="-1"></a><span class="co">#       the IoU (Intersection over Union) loss to balance the segmentation performance.</span></span>
<span id="cb133-18"><a href="#cb133-18" aria-hidden="true" tabindex="-1"></a><span class="co"># metrics: During training, the model will calculate and display the accuracy and mean IoU metrics to monitor its performance.</span></span>
<span id="cb133-19"><a href="#cb133-19" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span><span class="st">&#39;adam&#39;</span>, loss<span class="op">=</span>iou_bce_loss, metrics<span class="op">=</span>[<span class="st">&#39;accuracy&#39;</span>, mean_iou])</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="91"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-05T14:15:38.634555Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-05T14:15:38.634192Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-05T14:15:38.800095Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-05T14:15:38.799373Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-05T14:15:38.634518Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb134"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function &#39;cosine_annealing&#39; that implements a learning rate annealing schedule based on the cosine function.</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The function takes a single argument &#39;x&#39;, which represents the current epoch number during training.</span></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cosine_annealing(x):</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>    lr <span class="op">=</span> <span class="fl">0.0001</span>  <span class="co"># The initial learning rate.</span></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>    epochs <span class="op">=</span> <span class="dv">2</span>   <span class="co"># The total number of epochs in the training process.</span></span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the learning rate using the cosine annealing formula.</span></span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The learning rate will start from &#39;lr&#39; and decay in a cosine manner over the given number of &#39;epochs&#39;.</span></span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> lr <span class="op">*</span> (np.cos(np.pi <span class="op">*</span> x <span class="op">/</span> epochs) <span class="op">+</span> <span class="fl">1.</span>) <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a LearningRateScheduler callback, &#39;learning_rate&#39;, that will adjust the learning rate during training.</span></span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a><span class="co"># The learning rate will be updated at the end of each epoch based on the &#39;cosine_annealing&#39; function.</span></span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a>learning_rate <span class="op">=</span> tf.keras.callbacks.LearningRateScheduler(cosine_annealing)</span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming &#39;folder&#39; is the path to the directory containing the training images.</span></span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a>folder <span class="op">=</span> trainImagesPath1</span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-17"><a href="#cb134-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create train and validation data generators using the &#39;generator&#39; class.</span></span>
<span id="cb134-18"><a href="#cb134-18" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;generator&#39; class provides data batches for training and validation during the training process.</span></span>
<span id="cb134-19"><a href="#cb134-19" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;train_gen&#39; will be used for training, and &#39;valid_gen&#39; will be used for validation.</span></span>
<span id="cb134-20"><a href="#cb134-20" aria-hidden="true" tabindex="-1"></a><span class="co"># The generators will provide data in batches of size &#39;BATCH_SIZE&#39; and resize images to &#39;IMAGE_SIZE&#39;.</span></span>
<span id="cb134-21"><a href="#cb134-21" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;pneumonia_locations&#39; is the dictionary containing pneumonia locations in the training data.</span></span>
<span id="cb134-22"><a href="#cb134-22" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;shuffle=True&#39; randomizes the order of data samples during training, while &#39;shuffle=False&#39; keeps the validation data order unchanged.</span></span>
<span id="cb134-23"><a href="#cb134-23" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;augment=False&#39; indicates that data augmentation will not be used during training.</span></span>
<span id="cb134-24"><a href="#cb134-24" aria-hidden="true" tabindex="-1"></a>train_gen <span class="op">=</span> generator(folder, train_filenames, pneumonia_locations, batch_size<span class="op">=</span>BATCH_SIZE, image_size<span class="op">=</span>IMAGE_SIZE, shuffle<span class="op">=</span><span class="va">True</span>, augment<span class="op">=</span><span class="va">False</span>, predict<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb134-25"><a href="#cb134-25" aria-hidden="true" tabindex="-1"></a>valid_gen <span class="op">=</span> generator(folder, valid_filenames, pneumonia_locations, batch_size<span class="op">=</span>BATCH_SIZE, image_size<span class="op">=</span>IMAGE_SIZE, shuffle<span class="op">=</span><span class="va">False</span>, predict<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb134-26"><a href="#cb134-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-27"><a href="#cb134-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the summary of the U-Net model to get an overview of its architecture and number of parameters.</span></span>
<span id="cb134-28"><a href="#cb134-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Model: &quot;model&quot;
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 input_1 (InputLayer)           [(None, 128, 128, 1  0           []                               
                                )]                                                                
                                                                                                  
 conv2d (Conv2D)                (None, 128, 128, 32  288         [&#39;input_1[0][0]&#39;]                
                                )                                                                 
                                                                                                  
 batch_normalization (BatchNorm  (None, 128, 128, 32  128        [&#39;conv2d[0][0]&#39;]                 
 alization)                     )                                                                 
                                                                                                  
 leaky_re_lu (LeakyReLU)        (None, 128, 128, 32  0           [&#39;batch_normalization[0][0]&#39;]    
                                )                                                                 
                                                                                                  
 conv2d_1 (Conv2D)              (None, 128, 128, 64  2048        [&#39;leaky_re_lu[0][0]&#39;]            
                                )                                                                 
                                                                                                  
 max_pooling2d (MaxPooling2D)   (None, 64, 64, 64)   0           [&#39;conv2d_1[0][0]&#39;]               
                                                                                                  
 batch_normalization_1 (BatchNo  (None, 64, 64, 64)  256         [&#39;max_pooling2d[0][0]&#39;]          
 rmalization)                                                                                     
                                                                                                  
 leaky_re_lu_1 (LeakyReLU)      (None, 64, 64, 64)   0           [&#39;batch_normalization_1[0][0]&#39;]  
                                                                                                  
 conv2d_2 (Conv2D)              (None, 64, 64, 64)   36864       [&#39;leaky_re_lu_1[0][0]&#39;]          
                                                                                                  
 batch_normalization_2 (BatchNo  (None, 64, 64, 64)  256         [&#39;conv2d_2[0][0]&#39;]               
 rmalization)                                                                                     
                                                                                                  
 leaky_re_lu_2 (LeakyReLU)      (None, 64, 64, 64)   0           [&#39;batch_normalization_2[0][0]&#39;]  
                                                                                                  
 conv2d_3 (Conv2D)              (None, 64, 64, 64)   36864       [&#39;leaky_re_lu_2[0][0]&#39;]          
                                                                                                  
 add (Add)                      (None, 64, 64, 64)   0           [&#39;conv2d_3[0][0]&#39;,               
                                                                  &#39;max_pooling2d[0][0]&#39;]          
                                                                                                  
 batch_normalization_3 (BatchNo  (None, 64, 64, 64)  256         [&#39;add[0][0]&#39;]                    
 rmalization)                                                                                     
                                                                                                  
 leaky_re_lu_3 (LeakyReLU)      (None, 64, 64, 64)   0           [&#39;batch_normalization_3[0][0]&#39;]  
                                                                                                  
 conv2d_4 (Conv2D)              (None, 64, 64, 64)   36864       [&#39;leaky_re_lu_3[0][0]&#39;]          
                                                                                                  
 batch_normalization_4 (BatchNo  (None, 64, 64, 64)  256         [&#39;conv2d_4[0][0]&#39;]               
 rmalization)                                                                                     
                                                                                                  
 leaky_re_lu_4 (LeakyReLU)      (None, 64, 64, 64)   0           [&#39;batch_normalization_4[0][0]&#39;]  
                                                                                                  
 conv2d_5 (Conv2D)              (None, 64, 64, 64)   36864       [&#39;leaky_re_lu_4[0][0]&#39;]          
                                                                                                  
 add_1 (Add)                    (None, 64, 64, 64)   0           [&#39;conv2d_5[0][0]&#39;,               
                                                                  &#39;add[0][0]&#39;]                    
                                                                                                  
 batch_normalization_5 (BatchNo  (None, 64, 64, 64)  256         [&#39;add_1[0][0]&#39;]                  
 rmalization)                                                                                     
                                                                                                  
 leaky_re_lu_5 (LeakyReLU)      (None, 64, 64, 64)   0           [&#39;batch_normalization_5[0][0]&#39;]  
                                                                                                  
 conv2d_6 (Conv2D)              (None, 64, 64, 128)  8192        [&#39;leaky_re_lu_5[0][0]&#39;]          
                                                                                                  
 max_pooling2d_1 (MaxPooling2D)  (None, 32, 32, 128)  0          [&#39;conv2d_6[0][0]&#39;]               
                                                                                                  
 batch_normalization_6 (BatchNo  (None, 32, 32, 128)  512        [&#39;max_pooling2d_1[0][0]&#39;]        
 rmalization)                                                                                     
                                                                                                  
 leaky_re_lu_6 (LeakyReLU)      (None, 32, 32, 128)  0           [&#39;batch_normalization_6[0][0]&#39;]  
                                                                                                  
 conv2d_7 (Conv2D)              (None, 32, 32, 128)  147456      [&#39;leaky_re_lu_6[0][0]&#39;]          
                                                                                                  
 batch_normalization_7 (BatchNo  (None, 32, 32, 128)  512        [&#39;conv2d_7[0][0]&#39;]               
 rmalization)                                                                                     
                                                                                                  
 leaky_re_lu_7 (LeakyReLU)      (None, 32, 32, 128)  0           [&#39;batch_normalization_7[0][0]&#39;]  
                                                                                                  
 conv2d_8 (Conv2D)              (None, 32, 32, 128)  147456      [&#39;leaky_re_lu_7[0][0]&#39;]          
                                                                                                  
 add_2 (Add)                    (None, 32, 32, 128)  0           [&#39;conv2d_8[0][0]&#39;,               
                                                                  &#39;max_pooling2d_1[0][0]&#39;]        
                                                                                                  
 batch_normalization_8 (BatchNo  (None, 32, 32, 128)  512        [&#39;add_2[0][0]&#39;]                  
 rmalization)                                                                                     
                                                                                                  
 leaky_re_lu_8 (LeakyReLU)      (None, 32, 32, 128)  0           [&#39;batch_normalization_8[0][0]&#39;]  
                                                                                                  
 conv2d_9 (Conv2D)              (None, 32, 32, 128)  147456      [&#39;leaky_re_lu_8[0][0]&#39;]          
                                                                                                  
 batch_normalization_9 (BatchNo  (None, 32, 32, 128)  512        [&#39;conv2d_9[0][0]&#39;]               
 rmalization)                                                                                     
                                                                                                  
 leaky_re_lu_9 (LeakyReLU)      (None, 32, 32, 128)  0           [&#39;batch_normalization_9[0][0]&#39;]  
                                                                                                  
 conv2d_10 (Conv2D)             (None, 32, 32, 128)  147456      [&#39;leaky_re_lu_9[0][0]&#39;]          
                                                                                                  
 add_3 (Add)                    (None, 32, 32, 128)  0           [&#39;conv2d_10[0][0]&#39;,              
                                                                  &#39;add_2[0][0]&#39;]                  
                                                                                                  
 batch_normalization_10 (BatchN  (None, 32, 32, 128)  512        [&#39;add_3[0][0]&#39;]                  
 ormalization)                                                                                    
                                                                                                  
 leaky_re_lu_10 (LeakyReLU)     (None, 32, 32, 128)  0           [&#39;batch_normalization_10[0][0]&#39;] 
                                                                                                  
 conv2d_11 (Conv2D)             (None, 32, 32, 256)  32768       [&#39;leaky_re_lu_10[0][0]&#39;]         
                                                                                                  
 max_pooling2d_2 (MaxPooling2D)  (None, 16, 16, 256)  0          [&#39;conv2d_11[0][0]&#39;]              
                                                                                                  
 batch_normalization_11 (BatchN  (None, 16, 16, 256)  1024       [&#39;max_pooling2d_2[0][0]&#39;]        
 ormalization)                                                                                    
                                                                                                  
 leaky_re_lu_11 (LeakyReLU)     (None, 16, 16, 256)  0           [&#39;batch_normalization_11[0][0]&#39;] 
                                                                                                  
 conv2d_12 (Conv2D)             (None, 16, 16, 256)  589824      [&#39;leaky_re_lu_11[0][0]&#39;]         
                                                                                                  
 batch_normalization_12 (BatchN  (None, 16, 16, 256)  1024       [&#39;conv2d_12[0][0]&#39;]              
 ormalization)                                                                                    
                                                                                                  
 leaky_re_lu_12 (LeakyReLU)     (None, 16, 16, 256)  0           [&#39;batch_normalization_12[0][0]&#39;] 
                                                                                                  
 conv2d_13 (Conv2D)             (None, 16, 16, 256)  589824      [&#39;leaky_re_lu_12[0][0]&#39;]         
                                                                                                  
 add_4 (Add)                    (None, 16, 16, 256)  0           [&#39;conv2d_13[0][0]&#39;,              
                                                                  &#39;max_pooling2d_2[0][0]&#39;]        
                                                                                                  
 batch_normalization_13 (BatchN  (None, 16, 16, 256)  1024       [&#39;add_4[0][0]&#39;]                  
 ormalization)                                                                                    
                                                                                                  
 leaky_re_lu_13 (LeakyReLU)     (None, 16, 16, 256)  0           [&#39;batch_normalization_13[0][0]&#39;] 
                                                                                                  
 conv2d_14 (Conv2D)             (None, 16, 16, 256)  589824      [&#39;leaky_re_lu_13[0][0]&#39;]         
                                                                                                  
 batch_normalization_14 (BatchN  (None, 16, 16, 256)  1024       [&#39;conv2d_14[0][0]&#39;]              
 ormalization)                                                                                    
                                                                                                  
 leaky_re_lu_14 (LeakyReLU)     (None, 16, 16, 256)  0           [&#39;batch_normalization_14[0][0]&#39;] 
                                                                                                  
 conv2d_15 (Conv2D)             (None, 16, 16, 256)  589824      [&#39;leaky_re_lu_14[0][0]&#39;]         
                                                                                                  
 add_5 (Add)                    (None, 16, 16, 256)  0           [&#39;conv2d_15[0][0]&#39;,              
                                                                  &#39;add_4[0][0]&#39;]                  
                                                                                                  
 batch_normalization_15 (BatchN  (None, 16, 16, 256)  1024       [&#39;add_5[0][0]&#39;]                  
 ormalization)                                                                                    
                                                                                                  
 leaky_re_lu_15 (LeakyReLU)     (None, 16, 16, 256)  0           [&#39;batch_normalization_15[0][0]&#39;] 
                                                                                                  
 conv2d_16 (Conv2D)             (None, 16, 16, 512)  131072      [&#39;leaky_re_lu_15[0][0]&#39;]         
                                                                                                  
 max_pooling2d_3 (MaxPooling2D)  (None, 8, 8, 512)   0           [&#39;conv2d_16[0][0]&#39;]              
                                                                                                  
 batch_normalization_16 (BatchN  (None, 8, 8, 512)   2048        [&#39;max_pooling2d_3[0][0]&#39;]        
 ormalization)                                                                                    
                                                                                                  
 leaky_re_lu_16 (LeakyReLU)     (None, 8, 8, 512)    0           [&#39;batch_normalization_16[0][0]&#39;] 
                                                                                                  
 conv2d_17 (Conv2D)             (None, 8, 8, 512)    2359296     [&#39;leaky_re_lu_16[0][0]&#39;]         
                                                                                                  
 batch_normalization_17 (BatchN  (None, 8, 8, 512)   2048        [&#39;conv2d_17[0][0]&#39;]              
 ormalization)                                                                                    
                                                                                                  
 leaky_re_lu_17 (LeakyReLU)     (None, 8, 8, 512)    0           [&#39;batch_normalization_17[0][0]&#39;] 
                                                                                                  
 conv2d_18 (Conv2D)             (None, 8, 8, 512)    2359296     [&#39;leaky_re_lu_17[0][0]&#39;]         
                                                                                                  
 add_6 (Add)                    (None, 8, 8, 512)    0           [&#39;conv2d_18[0][0]&#39;,              
                                                                  &#39;max_pooling2d_3[0][0]&#39;]        
                                                                                                  
 batch_normalization_18 (BatchN  (None, 8, 8, 512)   2048        [&#39;add_6[0][0]&#39;]                  
 ormalization)                                                                                    
                                                                                                  
 leaky_re_lu_18 (LeakyReLU)     (None, 8, 8, 512)    0           [&#39;batch_normalization_18[0][0]&#39;] 
                                                                                                  
 conv2d_19 (Conv2D)             (None, 8, 8, 512)    2359296     [&#39;leaky_re_lu_18[0][0]&#39;]         
                                                                                                  
 batch_normalization_19 (BatchN  (None, 8, 8, 512)   2048        [&#39;conv2d_19[0][0]&#39;]              
 ormalization)                                                                                    
                                                                                                  
 leaky_re_lu_19 (LeakyReLU)     (None, 8, 8, 512)    0           [&#39;batch_normalization_19[0][0]&#39;] 
                                                                                                  
 conv2d_20 (Conv2D)             (None, 8, 8, 512)    2359296     [&#39;leaky_re_lu_19[0][0]&#39;]         
                                                                                                  
 add_7 (Add)                    (None, 8, 8, 512)    0           [&#39;conv2d_20[0][0]&#39;,              
                                                                  &#39;add_6[0][0]&#39;]                  
                                                                                                  
 batch_normalization_20 (BatchN  (None, 8, 8, 512)   2048        [&#39;add_7[0][0]&#39;]                  
 ormalization)                                                                                    
                                                                                                  
 leaky_re_lu_20 (LeakyReLU)     (None, 8, 8, 512)    0           [&#39;batch_normalization_20[0][0]&#39;] 
                                                                                                  
 conv2d_21 (Conv2D)             (None, 8, 8, 1)      513         [&#39;leaky_re_lu_20[0][0]&#39;]         
                                                                                                  
 up_sampling2d (UpSampling2D)   (None, 128, 128, 1)  0           [&#39;conv2d_21[0][0]&#39;]              
                                                                                                  
==================================================================================================
Total params: 12,727,969
Trainable params: 12,718,305
Non-trainable params: 9,664
__________________________________________________________________________________________________
None
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="92"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-05T14:15:38.801494Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-05T14:15:38.801136Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-05T15:39:00.506311Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-05T15:39:00.505246Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-05T14:15:38.801461Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb136"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>EPOCHS<span class="op">=</span><span class="dv">2</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit_generator(train_gen, validation_data<span class="op">=</span>valid_gen, callbacks<span class="op">=</span>[learning_rate], epochs<span class="op">=</span>EPOCHS)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Epoch 1/2
145/145 [==============================] - 2518s 17s/step - loss: 0.5222 - accuracy: 0.9343 - mean_iou: 0.6338 - val_loss: 0.4507 - val_accuracy: 0.9637 - val_mean_iou: 0.6920 - lr: 1.0000e-04
Epoch 2/2
145/145 [==============================] - 2443s 17s/step - loss: 0.4437 - accuracy: 0.9673 - mean_iou: 0.7150 - val_loss: 0.4342 - val_accuracy: 0.9679 - val_mean_iou: 0.7326 - lr: 5.0000e-05
</code></pre>
</div>
</div>
<section id="2-milestone-2" class="cell markdown">
<h2>2. Milestone 2:</h2>
<h4 id="input">Input:</h4>
<p>Preprocessed output from Milestone-1</p>
<h4 id="process">Process:</h4>
<p>‣ Step 1: Fine tune the trained basic CNN models for
classification.</p>
<p>‣ Step 2: Apply Transfer Learning model for classification</p>
<p>‣ Step 3: Design, train and test RCNN &amp; its hybrids based object
detection models to impose the bounding box or mask over the area of
interest.</p>
<p>‣ Step 4: Pickle the model for future prediction</p>
<p>‣ Step 5: Final Report</p>
<h3 id="submission">Submission:</h3>
<p>Final report, Jupyter Notebook with all the steps in Milestone-1 and
Milestone-2</p>
</section>
<div class="cell markdown">
<h4
id="from-the-above-code-we-could-not-print-confusion-matrix-as-the-shape-of-y_true--y_pred-are-different">From
the above code, we could not print Confusion Matrix as the shape of
y_true &amp; y_pred #are different.</h4>
<h4
id="we-shall-continue-to-conduct-testing-on-other-models-and-check-accuracy-of-different-classes-with-confusion-matrix">We
shall continue to conduct testing on other models and check accuracy of
different classes with confusion matrix</h4>
</div>
<div class="cell code" data-execution_count="263"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:45:40.200579Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:45:40.200184Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:45:40.229430Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:45:40.227943Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:45:40.200544Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb138"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Sampling 5000 from the dataset. This shall be used to design and evaluate the models</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>sample_trainingdata <span class="op">=</span> traindf.groupby(<span class="st">&#39;class&#39;</span>, group_keys<span class="op">=</span><span class="va">False</span>).<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.sample(<span class="dv">1000</span>))</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="264"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:45:41.635842Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:45:41.635480Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:45:41.656469Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:45:41.655419Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:45:41.635811Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb139"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>sample_trainingdata.info()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 3000 entries, 6634 to 22604
Data columns (total 11 columns):
 #   Column        Non-Null Count  Dtype  
---  ------        --------------  -----  
 0   patientId     3000 non-null   object 
 1   x             1000 non-null   float64
 2   y             1000 non-null   float64
 3   width         1000 non-null   float64
 4   height        1000 non-null   float64
 5   Target        3000 non-null   int64  
 6   class         3000 non-null   object 
 7   PatientAge    3000 non-null   object 
 8   PatientSex    3000 non-null   object 
 9   ViewPosition  3000 non-null   int64  
 10  PixelSpacing  3000 non-null   object 
dtypes: float64(4), int64(2), object(5)
memory usage: 281.2+ KB
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="265"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:45:42.880706Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:45:42.877867Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:45:42.891332Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:45:42.890201Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:45:42.880665Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb141"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize lists and variables for image processing</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>images <span class="op">=</span> []</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>ADJUSTED_IMAGE_SIZE <span class="op">=</span> <span class="dv">128</span></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>imageList <span class="op">=</span> []</span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>classLabels <span class="op">=</span> []</span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> []</span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a>originalImage <span class="op">=</span> []</span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to read the image from the path and resize it</span></span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> readAndReshapeImage(image):</span>
<span id="cb141-11"><a href="#cb141-11" aria-hidden="true" tabindex="-1"></a>    img <span class="op">=</span> np.array(image).astype(np.uint8)</span>
<span id="cb141-12"><a href="#cb141-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Resize the image to ADJUSTED_IMAGE_SIZE</span></span>
<span id="cb141-13"><a href="#cb141-13" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> cv2.resize(img, (ADJUSTED_IMAGE_SIZE, ADJUSTED_IMAGE_SIZE), interpolation<span class="op">=</span>cv2.INTER_LINEAR)</span>
<span id="cb141-14"><a href="#cb141-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> res</span>
<span id="cb141-15"><a href="#cb141-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-16"><a href="#cb141-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to read and resize the images in the dataset</span></span>
<span id="cb141-17"><a href="#cb141-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> populateImage(rowData):</span>
<span id="cb141-18"><a href="#cb141-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> index, row <span class="kw">in</span> rowData.iterrows():</span>
<span id="cb141-19"><a href="#cb141-19" aria-hidden="true" tabindex="-1"></a>        patientId <span class="op">=</span> row.patientId</span>
<span id="cb141-20"><a href="#cb141-20" aria-hidden="true" tabindex="-1"></a>        classlabel <span class="op">=</span> row[<span class="st">&quot;class&quot;</span>]</span>
<span id="cb141-21"><a href="#cb141-21" aria-hidden="true" tabindex="-1"></a>        dcm_file <span class="op">=</span> <span class="st">&quot;/kaggle/input/pneumonia-detection/stage_2_train_images/stage_2_train_images/&quot;</span> <span class="op">+</span> <span class="st">&#39;</span><span class="sc">{}</span><span class="st">.dcm&#39;</span>.<span class="bu">format</span>(patientId)</span>
<span id="cb141-22"><a href="#cb141-22" aria-hidden="true" tabindex="-1"></a>        dcm_data <span class="op">=</span> pydicom.dcmread(dcm_file)</span>
<span id="cb141-23"><a href="#cb141-23" aria-hidden="true" tabindex="-1"></a>        img <span class="op">=</span> dcm_data.pixel_array</span>
<span id="cb141-24"><a href="#cb141-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Convert the image to 3 channels as the DICOM image pixel does not have color classes</span></span>
<span id="cb141-25"><a href="#cb141-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(img.shape) <span class="op">!=</span> <span class="dv">3</span> <span class="kw">or</span> img.shape[<span class="dv">2</span>] <span class="op">!=</span> <span class="dv">3</span>:</span>
<span id="cb141-26"><a href="#cb141-26" aria-hidden="true" tabindex="-1"></a>            img <span class="op">=</span> np.stack((img,) <span class="op">*</span> <span class="dv">3</span>, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb141-27"><a href="#cb141-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Append the resized image to the imageList</span></span>
<span id="cb141-28"><a href="#cb141-28" aria-hidden="true" tabindex="-1"></a>        imageList.append(readAndReshapeImage(img))</span>
<span id="cb141-29"><a href="#cb141-29" aria-hidden="true" tabindex="-1"></a>        classLabels.append(classlabel)</span>
<span id="cb141-30"><a href="#cb141-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert lists to numpy arrays and return</span></span>
<span id="cb141-31"><a href="#cb141-31" aria-hidden="true" tabindex="-1"></a>    tmpImages <span class="op">=</span> np.array(imageList)</span>
<span id="cb141-32"><a href="#cb141-32" aria-hidden="true" tabindex="-1"></a>    tmpLabels <span class="op">=</span> np.array(classLabels)</span>
<span id="cb141-33"><a href="#cb141-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tmpImages, tmpLabels</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="266"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:45:59.919267Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:45:59.918881Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:46:31.800348Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:46:31.799302Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:45:59.919233Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb142"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Reading the images into numpy array</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>images,labels <span class="op">=</span> populateImage(sample_trainingdata)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="267"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:46:38.147106Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:46:38.146346Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:46:38.153524Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:46:38.152496Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:46:38.147070Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb143"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>images.shape , labels.shape</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a><span class="co">## The image is of 128*128 with 3 channels</span></span></code></pre></div>
<div class="output execute_result" data-execution_count="267">
<pre><code>((3000, 128, 128, 3), (3000,))</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="268"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:46:38.994225Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:46:38.993062Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:46:39.378363Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:46:39.377376Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:46:38.994177Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb145"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Checking one of the converted image </span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>plt.imshow(images[<span class="dv">10</span>])<span class="op">;</span></span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/d6540890b710e95850b873658d6de5e99a157317.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="269"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:46:41.746535Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:46:41.746093Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:46:41.758563Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:46:41.757329Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:46:41.746500Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb146"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co">## check the unique labels</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>np.unique(labels),<span class="bu">len</span>(np.unique(labels))</span></code></pre></div>
<div class="output execute_result" data-execution_count="269">
<pre><code>(array([&#39;Lung Opacity&#39;, &#39;No Lung Opacity / Not Normal&#39;, &#39;Normal&#39;],
       dtype=&#39;&lt;U28&#39;),
 3)</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="270"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:46:42.602268Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:46:42.601828Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:46:42.624797Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:46:42.623716Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:46:42.602231Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb148"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an instance of the LabelBinarizer class</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>enc <span class="op">=</span> LabelBinarizer()</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Encode the labels using one-hot encoding</span></span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a><span class="co"># This converts the class labels into binary format where each class is represented as a binary vector</span></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a><span class="co"># For example, if there are three classes [&#39;cat&#39;, &#39;dog&#39;, &#39;bird&#39;], the encoding will be:</span></span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a><span class="co"># cat -&gt; [1, 0, 0]</span></span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a><span class="co"># dog -&gt; [0, 1, 0]</span></span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a><span class="co"># bird -&gt; [0, 0, 1]</span></span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a><span class="co"># The result &#39;y2&#39; will be a numpy array containing the encoded labels</span></span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a>y2 <span class="op">=</span> enc.fit_transform(labels)</span></code></pre></div>
</div>
<section id="splitting-data-into-train--test-sets"
class="cell markdown">
<h4>Splitting data into Train &amp; Test Sets</h4>
</section>
<div class="cell code" data-execution_count="271"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:46:45.421998Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:46:45.421261Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:46:45.524748Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:46:45.523668Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:46:45.421960Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb149"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Splitting the data into train, test, and validation sets</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="co"># X_train: Training images</span></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a><span class="co"># X_test: Testing images</span></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a><span class="co"># X_val: Validation images</span></span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a><span class="co"># y_train: Training labels (encoded using one-hot encoding)</span></span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a><span class="co"># y_test: Testing labels (encoded using one-hot encoding)</span></span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a><span class="co"># y_val: Validation labels (encoded using one-hot encoding)</span></span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the images and labels into training and testing sets using a test size of 30%</span></span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(images, y2, test_size<span class="op">=</span><span class="fl">0.3</span>, random_state<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-12"><a href="#cb149-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Further split the testing set into testing and validation sets using a test size of 50%</span></span>
<span id="cb149-13"><a href="#cb149-13" aria-hidden="true" tabindex="-1"></a>X_test, X_val, y_test, y_val <span class="op">=</span> train_test_split(X_test, y_test, test_size<span class="op">=</span><span class="fl">0.5</span>, random_state<span class="op">=</span><span class="dv">50</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="272"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:46:50.074076Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:46:50.073682Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:46:50.081137Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:46:50.079523Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:46:50.074043Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb150"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to create a DataFrame to store the results of different methods or models.</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The DataFrame will have columns for the method name, accuracy, and test score.</span></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> createResultDf(name, accuracy, testscore):</span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a DataFrame with one row containing the results for a specific method or model.</span></span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The &#39;name&#39; parameter represents the name of the method or model.</span></span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The &#39;accuracy&#39; parameter represents the accuracy achieved by the method or model on the validation set.</span></span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The &#39;testscore&#39; parameter represents the score or performance of the method or model on the test set.</span></span>
<span id="cb150-9"><a href="#cb150-9" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> pd.DataFrame({<span class="st">&#39;Method&#39;</span>: [name], <span class="st">&#39;accuracy&#39;</span>: [accuracy], <span class="st">&#39;Test Score&#39;</span>: [testscore]})</span>
<span id="cb150-10"><a href="#cb150-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span></code></pre></div>
</div>
<section id="base-model" class="cell markdown">
<h3>Base Model</h3>
</section>
<div class="cell code" data-execution_count="153"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T10:14:17.334671Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T10:14:17.334290Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T10:14:17.346559Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T10:14:17.345483Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T10:14:17.334640Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb151"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cnn_model(height, width, num_channels, num_classes, loss<span class="op">=</span><span class="st">&#39;categorical_crossentropy&#39;</span>, metrics<span class="op">=</span>[<span class="st">&#39;accuracy&#39;</span>]):</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a Sequential model, which is a linear stack of layers.</span></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> Sequential()</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add the first Conv2D layer with 1 filter, kernel size of (5, 5), &#39;Same&#39; padding, &#39;relu&#39; activation,</span></span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># and input shape defined by (height, width, num_channels).</span></span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>    model.add(Conv2D(filters<span class="op">=</span><span class="dv">1</span>, kernel_size<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">5</span>), padding<span class="op">=</span><span class="st">&#39;Same&#39;</span>, activation<span class="op">=</span><span class="st">&#39;relu&#39;</span>, input_shape<span class="op">=</span>(height, width, num_channels)))</span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add the second Conv2D layer with 32 filters, kernel size of (5, 5), &#39;Same&#39; padding, and &#39;relu&#39; activation.</span></span>
<span id="cb151-10"><a href="#cb151-10" aria-hidden="true" tabindex="-1"></a>    model.add(Conv2D(filters<span class="op">=</span><span class="dv">32</span>, kernel_size<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">5</span>), padding<span class="op">=</span><span class="st">&#39;Same&#39;</span>, activation<span class="op">=</span><span class="st">&#39;relu&#39;</span>))</span>
<span id="cb151-11"><a href="#cb151-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-12"><a href="#cb151-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add a MaxPooling2D layer with a pool size of (2, 2) to downsample the spatial dimensions.</span></span>
<span id="cb151-13"><a href="#cb151-13" aria-hidden="true" tabindex="-1"></a>    model.add(MaxPooling2D(pool_size<span class="op">=</span>(<span class="dv">2</span>, <span class="dv">2</span>)))</span>
<span id="cb151-14"><a href="#cb151-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-15"><a href="#cb151-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add two more Conv2D layers with 64 filters, kernel size of (3, 3), &#39;Same&#39; padding, and &#39;relu&#39; activation.</span></span>
<span id="cb151-16"><a href="#cb151-16" aria-hidden="true" tabindex="-1"></a>    model.add(Conv2D(filters<span class="op">=</span><span class="dv">64</span>, kernel_size<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">3</span>), padding<span class="op">=</span><span class="st">&#39;Same&#39;</span>, activation<span class="op">=</span><span class="st">&#39;relu&#39;</span>))</span>
<span id="cb151-17"><a href="#cb151-17" aria-hidden="true" tabindex="-1"></a>    model.add(Conv2D(filters<span class="op">=</span><span class="dv">64</span>, kernel_size<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">3</span>), padding<span class="op">=</span><span class="st">&#39;same&#39;</span>, activation<span class="op">=</span><span class="st">&#39;relu&#39;</span>))</span>
<span id="cb151-18"><a href="#cb151-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-19"><a href="#cb151-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add another MaxPooling2D layer with a pool size of (2, 2) and a stride of (2, 2).</span></span>
<span id="cb151-20"><a href="#cb151-20" aria-hidden="true" tabindex="-1"></a>    model.add(MaxPooling2D(pool_size<span class="op">=</span>(<span class="dv">2</span>, <span class="dv">2</span>), strides<span class="op">=</span>(<span class="dv">2</span>, <span class="dv">2</span>)))</span>
<span id="cb151-21"><a href="#cb151-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-22"><a href="#cb151-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add two more Conv2D layers with 128 filters, kernel size of (3, 3), &#39;Same&#39; padding, and &#39;relu&#39; activation.</span></span>
<span id="cb151-23"><a href="#cb151-23" aria-hidden="true" tabindex="-1"></a>    model.add(Conv2D(filters<span class="op">=</span><span class="dv">128</span>, kernel_size<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">3</span>), padding<span class="op">=</span><span class="st">&#39;Same&#39;</span>, activation<span class="op">=</span><span class="st">&#39;relu&#39;</span>))</span>
<span id="cb151-24"><a href="#cb151-24" aria-hidden="true" tabindex="-1"></a>    model.add(Conv2D(filters<span class="op">=</span><span class="dv">128</span>, kernel_size<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">3</span>), padding<span class="op">=</span><span class="st">&#39;Same&#39;</span>, activation<span class="op">=</span><span class="st">&#39;relu&#39;</span>))</span>
<span id="cb151-25"><a href="#cb151-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-26"><a href="#cb151-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add a GlobalMaxPooling2D layer to reduce the spatial dimensions to a single value per feature map.</span></span>
<span id="cb151-27"><a href="#cb151-27" aria-hidden="true" tabindex="-1"></a>    model.add(GlobalMaxPooling2D())</span>
<span id="cb151-28"><a href="#cb151-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-29"><a href="#cb151-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add a Dense layer with 256 units and &#39;relu&#39; activation.</span></span>
<span id="cb151-30"><a href="#cb151-30" aria-hidden="true" tabindex="-1"></a>    model.add(Dense(<span class="dv">256</span>, activation<span class="op">=</span><span class="st">&quot;relu&quot;</span>))</span>
<span id="cb151-31"><a href="#cb151-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-32"><a href="#cb151-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add the output Dense layer with num_classes units and &#39;softmax&#39; activation for multi-class classification.</span></span>
<span id="cb151-33"><a href="#cb151-33" aria-hidden="true" tabindex="-1"></a>    model.add(Dense(num_classes, activation<span class="op">=</span><span class="st">&quot;softmax&quot;</span>))</span>
<span id="cb151-34"><a href="#cb151-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-35"><a href="#cb151-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create an Adam optimizer with learning rate 0.001.</span></span>
<span id="cb151-36"><a href="#cb151-36" aria-hidden="true" tabindex="-1"></a>    optimizer <span class="op">=</span> Adam(learning_rate<span class="op">=</span><span class="fl">0.001</span>)</span>
<span id="cb151-37"><a href="#cb151-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-38"><a href="#cb151-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compile the model with the specified loss function and evaluation metrics.</span></span>
<span id="cb151-39"><a href="#cb151-39" aria-hidden="true" tabindex="-1"></a>    model.<span class="bu">compile</span>(optimizer<span class="op">=</span>optimizer, loss<span class="op">=</span>loss, metrics<span class="op">=</span>metrics)</span>
<span id="cb151-40"><a href="#cb151-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print the model summary to show the model architecture and the number of trainable parameters.</span></span>
<span id="cb151-41"><a href="#cb151-41" aria-hidden="true" tabindex="-1"></a>    model.summary()</span>
<span id="cb151-42"><a href="#cb151-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the compiled model.</span></span>
<span id="cb151-43"><a href="#cb151-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="154"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T10:14:19.807181Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T10:14:19.806451Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T10:14:19.961120Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T10:14:19.960238Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T10:14:19.807133Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb152"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model Summary</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>cnn <span class="op">=</span> cnn_model(ADJUSTED_IMAGE_SIZE,ADJUSTED_IMAGE_SIZE,<span class="dv">3</span>,<span class="dv">3</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Model: &quot;sequential_2&quot;
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 conv2d (Conv2D)             (None, 128, 128, 1)       76        
                                                                 
 conv2d_1 (Conv2D)           (None, 128, 128, 32)      832       
                                                                 
 max_pooling2d (MaxPooling2D  (None, 64, 64, 32)       0         
 )                                                               
                                                                 
 conv2d_2 (Conv2D)           (None, 64, 64, 64)        18496     
                                                                 
 conv2d_3 (Conv2D)           (None, 64, 64, 64)        36928     
                                                                 
 max_pooling2d_1 (MaxPooling  (None, 32, 32, 64)       0         
 2D)                                                             
                                                                 
 conv2d_4 (Conv2D)           (None, 32, 32, 128)       73856     
                                                                 
 conv2d_5 (Conv2D)           (None, 32, 32, 128)       147584    
                                                                 
 global_max_pooling2d (Globa  (None, 128)              0         
 lMaxPooling2D)                                                  
                                                                 
 dense_6 (Dense)             (None, 256)               33024     
                                                                 
 dense_7 (Dense)             (None, 3)                 771       
                                                                 
=================================================================
Total params: 311,567
Trainable params: 311,567
Non-trainable params: 0
_________________________________________________________________
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="155"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T10:14:23.705239Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T10:14:23.704875Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T10:15:47.259284Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T10:15:47.258143Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T10:14:23.705209Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb154"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Training for 25 epocs with batch size of 32</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> cnn.fit(X_train,y_train,epochs <span class="op">=</span> <span class="dv">25</span>,validation_data <span class="op">=</span> (X_val,y_val),batch_size <span class="op">=</span> <span class="dv">32</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Epoch 1/25
66/66 [==============================] - 8s 50ms/step - loss: 1.1487 - accuracy: 0.3657 - val_loss: 1.0739 - val_accuracy: 0.4422
Epoch 2/25
66/66 [==============================] - 2s 29ms/step - loss: 1.0733 - accuracy: 0.4014 - val_loss: 1.0997 - val_accuracy: 0.3933
Epoch 3/25
66/66 [==============================] - 2s 30ms/step - loss: 1.0458 - accuracy: 0.4386 - val_loss: 1.0120 - val_accuracy: 0.5356
Epoch 4/25
66/66 [==============================] - 2s 29ms/step - loss: 1.0077 - accuracy: 0.4790 - val_loss: 1.0059 - val_accuracy: 0.5422
Epoch 5/25
66/66 [==============================] - 2s 32ms/step - loss: 0.9880 - accuracy: 0.4895 - val_loss: 1.0073 - val_accuracy: 0.5311
Epoch 6/25
66/66 [==============================] - 2s 29ms/step - loss: 0.9607 - accuracy: 0.5300 - val_loss: 1.0340 - val_accuracy: 0.5111
Epoch 7/25
66/66 [==============================] - 2s 29ms/step - loss: 0.9415 - accuracy: 0.5238 - val_loss: 1.0185 - val_accuracy: 0.4667
Epoch 8/25
66/66 [==============================] - 2s 29ms/step - loss: 0.9024 - accuracy: 0.5581 - val_loss: 1.0682 - val_accuracy: 0.4622
Epoch 9/25
66/66 [==============================] - 2s 29ms/step - loss: 0.8824 - accuracy: 0.5776 - val_loss: 1.0205 - val_accuracy: 0.5200
Epoch 10/25
66/66 [==============================] - 2s 29ms/step - loss: 0.8263 - accuracy: 0.6048 - val_loss: 1.1161 - val_accuracy: 0.4733
Epoch 11/25
66/66 [==============================] - 2s 29ms/step - loss: 0.7660 - accuracy: 0.6410 - val_loss: 1.0779 - val_accuracy: 0.5222
Epoch 12/25
66/66 [==============================] - 2s 29ms/step - loss: 0.7039 - accuracy: 0.6781 - val_loss: 1.2938 - val_accuracy: 0.4778
Epoch 13/25
66/66 [==============================] - 2s 29ms/step - loss: 0.6520 - accuracy: 0.7005 - val_loss: 1.2366 - val_accuracy: 0.4778
Epoch 14/25
66/66 [==============================] - 2s 29ms/step - loss: 0.5871 - accuracy: 0.7419 - val_loss: 1.3989 - val_accuracy: 0.4911
Epoch 15/25
66/66 [==============================] - 2s 29ms/step - loss: 0.5512 - accuracy: 0.7667 - val_loss: 1.4846 - val_accuracy: 0.5178
Epoch 16/25
66/66 [==============================] - 2s 29ms/step - loss: 0.4837 - accuracy: 0.7986 - val_loss: 1.7302 - val_accuracy: 0.4311
Epoch 17/25
66/66 [==============================] - 2s 29ms/step - loss: 0.3779 - accuracy: 0.8395 - val_loss: 2.0752 - val_accuracy: 0.4356
Epoch 18/25
66/66 [==============================] - 2s 30ms/step - loss: 0.3610 - accuracy: 0.8576 - val_loss: 2.1652 - val_accuracy: 0.4156
Epoch 19/25
66/66 [==============================] - 2s 29ms/step - loss: 0.2870 - accuracy: 0.8843 - val_loss: 2.5935 - val_accuracy: 0.4622
Epoch 20/25
66/66 [==============================] - 2s 29ms/step - loss: 0.2560 - accuracy: 0.9033 - val_loss: 2.4237 - val_accuracy: 0.4267
Epoch 21/25
66/66 [==============================] - 2s 33ms/step - loss: 0.2800 - accuracy: 0.8881 - val_loss: 2.5356 - val_accuracy: 0.4533
Epoch 22/25
66/66 [==============================] - 2s 30ms/step - loss: 0.1860 - accuracy: 0.9310 - val_loss: 2.9788 - val_accuracy: 0.4600
Epoch 23/25
66/66 [==============================] - 2s 30ms/step - loss: 0.1528 - accuracy: 0.9419 - val_loss: 2.8709 - val_accuracy: 0.4422
Epoch 24/25
66/66 [==============================] - 2s 29ms/step - loss: 0.1768 - accuracy: 0.9352 - val_loss: 2.7626 - val_accuracy: 0.4800
Epoch 25/25
66/66 [==============================] - 2s 30ms/step - loss: 0.2143 - accuracy: 0.9300 - val_loss: 2.9599 - val_accuracy: 0.4378
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="156"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T10:15:58.482240Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T10:15:58.481865Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T10:15:58.775514Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T10:15:58.774453Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T10:15:58.482206Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb156"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>fcl_loss, fcl_accuracy <span class="op">=</span> cnn.evaluate(X_test, y_test, verbose<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Test loss: </span><span class="sc">{:.2f}</span><span class="st">&#39;</span>.<span class="bu">format</span>(fcl_loss))</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Test accuracy: </span><span class="sc">{:.2f}</span><span class="st">&#39;</span>.<span class="bu">format</span>(fcl_accuracy<span class="op">*</span><span class="dv">100</span>),<span class="st">&#39;%&#39;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>15/15 [==============================] - 0s 12ms/step - loss: 2.4070 - accuracy: 0.4889
Test loss: 2.41
Test accuracy: 48.89 %
</code></pre>
</div>
</div>
<div class="cell markdown">
<h4
id="training-accuracy-is-about40--test-accuracy-is-about-39">Training
accuracy is about40% &amp; Test accuracy is about 39%.</h4>
<h4
id="this-is-very-low-let-us-try-other-pretrained-models-such-as-vgg16resnet50unet--rcnn">This
is very low. Let us try other pretrained models such as
VGG16,Resnet50,Unet &amp; RCNN</h4>
</div>
<div class="cell code" data-execution_count="157"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T10:16:02.898284Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T10:16:02.897918Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T10:16:03.822341Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T10:16:03.821349Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T10:16:02.898250Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb158"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the training accuracy, validation accuracy, training loss, and validation loss from the history dictionary</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>acc <span class="op">=</span> history.history[<span class="st">&#39;accuracy&#39;</span>]</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>val_acc <span class="op">=</span> history.history[<span class="st">&#39;val_accuracy&#39;</span>]</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>loss <span class="op">=</span> history.history[<span class="st">&#39;loss&#39;</span>]</span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>val_loss <span class="op">=</span> history.history[<span class="st">&#39;val_loss&#39;</span>]</span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the number of epochs from the history object</span></span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>epochs_range <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(acc) <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a 2x2 grid of subplots for displaying the accuracy and loss graphs</span></span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the training accuracy and validation accuracy over the range of epochs</span></span>
<span id="cb158-11"><a href="#cb158-11" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb158-12"><a href="#cb158-12" aria-hidden="true" tabindex="-1"></a>plt.plot(epochs_range, acc, label<span class="op">=</span><span class="st">&#39;Training Accuracy&#39;</span>, color<span class="op">=</span><span class="st">&#39;b&#39;</span>, marker<span class="op">=</span><span class="st">&#39;o&#39;</span>)</span>
<span id="cb158-13"><a href="#cb158-13" aria-hidden="true" tabindex="-1"></a>plt.plot(epochs_range, val_acc, label<span class="op">=</span><span class="st">&#39;Validation Accuracy&#39;</span>, color<span class="op">=</span><span class="st">&#39;r&#39;</span>, marker<span class="op">=</span><span class="st">&#39;s&#39;</span>)</span>
<span id="cb158-14"><a href="#cb158-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Epochs&#39;</span>)</span>
<span id="cb158-15"><a href="#cb158-15" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Accuracy&#39;</span>)</span>
<span id="cb158-16"><a href="#cb158-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Training and Validation Accuracy&#39;</span>)</span>
<span id="cb158-17"><a href="#cb158-17" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">&#39;lower right&#39;</span>)</span>
<span id="cb158-18"><a href="#cb158-18" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb158-19"><a href="#cb158-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the training loss and validation loss over the range of epochs</span></span>
<span id="cb158-20"><a href="#cb158-20" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb158-21"><a href="#cb158-21" aria-hidden="true" tabindex="-1"></a>plt.plot(epochs_range, loss, label<span class="op">=</span><span class="st">&#39;Training Loss&#39;</span>, color<span class="op">=</span><span class="st">&#39;b&#39;</span>, marker<span class="op">=</span><span class="st">&#39;o&#39;</span>)</span>
<span id="cb158-22"><a href="#cb158-22" aria-hidden="true" tabindex="-1"></a>plt.plot(epochs_range, val_loss, label<span class="op">=</span><span class="st">&#39;Validation Loss&#39;</span>, color<span class="op">=</span><span class="st">&#39;r&#39;</span>, marker<span class="op">=</span><span class="st">&#39;s&#39;</span>)</span>
<span id="cb158-23"><a href="#cb158-23" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Epochs&#39;</span>)</span>
<span id="cb158-24"><a href="#cb158-24" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Loss&#39;</span>)</span>
<span id="cb158-25"><a href="#cb158-25" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Training and Validation Loss&#39;</span>)</span>
<span id="cb158-26"><a href="#cb158-26" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">&#39;upper right&#39;</span>)</span>
<span id="cb158-27"><a href="#cb158-27" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb158-28"><a href="#cb158-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the layout to avoid overlapping</span></span>
<span id="cb158-29"><a href="#cb158-29" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb158-30"><a href="#cb158-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plots</span></span>
<span id="cb158-31"><a href="#cb158-31" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/11b3360598d87cc2073fb04f12f59a5f220d78ea.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="158"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T10:16:05.442915Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T10:16:05.442155Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T10:16:05.449058Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T10:16:05.447673Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T10:16:05.442878Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb159"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a DataFrame to store the results of the Convolutional Neural Network (CNN) model.</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;Method&#39; column will contain the name of the model (in this case, &quot;CNN&quot;).</span></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;accuracy&#39; column will store the accuracy obtained from the training phase (last epoch).</span></span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;Test Score&#39; column will store the accuracy obtained from evaluating the model on the test dataset.</span></span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>resultDF <span class="op">=</span> createResultDf(<span class="st">&quot;CNN&quot;</span>, acc[<span class="op">-</span><span class="dv">1</span>], fcl_accuracy)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="159"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T10:16:07.338667Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T10:16:07.337669Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T10:16:08.135272Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T10:16:08.134316Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T10:16:07.338630Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb160"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the size of the plot</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>plt.subplots(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>))</span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to plot the confusion matrix</span></span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_confusion_matrix(cm, classes,</span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a>                          normalize<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a>                          title<span class="op">=</span><span class="st">&#39;Confusion matrix&#39;</span>,</span>
<span id="cb160-8"><a href="#cb160-8" aria-hidden="true" tabindex="-1"></a>                          cmap<span class="op">=</span>plt.cm.Blues):</span>
<span id="cb160-9"><a href="#cb160-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot the confusion matrix as an image with the specified colormap</span></span>
<span id="cb160-10"><a href="#cb160-10" aria-hidden="true" tabindex="-1"></a>    plt.imshow(cm, interpolation<span class="op">=</span><span class="st">&#39;nearest&#39;</span>, cmap<span class="op">=</span>cmap)</span>
<span id="cb160-11"><a href="#cb160-11" aria-hidden="true" tabindex="-1"></a>    plt.title(title)</span>
<span id="cb160-12"><a href="#cb160-12" aria-hidden="true" tabindex="-1"></a>    plt.colorbar()</span>
<span id="cb160-13"><a href="#cb160-13" aria-hidden="true" tabindex="-1"></a>    tick_marks <span class="op">=</span> np.arange(<span class="bu">len</span>(classes))</span>
<span id="cb160-14"><a href="#cb160-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set the class labels as x-ticks and y-ticks with rotation for better visibility</span></span>
<span id="cb160-15"><a href="#cb160-15" aria-hidden="true" tabindex="-1"></a>    plt.xticks(tick_marks, classes, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb160-16"><a href="#cb160-16" aria-hidden="true" tabindex="-1"></a>    plt.yticks(tick_marks, classes)</span>
<span id="cb160-17"><a href="#cb160-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-18"><a href="#cb160-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Normalize the confusion matrix if required</span></span>
<span id="cb160-19"><a href="#cb160-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> normalize:</span>
<span id="cb160-20"><a href="#cb160-20" aria-hidden="true" tabindex="-1"></a>        cm <span class="op">=</span> cm.astype(<span class="st">&#39;float&#39;</span>) <span class="op">/</span> cm.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)[:, np.newaxis]</span>
<span id="cb160-21"><a href="#cb160-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-22"><a href="#cb160-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Determine the threshold to set text color in the plot</span></span>
<span id="cb160-23"><a href="#cb160-23" aria-hidden="true" tabindex="-1"></a>    thresh <span class="op">=</span> cm.<span class="bu">max</span>() <span class="op">/</span> <span class="fl">2.</span></span>
<span id="cb160-24"><a href="#cb160-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add text annotations to the plot, showing the values in each cell of the confusion matrix</span></span>
<span id="cb160-25"><a href="#cb160-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, j <span class="kw">in</span> itertools.product(<span class="bu">range</span>(cm.shape[<span class="dv">0</span>]), <span class="bu">range</span>(cm.shape[<span class="dv">1</span>])):</span>
<span id="cb160-26"><a href="#cb160-26" aria-hidden="true" tabindex="-1"></a>        plt.text(j, i, cm[i, j],</span>
<span id="cb160-27"><a href="#cb160-27" aria-hidden="true" tabindex="-1"></a>                 horizontalalignment<span class="op">=</span><span class="st">&quot;center&quot;</span>,</span>
<span id="cb160-28"><a href="#cb160-28" aria-hidden="true" tabindex="-1"></a>                 color<span class="op">=</span><span class="st">&quot;white&quot;</span> <span class="cf">if</span> cm[i, j] <span class="op">&gt;</span> thresh <span class="cf">else</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb160-29"><a href="#cb160-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-30"><a href="#cb160-30" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb160-31"><a href="#cb160-31" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">&#39;True label&#39;</span>)</span>
<span id="cb160-32"><a href="#cb160-32" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">&#39;Predicted label&#39;</span>)</span>
<span id="cb160-33"><a href="#cb160-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-34"><a href="#cb160-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict the values from the validation dataset</span></span>
<span id="cb160-35"><a href="#cb160-35" aria-hidden="true" tabindex="-1"></a>Y_pred <span class="op">=</span> cnn.predict(X_test)</span>
<span id="cb160-36"><a href="#cb160-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert predictions classes to one hot vectors </span></span>
<span id="cb160-37"><a href="#cb160-37" aria-hidden="true" tabindex="-1"></a>Y_pred_classes <span class="op">=</span> np.argmax(Y_pred, axis<span class="op">=</span><span class="dv">1</span>) </span>
<span id="cb160-38"><a href="#cb160-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert validation observations to one hot vectors</span></span>
<span id="cb160-39"><a href="#cb160-39" aria-hidden="true" tabindex="-1"></a>Y_true <span class="op">=</span> np.argmax(y_test, axis<span class="op">=</span><span class="dv">1</span>) </span>
<span id="cb160-40"><a href="#cb160-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the confusion matrix</span></span>
<span id="cb160-41"><a href="#cb160-41" aria-hidden="true" tabindex="-1"></a>confusion_mtx <span class="op">=</span> confusion_matrix(Y_true, Y_pred_classes) </span>
<span id="cb160-42"><a href="#cb160-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the confusion matrix</span></span>
<span id="cb160-43"><a href="#cb160-43" aria-hidden="true" tabindex="-1"></a>plot_confusion_matrix(confusion_mtx, classes<span class="op">=</span><span class="bu">range</span>(<span class="dv">3</span>))</span>
<span id="cb160-44"><a href="#cb160-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-45"><a href="#cb160-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 0, 1, and 2</span></span>
<span id="cb160-46"><a href="#cb160-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 0 is Lung Opacity</span></span>
<span id="cb160-47"><a href="#cb160-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 1 is No Lung Opacity/Normal, the model has predicted mostly wrong in this case to the Target 0. Type 2 error</span></span>
<span id="cb160-48"><a href="#cb160-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 2 is Normal</span></span></code></pre></div>
<div class="output stream stdout">
<pre><code>15/15 [==============================] - 0s 9ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/f6867351229a4f68aefb3bde1885ab55f1869590.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="160"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T10:16:09.583135Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T10:16:09.582427Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T10:16:10.215274Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T10:16:10.214321Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T10:16:09.583101Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb162"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict the values from the validation dataset</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>Y_pred <span class="op">=</span> cnn.predict(X_test)</span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert predictions classes to one hot vectors </span></span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>Y_pred_classes <span class="op">=</span> np.argmax(Y_pred, axis<span class="op">=</span><span class="dv">1</span>) </span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert validation observations to one hot vectors</span></span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a>Y_true <span class="op">=</span> np.argmax(y_test, axis<span class="op">=</span><span class="dv">1</span>) </span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the classification report as a string</span></span>
<span id="cb162-8"><a href="#cb162-8" aria-hidden="true" tabindex="-1"></a>class_report <span class="op">=</span> classification_report(Y_true, Y_pred_classes)</span>
<span id="cb162-9"><a href="#cb162-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Classification Report:&quot;</span>)</span>
<span id="cb162-10"><a href="#cb162-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(class_report)</span>
<span id="cb162-11"><a href="#cb162-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the classification report string to a DataFrame for visualization</span></span>
<span id="cb162-12"><a href="#cb162-12" aria-hidden="true" tabindex="-1"></a>report_data <span class="op">=</span> []</span>
<span id="cb162-13"><a href="#cb162-13" aria-hidden="true" tabindex="-1"></a>lines <span class="op">=</span> class_report.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb162-14"><a href="#cb162-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> line <span class="kw">in</span> lines[<span class="dv">2</span>:<span class="op">-</span><span class="dv">5</span>]:</span>
<span id="cb162-15"><a href="#cb162-15" aria-hidden="true" tabindex="-1"></a>    row <span class="op">=</span> line.split()</span>
<span id="cb162-16"><a href="#cb162-16" aria-hidden="true" tabindex="-1"></a>    report_data.append(row)</span>
<span id="cb162-17"><a href="#cb162-17" aria-hidden="true" tabindex="-1"></a>df_report <span class="op">=</span> pd.DataFrame(report_data, columns<span class="op">=</span>[<span class="st">&#39;Class&#39;</span>, <span class="st">&#39;Precision&#39;</span>, <span class="st">&#39;Recall&#39;</span>, <span class="st">&#39;F1-score&#39;</span>, <span class="st">&#39;Support&#39;</span>])</span>
<span id="cb162-18"><a href="#cb162-18" aria-hidden="true" tabindex="-1"></a>df_report <span class="op">=</span> df_report.set_index(<span class="st">&#39;Class&#39;</span>)</span>
<span id="cb162-19"><a href="#cb162-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the metrics to numeric values for visualization</span></span>
<span id="cb162-20"><a href="#cb162-20" aria-hidden="true" tabindex="-1"></a>df_report <span class="op">=</span> df_report.astype(<span class="bu">float</span>)</span>
<span id="cb162-21"><a href="#cb162-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a heatmap of the classification report</span></span>
<span id="cb162-22"><a href="#cb162-22" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb162-23"><a href="#cb162-23" aria-hidden="true" tabindex="-1"></a>sns.heatmap(df_report, annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">&#39;Blues&#39;</span>, fmt<span class="op">=</span><span class="st">&#39;.2f&#39;</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb162-24"><a href="#cb162-24" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Classification Report Heatmap&#39;</span>)</span>
<span id="cb162-25"><a href="#cb162-25" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Metrics&#39;</span>)</span>
<span id="cb162-26"><a href="#cb162-26" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Class&#39;</span>)</span>
<span id="cb162-27"><a href="#cb162-27" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>15/15 [==============================] - 0s 10ms/step
Classification Report:
              precision    recall  f1-score   support

           0       0.53      0.52      0.52       152
           1       0.39      0.47      0.43       150
           2       0.58      0.47      0.52       148

    accuracy                           0.49       450
   macro avg       0.50      0.49      0.49       450
weighted avg       0.50      0.49      0.49       450

</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/b73d1c5400fa5d8b9def6a9ceafbc8a4ad4973ca.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="161"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T10:16:11.111086Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T10:16:11.110183Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T10:16:11.364595Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T10:16:11.363450Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T10:16:11.111034Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb164"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert validation observations to one hot vectors</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>Y_truepred <span class="op">=</span> np.argmax(y_test, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict the values from the validation dataset</span></span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>Y_testPred <span class="op">=</span> cnn.predict(X_test)</span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert predictions classes to one hot vectors </span></span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a>Y_pred_classes <span class="op">=</span> np.argmax(Y_pred, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb164-8"><a href="#cb164-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-9"><a href="#cb164-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate a classification report as a dictionary</span></span>
<span id="cb164-10"><a href="#cb164-10" aria-hidden="true" tabindex="-1"></a>reportData <span class="op">=</span> classification_report(Y_truepred, Y_pred_classes, output_dict<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb164-11"><a href="#cb164-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-12"><a href="#cb164-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate over the data in the classification report</span></span>
<span id="cb164-13"><a href="#cb164-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> data <span class="kw">in</span> reportData:</span>
<span id="cb164-14"><a href="#cb164-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if the data is related to class -1 or 1 (binary classification)</span></span>
<span id="cb164-15"><a href="#cb164-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> data <span class="op">==</span> <span class="st">&#39;-1&#39;</span> <span class="kw">or</span> data <span class="op">==</span> <span class="st">&#39;1&#39;</span>:</span>
<span id="cb164-16"><a href="#cb164-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check if the data is a dictionary (contains precision, recall, f1-score, etc.)</span></span>
<span id="cb164-17"><a href="#cb164-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>(reportData[data]) <span class="kw">is</span> <span class="bu">dict</span>:</span>
<span id="cb164-18"><a href="#cb164-18" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Iterate over the sub-data (precision, recall, f1-score, etc.) in the dictionary</span></span>
<span id="cb164-19"><a href="#cb164-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> subData <span class="kw">in</span> reportData[data]:</span>
<span id="cb164-20"><a href="#cb164-20" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Add the sub-data to the result DataFrame with appropriate column names</span></span>
<span id="cb164-21"><a href="#cb164-21" aria-hidden="true" tabindex="-1"></a>                value <span class="op">=</span> <span class="bu">round</span>(reportData[data][subData], <span class="dv">2</span>)  <span class="co"># Round to 2 decimals</span></span>
<span id="cb164-22"><a href="#cb164-22" aria-hidden="true" tabindex="-1"></a>                resultDF[data <span class="op">+</span> <span class="st">&quot;_&quot;</span> <span class="op">+</span> subData] <span class="op">=</span> value</span>
<span id="cb164-23"><a href="#cb164-23" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb164-24"><a href="#cb164-24" aria-hidden="true" tabindex="-1"></a>resultDF</span>
<span id="cb164-25"><a href="#cb164-25" aria-hidden="true" tabindex="-1"></a><span class="co"># The resultDF DataFrame contains the metrics for class -1 and 1 in binary classification</span></span>
<span id="cb164-26"><a href="#cb164-26" aria-hidden="true" tabindex="-1"></a><span class="co"># These metrics include precision, recall, f1-score, support, etc.</span></span></code></pre></div>
<div class="output stream stdout">
<pre><code>15/15 [==============================] - 0s 8ms/step
</code></pre>
</div>
<div class="output execute_result" data-execution_count="161">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Method</th>
      <th>accuracy</th>
      <th>Test Score</th>
      <th>1_precision</th>
      <th>1_recall</th>
      <th>1_f1-score</th>
      <th>1_support</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>CNN</td>
      <td>0.93</td>
      <td>0.488889</td>
      <td>0.39</td>
      <td>0.47</td>
      <td>0.43</td>
      <td>150</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell code" data-execution_count="162"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T10:16:12.881578Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T10:16:12.880972Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T10:16:13.121528Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T10:16:13.120460Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T10:16:12.881530Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb166"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating copies of the datasets</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy the training dataset (X_train) to X_train1</span></span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>X_train1 <span class="op">=</span> X_train.copy()</span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy the validation dataset (X_val) to X_val1</span></span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a>X_val1 <span class="op">=</span> X_val.copy()</span>
<span id="cb166-8"><a href="#cb166-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-9"><a href="#cb166-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy the test dataset (X_test) to X_test1</span></span>
<span id="cb166-10"><a href="#cb166-10" aria-hidden="true" tabindex="-1"></a>X_test1 <span class="op">=</span> X_test.copy()</span>
<span id="cb166-11"><a href="#cb166-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-12"><a href="#cb166-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Now you have new arrays X_train1, X_val1, and X_test1, which are copies of the original datasets</span></span>
<span id="cb166-13"><a href="#cb166-13" aria-hidden="true" tabindex="-1"></a><span class="co"># You can perform operations or transformations on these new arrays without modifying the original data</span></span></code></pre></div>
</div>
<section id="cnn-model-with-transfer-learning-using-vgg16"
class="cell markdown">
<h1>CNN Model with Transfer learning using VGG16</h1>
</section>
<div class="cell code" data-execution_count="101"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T09:38:37.601437Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T09:38:37.601054Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T09:38:47.492474Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T09:38:47.491452Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T09:38:37.601378Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb167"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="co"># VGG16 is a well-documented and widely used convolutional neural network architecture</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Setting include_top=False removes the classification layer that was trained on the ImageNet dataset</span></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The input_shape parameter is set to the shape of the training data samples (X_train[0].shape)</span></span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a>base_model <span class="op">=</span> VGG16(weights<span class="op">=</span><span class="st">&quot;imagenet&quot;</span>, include_top<span class="op">=</span><span class="va">False</span>, input_shape<span class="op">=</span>X_train[<span class="dv">0</span>].shape)</span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the base model&#39;s weights as not trainable</span></span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a>base_model.trainable <span class="op">=</span> <span class="va">False</span></span>
<span id="cb167-8"><a href="#cb167-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-9"><a href="#cb167-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Preprocess the input data using the VGG16 preprocess_input function</span></span>
<span id="cb167-10"><a href="#cb167-10" aria-hidden="true" tabindex="-1"></a><span class="co"># This function applies necessary transformations to the input data to be compatible with VGG16</span></span>
<span id="cb167-11"><a href="#cb167-11" aria-hidden="true" tabindex="-1"></a><span class="co"># The training dataset is preprocessed and stored in train_ds</span></span>
<span id="cb167-12"><a href="#cb167-12" aria-hidden="true" tabindex="-1"></a><span class="co"># The validation dataset is preprocessed and stored in train_val_df</span></span>
<span id="cb167-13"><a href="#cb167-13" aria-hidden="true" tabindex="-1"></a>train_ds <span class="op">=</span> preprocess_input(X_train1) </span>
<span id="cb167-14"><a href="#cb167-14" aria-hidden="true" tabindex="-1"></a>train_val_df <span class="op">=</span> preprocess_input(X_val1)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Downloading data from https://storage.googleapis.com/tensorflow/keras-applications/vgg16/vgg16_weights_tf_dim_ordering_tf_kernels_notop.h5
58889256/58889256 [==============================] - 0s 0us/step
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="102"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T09:38:51.585716Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T09:38:51.584734Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T09:38:51.717062Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T09:38:51.715960Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T09:38:51.585667Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb169"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a flatten layer to convert the 2D feature maps to a 1D vector</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>flatten_layer <span class="op">=</span> layers.Flatten()</span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the first dense (fully connected) layer with 50 units and ReLU activation function</span></span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>dense_layer_1 <span class="op">=</span> layers.Dense(<span class="dv">50</span>, activation<span class="op">=</span><span class="st">&#39;relu&#39;</span>)</span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the second dense (fully connected) layer with 20 units and ReLU activation function</span></span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a>dense_layer_2 <span class="op">=</span> layers.Dense(<span class="dv">20</span>, activation<span class="op">=</span><span class="st">&#39;relu&#39;</span>)</span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the prediction layer with 3 units (for 3 classes) and softmax activation function</span></span>
<span id="cb169-8"><a href="#cb169-8" aria-hidden="true" tabindex="-1"></a>prediction_layer <span class="op">=</span> layers.Dense(<span class="dv">3</span>, activation<span class="op">=</span><span class="st">&#39;softmax&#39;</span>)</span>
<span id="cb169-9"><a href="#cb169-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-10"><a href="#cb169-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the CNN model using a Sequential model</span></span>
<span id="cb169-11"><a href="#cb169-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the base_model (pre-trained VGG16) followed by the defined layers</span></span>
<span id="cb169-12"><a href="#cb169-12" aria-hidden="true" tabindex="-1"></a>cnn_VGG16_model <span class="op">=</span> models.Sequential([</span>
<span id="cb169-13"><a href="#cb169-13" aria-hidden="true" tabindex="-1"></a>    base_model,</span>
<span id="cb169-14"><a href="#cb169-14" aria-hidden="true" tabindex="-1"></a>    flatten_layer,</span>
<span id="cb169-15"><a href="#cb169-15" aria-hidden="true" tabindex="-1"></a>    dense_layer_1,</span>
<span id="cb169-16"><a href="#cb169-16" aria-hidden="true" tabindex="-1"></a>    dense_layer_2,</span>
<span id="cb169-17"><a href="#cb169-17" aria-hidden="true" tabindex="-1"></a>    prediction_layer</span>
<span id="cb169-18"><a href="#cb169-18" aria-hidden="true" tabindex="-1"></a>])</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="103"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T09:38:53.927944Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T09:38:53.926911Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T09:39:56.859880Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T09:39:56.858878Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T09:38:53.927897Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb170"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compile the CNN model with the Adam optimizer, binary cross-entropy loss, and accuracy metric</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>cnn_VGG16_model.<span class="bu">compile</span>(</span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>    optimizer<span class="op">=</span><span class="st">&#39;Adam&#39;</span>,</span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a>    loss<span class="op">=</span>tf.keras.losses.BinaryCrossentropy(from_logits<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a>    metrics<span class="op">=</span>[<span class="st">&#39;accuracy&#39;</span>],</span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an EarlyStopping callback to stop training when validation accuracy doesn&#39;t improve for 7 iterations</span></span>
<span id="cb170-8"><a href="#cb170-8" aria-hidden="true" tabindex="-1"></a><span class="co"># The monitor &#39;val_accuracy&#39; tracks validation accuracy, mode &#39;auto&#39; selects the direction to monitor for improvement</span></span>
<span id="cb170-9"><a href="#cb170-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Patience is set to 7, which means training will stop after 7 epochs without improvement</span></span>
<span id="cb170-10"><a href="#cb170-10" aria-hidden="true" tabindex="-1"></a><span class="co"># restore_best_weights=True restores the weights of the model to the best observed during training</span></span>
<span id="cb170-11"><a href="#cb170-11" aria-hidden="true" tabindex="-1"></a>es <span class="op">=</span> EarlyStopping(monitor<span class="op">=</span><span class="st">&#39;val_accuracy&#39;</span>, mode<span class="op">=</span><span class="st">&#39;auto&#39;</span>, patience<span class="op">=</span><span class="dv">7</span>, restore_best_weights<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb170-12"><a href="#cb170-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model using the fit() method</span></span>
<span id="cb170-13"><a href="#cb170-13" aria-hidden="true" tabindex="-1"></a><span class="co"># The training data is provided as &#39;train_ds&#39; and the target labels as &#39;y_train&#39;</span></span>
<span id="cb170-14"><a href="#cb170-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Validation data is provided as &#39;train_val_df&#39; and validation target labels as &#39;y_val&#39;</span></span>
<span id="cb170-15"><a href="#cb170-15" aria-hidden="true" tabindex="-1"></a><span class="co"># The fit() method will use the EarlyStopping callback to monitor validation accuracy and stop training if needed</span></span>
<span id="cb170-16"><a href="#cb170-16" aria-hidden="true" tabindex="-1"></a>history_VGG16 <span class="op">=</span> cnn_VGG16_model.fit(train_ds, y_train, epochs<span class="op">=</span><span class="dv">30</span>, validation_data<span class="op">=</span>(train_val_df, y_val), callbacks<span class="op">=</span>es)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Epoch 1/30
66/66 [==============================] - 17s 92ms/step - loss: 0.7799 - accuracy: 0.3362 - val_loss: 0.6864 - val_accuracy: 0.2933
Epoch 2/30
66/66 [==============================] - 3s 50ms/step - loss: 0.6809 - accuracy: 0.3448 - val_loss: 0.6772 - val_accuracy: 0.2933
Epoch 3/30
66/66 [==============================] - 3s 51ms/step - loss: 0.6730 - accuracy: 0.3467 - val_loss: 0.6703 - val_accuracy: 0.2956
Epoch 4/30
66/66 [==============================] - 3s 52ms/step - loss: 0.6644 - accuracy: 0.3505 - val_loss: 0.6654 - val_accuracy: 0.2933
Epoch 5/30
66/66 [==============================] - 3s 52ms/step - loss: 0.6651 - accuracy: 0.3510 - val_loss: 0.6597 - val_accuracy: 0.2933
Epoch 6/30
66/66 [==============================] - 3s 51ms/step - loss: 0.6579 - accuracy: 0.3452 - val_loss: 0.6554 - val_accuracy: 0.2933
Epoch 7/30
66/66 [==============================] - 3s 51ms/step - loss: 0.6491 - accuracy: 0.3476 - val_loss: 0.6462 - val_accuracy: 0.3067
Epoch 8/30
66/66 [==============================] - 3s 50ms/step - loss: 0.6444 - accuracy: 0.3576 - val_loss: 0.6435 - val_accuracy: 0.3022
Epoch 9/30
66/66 [==============================] - 3s 51ms/step - loss: 0.6402 - accuracy: 0.3514 - val_loss: 0.6433 - val_accuracy: 0.3022
Epoch 10/30
66/66 [==============================] - 3s 51ms/step - loss: 0.6374 - accuracy: 0.3519 - val_loss: 0.6390 - val_accuracy: 0.3022
Epoch 11/30
66/66 [==============================] - 3s 52ms/step - loss: 0.6325 - accuracy: 0.3514 - val_loss: 0.6390 - val_accuracy: 0.3022
Epoch 12/30
66/66 [==============================] - 3s 51ms/step - loss: 0.6297 - accuracy: 0.3514 - val_loss: 0.6408 - val_accuracy: 0.3022
Epoch 13/30
66/66 [==============================] - 3s 51ms/step - loss: 0.6290 - accuracy: 0.3529 - val_loss: 0.6387 - val_accuracy: 0.2978
Epoch 14/30
66/66 [==============================] - 4s 54ms/step - loss: 0.6272 - accuracy: 0.3495 - val_loss: 0.6444 - val_accuracy: 0.2978
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="104"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T09:40:05.617457Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T09:40:05.616267Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T09:40:06.797121Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T09:40:06.796051Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T09:40:05.617387Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb172"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preprocess the input test data using the VGG16 preprocessing function</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>test_ds <span class="op">=</span> preprocess_input(X_test1) </span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate the CNN VGG16 model on the preprocessed test data and target labels</span></span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a>vgg16_loss, vgg16_accuracy <span class="op">=</span> cnn_VGG16_model.evaluate(test_ds, y_test, verbose<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the test loss and accuracy scores with two decimal places</span></span>
<span id="cb172-8"><a href="#cb172-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Test loss for VGG16 trained Model: </span><span class="sc">{:.2f}</span><span class="st">&#39;</span>.<span class="bu">format</span>(vgg16_loss))</span>
<span id="cb172-9"><a href="#cb172-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Test accuracy for VGG16 trained Model: </span><span class="sc">{:.2f}</span><span class="st">&#39;</span>.<span class="bu">format</span>(vgg16_accuracy<span class="op">*</span><span class="dv">100</span>),<span class="st">&#39;%&#39;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>15/15 [==============================] - 1s 42ms/step - loss: 0.6535 - accuracy: 0.3333
Test loss for VGG16 trained Model: 0.65
Test accuracy for VGG16 trained Model: 33.33 %
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="163"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T10:16:25.118573Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T10:16:25.118133Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T10:16:25.128418Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T10:16:25.127060Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T10:16:25.118538Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb174"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate two DataFrames: &#39;resultDF&#39; and the DataFrame created by the &#39;createResultDf&#39; function</span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The DataFrame &#39;resultDF&#39; should already contain the evaluation metrics for the previous model (CNN)</span></span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;createResultDf&#39; function is used to create a DataFrame for the current model (CNN with VGG16)</span></span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a><span class="co"># The first DataFrame &#39;resultDF&#39; contains the evaluation metrics for the previous model (CNN)</span></span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a><span class="co"># The second DataFrame is created using the &#39;createResultDf&#39; function, which takes three parameters:</span></span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     - The title &quot;CNN With VGG16&quot;</span></span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true" tabindex="-1"></a><span class="co">#     - The accuracy of the previous model (0.99)</span></span>
<span id="cb174-9"><a href="#cb174-9" aria-hidden="true" tabindex="-1"></a><span class="co">#     - The accuracy of the current model (fcl_accuracy, which is the test accuracy of the CNN with VGG16 model)</span></span>
<span id="cb174-10"><a href="#cb174-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-11"><a href="#cb174-11" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;pd.concat&#39; function is used to concatenate the two DataFrames vertically, resulting in a single DataFrame containing evaluation metrics for both models</span></span>
<span id="cb174-12"><a href="#cb174-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-13"><a href="#cb174-13" aria-hidden="true" tabindex="-1"></a>resultsDf1 <span class="op">=</span> pd.concat([resultDF, createResultDf(<span class="st">&quot;CNN With VGG16&quot;</span>, <span class="fl">0.6992</span>, vgg16_accuracy)])</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="164"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T10:16:27.913932Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T10:16:27.913501Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T10:16:27.932544Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T10:16:27.931194Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T10:16:27.913895Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb175"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>resultsDf1</span></code></pre></div>
<div class="output execute_result" data-execution_count="164">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Method</th>
      <th>accuracy</th>
      <th>Test Score</th>
      <th>1_precision</th>
      <th>1_recall</th>
      <th>1_f1-score</th>
      <th>1_support</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>CNN</td>
      <td>0.9300</td>
      <td>0.488889</td>
      <td>0.39</td>
      <td>0.47</td>
      <td>0.43</td>
      <td>150.0</td>
    </tr>
    <tr>
      <th>0</th>
      <td>CNN With VGG16</td>
      <td>0.6992</td>
      <td>0.333333</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<section id="cnn-with-resnet50" class="cell markdown">
<h2>CNN with ResNet50</h2>
</section>
<div class="cell code" data-execution_count="107"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T09:40:21.553868Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T09:40:21.553495Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T09:40:27.052116Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T09:40:27.051082Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T09:40:21.553838Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb176"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the ResNet50 base model with pre-trained weights from ImageNet dataset</span></span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Set include_top=False to exclude the classification layers and input_shape as the shape of your input images</span></span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>resnet_base_model <span class="op">=</span> ResNet50(include_top<span class="op">=</span><span class="va">False</span>, weights<span class="op">=</span><span class="st">&#39;imagenet&#39;</span>, input_shape<span class="op">=</span>X_train[<span class="dv">0</span>].shape)</span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Preprocess the training and validation data using the ResNet50 preprocessing function</span></span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a>train_ds_Resnet <span class="op">=</span> preprocess_input(X_train1) </span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a>train_val_df_Resnet <span class="op">=</span> preprocess_input(X_val1)</span>
<span id="cb176-8"><a href="#cb176-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-9"><a href="#cb176-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the additional layers for your custom classification model</span></span>
<span id="cb176-10"><a href="#cb176-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Flatten layer to convert 3D feature maps to 1D</span></span>
<span id="cb176-11"><a href="#cb176-11" aria-hidden="true" tabindex="-1"></a>flatten_layer <span class="op">=</span> layers.Flatten()</span>
<span id="cb176-12"><a href="#cb176-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-13"><a href="#cb176-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Dense layers with ReLU activation function</span></span>
<span id="cb176-14"><a href="#cb176-14" aria-hidden="true" tabindex="-1"></a>dense_layer_1 <span class="op">=</span> layers.Dense(<span class="dv">50</span>, activation<span class="op">=</span><span class="st">&#39;relu&#39;</span>)</span>
<span id="cb176-15"><a href="#cb176-15" aria-hidden="true" tabindex="-1"></a>dense_layer_2 <span class="op">=</span> layers.Dense(<span class="dv">32</span>, activation<span class="op">=</span><span class="st">&#39;relu&#39;</span>)</span>
<span id="cb176-16"><a href="#cb176-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-17"><a href="#cb176-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Output layer with softmax activation for multi-class classification (3 classes)</span></span>
<span id="cb176-18"><a href="#cb176-18" aria-hidden="true" tabindex="-1"></a>prediction_layer <span class="op">=</span> layers.Dense(<span class="dv">3</span>, activation<span class="op">=</span><span class="st">&#39;softmax&#39;</span>)</span>
<span id="cb176-19"><a href="#cb176-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-20"><a href="#cb176-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the custom CNN model by stacking the base model and additional layers</span></span>
<span id="cb176-21"><a href="#cb176-21" aria-hidden="true" tabindex="-1"></a>cnn_resnet_model <span class="op">=</span> models.Sequential([</span>
<span id="cb176-22"><a href="#cb176-22" aria-hidden="true" tabindex="-1"></a>    resnet_base_model,   <span class="co"># Include the ResNet50 base model</span></span>
<span id="cb176-23"><a href="#cb176-23" aria-hidden="true" tabindex="-1"></a>    flatten_layer,       <span class="co"># Flatten layer</span></span>
<span id="cb176-24"><a href="#cb176-24" aria-hidden="true" tabindex="-1"></a>    dense_layer_1,       <span class="co"># Dense layer 1 with ReLU activation</span></span>
<span id="cb176-25"><a href="#cb176-25" aria-hidden="true" tabindex="-1"></a>    dense_layer_2,       <span class="co"># Dense layer 2 with ReLU activation</span></span>
<span id="cb176-26"><a href="#cb176-26" aria-hidden="true" tabindex="-1"></a>    prediction_layer     <span class="co"># Output layer with softmax activation</span></span>
<span id="cb176-27"><a href="#cb176-27" aria-hidden="true" tabindex="-1"></a>])</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Downloading data from https://storage.googleapis.com/tensorflow/keras-applications/resnet/resnet50_weights_tf_dim_ordering_tf_kernels_notop.h5
94765736/94765736 [==============================] - 2s 0us/step
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="108"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T09:40:30.873192Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T09:40:30.872816Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T09:45:33.032827Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T09:45:33.031655Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T09:40:30.873159Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb178"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compile the CNN model with the specified optimizer, loss function, and evaluation metrics</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>cnn_resnet_model.<span class="bu">compile</span>(</span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>    optimizer<span class="op">=</span><span class="st">&#39;Adam&#39;</span>,   <span class="co"># Adam optimizer with default learning rate</span></span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>    loss<span class="op">=</span>tf.keras.losses.BinaryCrossentropy(from_logits<span class="op">=</span><span class="va">True</span>),   <span class="co"># BinaryCrossentropy loss function for multi-class classification</span></span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>    metrics<span class="op">=</span>[<span class="st">&#39;accuracy&#39;</span>]   <span class="co"># Evaluation metric - accuracy</span></span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the CNN model on the preprocessed training data for 30 epochs</span></span>
<span id="cb178-9"><a href="#cb178-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the validation data for monitoring model performance during training</span></span>
<span id="cb178-10"><a href="#cb178-10" aria-hidden="true" tabindex="-1"></a>history_resnet <span class="op">=</span> cnn_resnet_model.fit(</span>
<span id="cb178-11"><a href="#cb178-11" aria-hidden="true" tabindex="-1"></a>    train_ds_Resnet,   <span class="co"># Preprocessed training data</span></span>
<span id="cb178-12"><a href="#cb178-12" aria-hidden="true" tabindex="-1"></a>    y_train,    <span class="co"># Target labels for training data</span></span>
<span id="cb178-13"><a href="#cb178-13" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span><span class="dv">30</span>,  <span class="co"># Number of training epochs</span></span>
<span id="cb178-14"><a href="#cb178-14" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(train_val_df_Resnet, y_val)  <span class="co"># Validation data for monitoring model performance</span></span>
<span id="cb178-15"><a href="#cb178-15" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Epoch 1/30
66/66 [==============================] - 60s 183ms/step - loss: 0.6302 - accuracy: 0.5910 - val_loss: 3.8687 - val_accuracy: 0.3111
Epoch 2/30
66/66 [==============================] - 8s 123ms/step - loss: 0.4674 - accuracy: 0.6676 - val_loss: 1.6082 - val_accuracy: 0.4022
Epoch 3/30
66/66 [==============================] - 8s 121ms/step - loss: 0.4385 - accuracy: 0.6648 - val_loss: 1.1246 - val_accuracy: 0.5867
Epoch 4/30
66/66 [==============================] - 8s 122ms/step - loss: 0.4266 - accuracy: 0.6924 - val_loss: 0.6540 - val_accuracy: 0.6289
Epoch 5/30
66/66 [==============================] - 8s 123ms/step - loss: 0.3908 - accuracy: 0.7205 - val_loss: 0.4493 - val_accuracy: 0.6533
Epoch 6/30
66/66 [==============================] - 8s 125ms/step - loss: 0.3583 - accuracy: 0.7557 - val_loss: 1.3837 - val_accuracy: 0.5667
Epoch 7/30
66/66 [==============================] - 8s 125ms/step - loss: 0.3676 - accuracy: 0.7467 - val_loss: 3.9079 - val_accuracy: 0.3889
Epoch 8/30
66/66 [==============================] - 8s 125ms/step - loss: 0.3498 - accuracy: 0.7595 - val_loss: 0.5493 - val_accuracy: 0.5933
Epoch 9/30
66/66 [==============================] - 8s 127ms/step - loss: 0.3022 - accuracy: 0.8000 - val_loss: 1.0194 - val_accuracy: 0.6378
Epoch 10/30
66/66 [==============================] - 8s 124ms/step - loss: 0.2631 - accuracy: 0.8448 - val_loss: 0.5814 - val_accuracy: 0.6778
Epoch 11/30
66/66 [==============================] - 8s 124ms/step - loss: 0.2390 - accuracy: 0.8543 - val_loss: 1.5475 - val_accuracy: 0.5356
Epoch 12/30
66/66 [==============================] - 8s 124ms/step - loss: 0.2285 - accuracy: 0.8567 - val_loss: 0.7257 - val_accuracy: 0.6133
Epoch 13/30
66/66 [==============================] - 8s 125ms/step - loss: 0.2055 - accuracy: 0.8733 - val_loss: 0.9926 - val_accuracy: 0.6644
Epoch 14/30
66/66 [==============================] - 8s 124ms/step - loss: 0.1600 - accuracy: 0.9171 - val_loss: 2.6338 - val_accuracy: 0.6178
Epoch 15/30
66/66 [==============================] - 8s 127ms/step - loss: 0.1854 - accuracy: 0.8952 - val_loss: 1.0191 - val_accuracy: 0.6156
Epoch 16/30
66/66 [==============================] - 8s 127ms/step - loss: 0.1182 - accuracy: 0.9381 - val_loss: 0.7517 - val_accuracy: 0.6044
Epoch 17/30
66/66 [==============================] - 8s 128ms/step - loss: 0.1307 - accuracy: 0.9248 - val_loss: 0.7185 - val_accuracy: 0.6533
Epoch 18/30
66/66 [==============================] - 8s 125ms/step - loss: 0.0947 - accuracy: 0.9500 - val_loss: 1.2588 - val_accuracy: 0.5889
Epoch 19/30
66/66 [==============================] - 8s 126ms/step - loss: 0.1336 - accuracy: 0.9243 - val_loss: 0.8898 - val_accuracy: 0.5933
Epoch 20/30
66/66 [==============================] - 8s 127ms/step - loss: 0.0862 - accuracy: 0.9548 - val_loss: 1.0181 - val_accuracy: 0.6356
Epoch 21/30
66/66 [==============================] - 8s 125ms/step - loss: 0.0691 - accuracy: 0.9643 - val_loss: 1.9612 - val_accuracy: 0.5533
Epoch 22/30
66/66 [==============================] - 8s 128ms/step - loss: 0.0757 - accuracy: 0.9595 - val_loss: 1.2689 - val_accuracy: 0.6178
Epoch 23/30
66/66 [==============================] - 8s 128ms/step - loss: 0.0601 - accuracy: 0.9695 - val_loss: 1.0366 - val_accuracy: 0.6222
Epoch 24/30
66/66 [==============================] - 9s 129ms/step - loss: 0.0692 - accuracy: 0.9629 - val_loss: 1.0146 - val_accuracy: 0.6444
Epoch 25/30
66/66 [==============================] - 8s 126ms/step - loss: 0.0356 - accuracy: 0.9824 - val_loss: 1.2377 - val_accuracy: 0.6133
Epoch 26/30
66/66 [==============================] - 8s 128ms/step - loss: 0.0259 - accuracy: 0.9890 - val_loss: 1.0555 - val_accuracy: 0.6622
Epoch 27/30
66/66 [==============================] - 8s 128ms/step - loss: 0.0307 - accuracy: 0.9824 - val_loss: 1.1324 - val_accuracy: 0.6044
Epoch 28/30
66/66 [==============================] - 8s 129ms/step - loss: 0.0644 - accuracy: 0.9667 - val_loss: 1.1076 - val_accuracy: 0.6311
Epoch 29/30
66/66 [==============================] - 8s 128ms/step - loss: 0.1180 - accuracy: 0.9329 - val_loss: 1.4376 - val_accuracy: 0.6422
Epoch 30/30
66/66 [==============================] - 8s 126ms/step - loss: 0.0687 - accuracy: 0.9690 - val_loss: 0.9054 - val_accuracy: 0.6178
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="109"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T09:45:36.318067Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T09:45:36.317648Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T09:45:37.467991Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T09:45:37.466766Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T09:45:36.318030Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb180"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preprocess the input test data using the VGG16 preprocessing function</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>test_ds_Resnet <span class="op">=</span> preprocess_input(X_test1) </span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate the Resnet model on the preprocessed test data and target labels</span></span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a>Resnet_loss, Resnet_accuracy <span class="op">=</span> cnn_resnet_model.evaluate(test_ds_Resnet, y_test, verbose<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the test loss and accuracy scores with two decimal places</span></span>
<span id="cb180-8"><a href="#cb180-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Test loss for Resnet trained Model: </span><span class="sc">{:.2f}</span><span class="st">&#39;</span>.<span class="bu">format</span>(Resnet_loss))</span>
<span id="cb180-9"><a href="#cb180-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Test accuracy for Resnet trained Model: </span><span class="sc">{:.2f}</span><span class="st">&#39;</span>.<span class="bu">format</span>(Resnet_accuracy<span class="op">*</span><span class="dv">100</span>),<span class="st">&#39;%&#39;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>15/15 [==============================] - 1s 39ms/step - loss: 0.9397 - accuracy: 0.6289
Test loss for Resnet trained Model: 0.94
Test accuracy for Resnet trained Model: 62.89 %
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="110"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T09:45:39.286078Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T09:45:39.285710Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T09:45:40.318233Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T09:45:40.317105Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T09:45:39.286047Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb182"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the training accuracy, validation accuracy, training loss, and validation loss from the history dictionary</span></span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>acc <span class="op">=</span> history_resnet.history[<span class="st">&#39;accuracy&#39;</span>]</span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>val_acc <span class="op">=</span> history_resnet.history[<span class="st">&#39;val_accuracy&#39;</span>]</span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>loss <span class="op">=</span> history_resnet.history[<span class="st">&#39;loss&#39;</span>]</span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a>val_loss <span class="op">=</span> history_resnet.history[<span class="st">&#39;val_loss&#39;</span>]</span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the number of epochs from the history object</span></span>
<span id="cb182-8"><a href="#cb182-8" aria-hidden="true" tabindex="-1"></a>epochs_range <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(acc) <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb182-9"><a href="#cb182-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-10"><a href="#cb182-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a 2x2 grid of subplots for displaying the accuracy and loss graphs</span></span>
<span id="cb182-11"><a href="#cb182-11" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb182-12"><a href="#cb182-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-13"><a href="#cb182-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the training accuracy and validation accuracy over the range of epochs</span></span>
<span id="cb182-14"><a href="#cb182-14" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb182-15"><a href="#cb182-15" aria-hidden="true" tabindex="-1"></a>plt.plot(epochs_range, acc, label<span class="op">=</span><span class="st">&#39;Training Accuracy&#39;</span>, color<span class="op">=</span><span class="st">&#39;b&#39;</span>, marker<span class="op">=</span><span class="st">&#39;o&#39;</span>)</span>
<span id="cb182-16"><a href="#cb182-16" aria-hidden="true" tabindex="-1"></a>plt.plot(epochs_range, val_acc, label<span class="op">=</span><span class="st">&#39;Validation Accuracy&#39;</span>, color<span class="op">=</span><span class="st">&#39;r&#39;</span>, marker<span class="op">=</span><span class="st">&#39;s&#39;</span>)</span>
<span id="cb182-17"><a href="#cb182-17" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Epochs&#39;</span>)</span>
<span id="cb182-18"><a href="#cb182-18" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Accuracy&#39;</span>)</span>
<span id="cb182-19"><a href="#cb182-19" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Training and Validation Accuracy&#39;</span>)</span>
<span id="cb182-20"><a href="#cb182-20" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">&#39;lower right&#39;</span>)</span>
<span id="cb182-21"><a href="#cb182-21" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb182-22"><a href="#cb182-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-23"><a href="#cb182-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the training loss and validation loss over the range of epochs</span></span>
<span id="cb182-24"><a href="#cb182-24" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb182-25"><a href="#cb182-25" aria-hidden="true" tabindex="-1"></a>plt.plot(epochs_range, loss, label<span class="op">=</span><span class="st">&#39;Training Loss&#39;</span>, color<span class="op">=</span><span class="st">&#39;b&#39;</span>, marker<span class="op">=</span><span class="st">&#39;o&#39;</span>)</span>
<span id="cb182-26"><a href="#cb182-26" aria-hidden="true" tabindex="-1"></a>plt.plot(epochs_range, val_loss, label<span class="op">=</span><span class="st">&#39;Validation Loss&#39;</span>, color<span class="op">=</span><span class="st">&#39;r&#39;</span>, marker<span class="op">=</span><span class="st">&#39;s&#39;</span>)</span>
<span id="cb182-27"><a href="#cb182-27" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Epochs&#39;</span>)</span>
<span id="cb182-28"><a href="#cb182-28" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Loss&#39;</span>)</span>
<span id="cb182-29"><a href="#cb182-29" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Training and Validation Loss&#39;</span>)</span>
<span id="cb182-30"><a href="#cb182-30" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">&#39;upper right&#39;</span>)</span>
<span id="cb182-31"><a href="#cb182-31" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb182-32"><a href="#cb182-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-33"><a href="#cb182-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the layout to avoid overlapping</span></span>
<span id="cb182-34"><a href="#cb182-34" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb182-35"><a href="#cb182-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-36"><a href="#cb182-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plots</span></span>
<span id="cb182-37"><a href="#cb182-37" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/2b641aefe4af32b0046d1da7d291d7667610a4b5.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="111"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T09:45:42.802196Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T09:45:42.801634Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T09:45:45.451797Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T09:45:45.450754Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T09:45:42.802159Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb183"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the size of the plot</span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>plt.subplots(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>))</span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function to plot the confusion matrix</span></span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_confusion_matrix(cm, classes, normalize<span class="op">=</span><span class="va">False</span>, title<span class="op">=</span><span class="st">&#39;Confusion matrix&#39;</span>, cmap<span class="op">=</span>plt.cm.Blues):</span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Display the confusion matrix as an image with a colormap</span></span>
<span id="cb183-7"><a href="#cb183-7" aria-hidden="true" tabindex="-1"></a>    plt.imshow(cm, interpolation<span class="op">=</span><span class="st">&#39;nearest&#39;</span>, cmap<span class="op">=</span>cmap)</span>
<span id="cb183-8"><a href="#cb183-8" aria-hidden="true" tabindex="-1"></a>    plt.title(title)  <span class="co"># Set the title of the plot</span></span>
<span id="cb183-9"><a href="#cb183-9" aria-hidden="true" tabindex="-1"></a>    plt.colorbar()    <span class="co"># Add a color bar to the plot</span></span>
<span id="cb183-10"><a href="#cb183-10" aria-hidden="true" tabindex="-1"></a>    tick_marks <span class="op">=</span> np.arange(<span class="bu">len</span>(classes))</span>
<span id="cb183-11"><a href="#cb183-11" aria-hidden="true" tabindex="-1"></a>    plt.xticks(tick_marks, classes, rotation<span class="op">=</span><span class="dv">45</span>)  <span class="co"># Set the labels for the x-axis</span></span>
<span id="cb183-12"><a href="#cb183-12" aria-hidden="true" tabindex="-1"></a>    plt.yticks(tick_marks, classes)              <span class="co"># Set the labels for the y-axis</span></span>
<span id="cb183-13"><a href="#cb183-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-14"><a href="#cb183-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> normalize:</span>
<span id="cb183-15"><a href="#cb183-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Normalize the confusion matrix to show relative proportions</span></span>
<span id="cb183-16"><a href="#cb183-16" aria-hidden="true" tabindex="-1"></a>        cm <span class="op">=</span> cm.astype(<span class="st">&#39;float&#39;</span>) <span class="op">/</span> cm.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)[:, np.newaxis]</span>
<span id="cb183-17"><a href="#cb183-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-18"><a href="#cb183-18" aria-hidden="true" tabindex="-1"></a>    thresh <span class="op">=</span> cm.<span class="bu">max</span>() <span class="op">/</span> <span class="fl">2.</span></span>
<span id="cb183-19"><a href="#cb183-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, j <span class="kw">in</span> itertools.product(<span class="bu">range</span>(cm.shape[<span class="dv">0</span>]), <span class="bu">range</span>(cm.shape[<span class="dv">1</span>])):</span>
<span id="cb183-20"><a href="#cb183-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add text annotations to the cells of the confusion matrix</span></span>
<span id="cb183-21"><a href="#cb183-21" aria-hidden="true" tabindex="-1"></a>        plt.text(j, i, cm[i, j], horizontalalignment<span class="op">=</span><span class="st">&quot;center&quot;</span>, color<span class="op">=</span><span class="st">&quot;white&quot;</span> <span class="cf">if</span> cm[i, j] <span class="op">&gt;</span> thresh <span class="cf">else</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb183-22"><a href="#cb183-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-23"><a href="#cb183-23" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()    <span class="co"># Adjust the layout to prevent overlapping of elements</span></span>
<span id="cb183-24"><a href="#cb183-24" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">&#39;True label&#39;</span>)   <span class="co"># Set the label for the y-axis</span></span>
<span id="cb183-25"><a href="#cb183-25" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">&#39;Predicted label&#39;</span>)  <span class="co"># Set the label for the x-axis</span></span>
<span id="cb183-26"><a href="#cb183-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-27"><a href="#cb183-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict the values from the validation dataset using the trained CNN model</span></span>
<span id="cb183-28"><a href="#cb183-28" aria-hidden="true" tabindex="-1"></a>Y_pred_Resnet <span class="op">=</span> cnn_resnet_model.predict(test_ds_Resnet)</span>
<span id="cb183-29"><a href="#cb183-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert predicted probabilities to class labels</span></span>
<span id="cb183-30"><a href="#cb183-30" aria-hidden="true" tabindex="-1"></a>Y_pred_classes_Resnet <span class="op">=</span> np.argmax(Y_pred_Resnet, axis<span class="op">=</span><span class="dv">1</span>) </span>
<span id="cb183-31"><a href="#cb183-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert true class labels to one hot vectors</span></span>
<span id="cb183-32"><a href="#cb183-32" aria-hidden="true" tabindex="-1"></a>Y_true_Resnet <span class="op">=</span> np.argmax(y_test, axis<span class="op">=</span><span class="dv">1</span>) </span>
<span id="cb183-33"><a href="#cb183-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the confusion matrix</span></span>
<span id="cb183-34"><a href="#cb183-34" aria-hidden="true" tabindex="-1"></a>confusion_mtx_Resnet <span class="op">=</span> confusion_matrix(Y_true_Resnet, Y_pred_classes_Resnet) </span>
<span id="cb183-35"><a href="#cb183-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the confusion matrix using the defined function</span></span>
<span id="cb183-36"><a href="#cb183-36" aria-hidden="true" tabindex="-1"></a>plot_confusion_matrix(confusion_mtx_Resnet, classes<span class="op">=</span><span class="bu">range</span>(<span class="dv">3</span>))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>15/15 [==============================] - 2s 38ms/step
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/757b26dbca0e2459b95a9d25c921dd482c7b061a.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="112"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T09:45:46.789856Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T09:45:46.789475Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T09:45:46.807356Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T09:45:46.806040Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T09:45:46.789822Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb185"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(Y_true_Resnet, Y_pred_classes_Resnet))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>              precision    recall  f1-score   support

           0       0.71      0.47      0.57       152
           1       0.48      0.69      0.56       150
           2       0.81      0.73      0.77       148

    accuracy                           0.63       450
   macro avg       0.67      0.63      0.63       450
weighted avg       0.67      0.63      0.63       450

</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="273"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:47:28.032335Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:47:28.031274Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:47:28.088704Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:47:28.087709Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:47:28.032298Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb187"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> pd.read_csv(<span class="st">&quot;/kaggle/input/pneumonia-detection/stage_2_train_labels.csv&quot;</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="274"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:47:30.210670Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:47:30.210266Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:47:30.222612Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:47:30.221434Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:47:30.210637Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb188"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Getting the first 5000 data points for training and the next 5000 for validation</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>train_CombinedData <span class="op">=</span> labels[<span class="dv">0</span>:<span class="dv">5000</span>]</span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>validate_CombinedData <span class="op">=</span> labels[<span class="dv">5000</span>:<span class="dv">10000</span>]</span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Filling any missing values in the training and validation datasets with 0</span></span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a>train_CombinedData.fillna(<span class="dv">0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a>validate_CombinedData.fillna(<span class="dv">0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="275"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:47:32.310677Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:47:32.310242Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:47:32.319428Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:47:32.318187Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:47:32.310644Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb189"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking training data distuburtion , they have almos the same target distubution</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>train_CombinedData.Target.value_counts()</span></code></pre></div>
<div class="output execute_result" data-execution_count="275">
<pre><code>0    2633
1    2367
Name: Target, dtype: int64</code></pre>
</div>
</div>
<section
id="creating-custom-train-generator-this-will-read-the-files-in-batches-of-10-while-training-the-model"
class="cell markdown">
<h3>Creating Custom Train Generator. This will read the files in batches
of 10 while training the model</h3>
</section>
<div class="cell code" data-execution_count="276"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:47:41.171107Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:47:41.170696Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:47:41.189237Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:47:41.187909Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:47:41.171074Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb191"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>BATCH_SIZE <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a><span class="co">## Image Size to be scaled</span></span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>IMAGE_SIZE <span class="op">=</span> <span class="dv">224</span></span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a><span class="co">## Actual Image size </span></span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a>IMG_WIDTH <span class="op">=</span> <span class="dv">1024</span></span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a>IMG_HEIGHT <span class="op">=</span> <span class="dv">1024</span></span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-8"><a href="#cb191-8" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TrainGenerator(Sequence):</span>
<span id="cb191-9"><a href="#cb191-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>,  _labels):       </span>
<span id="cb191-10"><a href="#cb191-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.pids <span class="op">=</span> _labels[<span class="st">&quot;patientId&quot;</span>].to_numpy()</span>
<span id="cb191-11"><a href="#cb191-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.coords <span class="op">=</span> _labels[[<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;width&quot;</span>, <span class="st">&quot;height&quot;</span>]].to_numpy()</span>
<span id="cb191-12"><a href="#cb191-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.coords <span class="op">=</span> <span class="va">self</span>.coords <span class="op">*</span> IMAGE_SIZE <span class="op">/</span> IMG_WIDTH      </span>
<span id="cb191-13"><a href="#cb191-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__len__</span>(<span class="va">self</span>):</span>
<span id="cb191-14"><a href="#cb191-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> math.ceil(<span class="bu">len</span>(<span class="va">self</span>.coords) <span class="op">/</span> BATCH_SIZE)</span>
<span id="cb191-15"><a href="#cb191-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> __doHistogramEqualization(<span class="va">self</span>,img):</span>
<span id="cb191-16"><a href="#cb191-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Pre processing Histogram equalization</span></span>
<span id="cb191-17"><a href="#cb191-17" aria-hidden="true" tabindex="-1"></a>        histogram_array <span class="op">=</span> np.bincount(img.flatten(), minlength<span class="op">=</span><span class="dv">256</span>)</span>
<span id="cb191-18"><a href="#cb191-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">#normalize</span></span>
<span id="cb191-19"><a href="#cb191-19" aria-hidden="true" tabindex="-1"></a>        num_pixels <span class="op">=</span> np.<span class="bu">sum</span>(histogram_array)</span>
<span id="cb191-20"><a href="#cb191-20" aria-hidden="true" tabindex="-1"></a>        histogram_array <span class="op">=</span> histogram_array<span class="op">/</span>num_pixels</span>
<span id="cb191-21"><a href="#cb191-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">#normalized cumulative histogram</span></span>
<span id="cb191-22"><a href="#cb191-22" aria-hidden="true" tabindex="-1"></a>        chistogram_array <span class="op">=</span> np.cumsum(histogram_array)</span>
<span id="cb191-23"><a href="#cb191-23" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb191-24"><a href="#cb191-24" aria-hidden="true" tabindex="-1"></a><span class="co">        STEP 2: Pixel mapping lookup table</span></span>
<span id="cb191-25"><a href="#cb191-25" aria-hidden="true" tabindex="-1"></a><span class="co">        &quot;&quot;&quot;</span></span>
<span id="cb191-26"><a href="#cb191-26" aria-hidden="true" tabindex="-1"></a>        transform_map <span class="op">=</span> np.floor(<span class="dv">255</span> <span class="op">*</span> chistogram_array).astype(np.uint8)</span>
<span id="cb191-27"><a href="#cb191-27" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb191-28"><a href="#cb191-28" aria-hidden="true" tabindex="-1"></a><span class="co">        STEP 3: Transformation</span></span>
<span id="cb191-29"><a href="#cb191-29" aria-hidden="true" tabindex="-1"></a><span class="co">        &quot;&quot;&quot;</span></span>
<span id="cb191-30"><a href="#cb191-30" aria-hidden="true" tabindex="-1"></a>        img_list <span class="op">=</span> <span class="bu">list</span>(img.flatten())</span>
<span id="cb191-31"><a href="#cb191-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># transform pixel values to equalize</span></span>
<span id="cb191-32"><a href="#cb191-32" aria-hidden="true" tabindex="-1"></a>        eq_img_list <span class="op">=</span> [transform_map[p] <span class="cf">for</span> p <span class="kw">in</span> img_list]</span>
<span id="cb191-33"><a href="#cb191-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># reshape and write back into img_array</span></span>
<span id="cb191-34"><a href="#cb191-34" aria-hidden="true" tabindex="-1"></a>        img <span class="op">=</span> np.reshape(np.asarray(eq_img_list), img.shape)</span>
<span id="cb191-35"><a href="#cb191-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> img</span>
<span id="cb191-36"><a href="#cb191-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__getitem__</span>(<span class="va">self</span>, idx): <span class="co"># Get a batch</span></span>
<span id="cb191-37"><a href="#cb191-37" aria-hidden="true" tabindex="-1"></a>        batch_coords <span class="op">=</span> <span class="va">self</span>.coords[idx <span class="op">*</span> BATCH_SIZE:(idx <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> BATCH_SIZE] <span class="co"># Image coords</span></span>
<span id="cb191-38"><a href="#cb191-38" aria-hidden="true" tabindex="-1"></a>        batch_pids <span class="op">=</span> <span class="va">self</span>.pids[idx <span class="op">*</span> BATCH_SIZE:(idx <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> BATCH_SIZE] <span class="co"># Image pids    </span></span>
<span id="cb191-39"><a href="#cb191-39" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb191-40"><a href="#cb191-40" aria-hidden="true" tabindex="-1"></a>        batch_images <span class="op">=</span> np.zeros((<span class="bu">len</span>(batch_pids), IMAGE_SIZE, IMAGE_SIZE, <span class="dv">3</span>), dtype<span class="op">=</span>np.float32)</span>
<span id="cb191-41"><a href="#cb191-41" aria-hidden="true" tabindex="-1"></a>        batch_masks <span class="op">=</span> np.zeros((<span class="bu">len</span>(batch_pids), IMAGE_SIZE, IMAGE_SIZE))</span>
<span id="cb191-42"><a href="#cb191-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _indx, _pid <span class="kw">in</span> <span class="bu">enumerate</span>(batch_pids):</span>
<span id="cb191-43"><a href="#cb191-43" aria-hidden="true" tabindex="-1"></a>            _path <span class="op">=</span>  <span class="st">&#39;/kaggle/input/pneumonia-detection/stage_2_train_images/stage_2_train_images/&#39;</span><span class="op">+</span><span class="st">&#39;</span><span class="sc">{}</span><span class="st">.dcm&#39;</span>.<span class="bu">format</span>(_pid)</span>
<span id="cb191-44"><a href="#cb191-44" aria-hidden="true" tabindex="-1"></a>            _imgData <span class="op">=</span> pydicom.dcmread(_path)</span>
<span id="cb191-45"><a href="#cb191-45" aria-hidden="true" tabindex="-1"></a>            img <span class="op">=</span> _imgData.pixel_array </span>
<span id="cb191-46"><a href="#cb191-46" aria-hidden="true" tabindex="-1"></a>            <span class="co"># img = np.stack((img,)*3, axis=-1) # Expand grayscale image to contain 3 channels</span></span>
<span id="cb191-47"><a href="#cb191-47" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Resize image</span></span>
<span id="cb191-48"><a href="#cb191-48" aria-hidden="true" tabindex="-1"></a>            resized_img <span class="op">=</span> cv2.resize(img,(IMAGE_SIZE,IMAGE_SIZE), interpolation <span class="op">=</span> cv2.INTER_AREA)            </span>
<span id="cb191-49"><a href="#cb191-49" aria-hidden="true" tabindex="-1"></a>            resized_img <span class="op">=</span> <span class="va">self</span>.__doHistogramEqualization(resized_img)        </span>
<span id="cb191-50"><a href="#cb191-50" aria-hidden="true" tabindex="-1"></a>            batch_images[_indx][:,:,<span class="dv">0</span>] <span class="op">=</span> preprocess_input(np.array(resized_img[:,:], dtype<span class="op">=</span>np.float32)) </span>
<span id="cb191-51"><a href="#cb191-51" aria-hidden="true" tabindex="-1"></a>            batch_images[_indx][:,:,<span class="dv">1</span>] <span class="op">=</span> preprocess_input(np.array(resized_img[:,:], dtype<span class="op">=</span>np.float32)) </span>
<span id="cb191-52"><a href="#cb191-52" aria-hidden="true" tabindex="-1"></a>            batch_images[_indx][:,:,<span class="dv">2</span>] <span class="op">=</span> preprocess_input(np.array(resized_img[:,:], dtype<span class="op">=</span>np.float32)) </span>
<span id="cb191-53"><a href="#cb191-53" aria-hidden="true" tabindex="-1"></a>            x <span class="op">=</span> <span class="bu">int</span>(batch_coords[_indx, <span class="dv">0</span>])</span>
<span id="cb191-54"><a href="#cb191-54" aria-hidden="true" tabindex="-1"></a>            y <span class="op">=</span> <span class="bu">int</span>(batch_coords[_indx, <span class="dv">1</span>])</span>
<span id="cb191-55"><a href="#cb191-55" aria-hidden="true" tabindex="-1"></a>            width <span class="op">=</span> <span class="bu">int</span>(batch_coords[_indx, <span class="dv">2</span>])</span>
<span id="cb191-56"><a href="#cb191-56" aria-hidden="true" tabindex="-1"></a>            height <span class="op">=</span> <span class="bu">int</span>(batch_coords[_indx, <span class="dv">3</span>])</span>
<span id="cb191-57"><a href="#cb191-57" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb191-58"><a href="#cb191-58" aria-hidden="true" tabindex="-1"></a>            batch_masks[_indx][y:y<span class="op">+</span>height, x:x<span class="op">+</span>width] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb191-59"><a href="#cb191-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-60"><a href="#cb191-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> batch_images, batch_masks</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="277"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:47:42.400418Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:47:42.399997Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:47:42.409099Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:47:42.407990Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:47:42.400365Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb192"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a TrainGenerator instance for training data</span></span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;train_CombinedData&#39; is a DataFrame containing information about the first 5000 data points for training</span></span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;TrainGenerator&#39; class generates batches of preprocessed images and corresponding masks for training</span></span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;trainUNetDataGen&#39; will be used as the data generator for training the U-Net model</span></span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a>trainUNetDataGen <span class="op">=</span> TrainGenerator(train_CombinedData)</span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a TrainGenerator instance for validation data</span></span>
<span id="cb192-8"><a href="#cb192-8" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;validate_CombinedData&#39; is a DataFrame containing information about the next 5000 data points for validation</span></span>
<span id="cb192-9"><a href="#cb192-9" aria-hidden="true" tabindex="-1"></a><span class="co"># The &#39;TrainGenerator&#39; class generates batches of preprocessed images and corresponding masks for validation</span></span>
<span id="cb192-10"><a href="#cb192-10" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;validateUNetDataGen&#39; will be used as the data generator for validating the U-Net model during training</span></span>
<span id="cb192-11"><a href="#cb192-11" aria-hidden="true" tabindex="-1"></a>validateUNetDataGen <span class="op">=</span> TrainGenerator(validate_CombinedData)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="278"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:47:45.280902Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:47:45.280507Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:47:45.288030Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:47:45.286880Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:47:45.280868Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb193"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To show image with mask</span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> showMaskedImage(_imageSet, _maskSet, _index) :</span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>    maskImage <span class="op">=</span> _imageSet[_index]</span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a>    maskImage[:,:,<span class="dv">0</span>] <span class="op">=</span> _maskSet[_index] <span class="op">*</span> _imageSet[_index][:,:,<span class="dv">0</span>]</span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a>    maskImage[:,:,<span class="dv">1</span>] <span class="op">=</span> _maskSet[_index] <span class="op">*</span> _imageSet[_index][:,:,<span class="dv">1</span>]</span>
<span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a>    maskImage[:,:,<span class="dv">2</span>] <span class="op">=</span> _maskSet[_index] <span class="op">*</span> _imageSet[_index][:,:,<span class="dv">2</span>]</span>
<span id="cb193-8"><a href="#cb193-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-9"><a href="#cb193-9" aria-hidden="true" tabindex="-1"></a>    plt.imshow(maskImage[:,:,<span class="dv">0</span>])</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="279"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:47:46.358141Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:47:46.357767Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:47:47.050856Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:47:47.049841Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:47:46.358109Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb194"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="co">## One of the pre processed image from custom train generator</span></span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>imageSet0 <span class="op">=</span> trainUNetDataGen[<span class="dv">1</span>][<span class="dv">0</span>][<span class="dv">1</span>]</span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a>plt.imshow(imageSet0)</span></code></pre></div>
<div class="output execute_result" data-execution_count="279">
<pre><code>&lt;matplotlib.image.AxesImage at 0x7b58b284d750&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/cbc7562398a843105ffe768139451a9497c1a6e7.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="120"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T09:46:05.702483Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T09:46:05.701480Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T09:46:06.822908Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T09:46:06.821973Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T09:46:05.702434Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb196"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Masks for the same</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>imageSet0 <span class="op">=</span> trainUNetDataGen[<span class="dv">2</span>][<span class="dv">0</span>]</span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>maskSet0 <span class="op">=</span> trainUNetDataGen[<span class="dv">2</span>][<span class="dv">1</span>]    </span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a>showMaskedImage(imageSet0, maskSet0, <span class="dv">5</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/916d71dee73b811ebf3a4db9b5a4c52fa0575dde.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="280"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:47:55.792303Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:47:55.791900Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:47:55.803017Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:47:55.801607Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:47:55.792268Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb197"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>ALPHA <span class="op">=</span> <span class="fl">1.0</span></span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_UNetModelUsingMobileNet(trainable<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Function to create UNet architecture with MobileNet.</span></span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Arguments:</span></span>
<span id="cb197-6"><a href="#cb197-6" aria-hidden="true" tabindex="-1"></a><span class="co">        trainable -- Flag to make layers trainable. Default value is &#39;True&#39;.</span></span>
<span id="cb197-7"><a href="#cb197-7" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb197-8"><a href="#cb197-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get all layers with &#39;imagenet&#39; weights</span></span>
<span id="cb197-9"><a href="#cb197-9" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> MobileNet(input_shape<span class="op">=</span>(IMAGE_SIZE, IMAGE_SIZE, <span class="dv">3</span>), include_top<span class="op">=</span><span class="va">False</span>, alpha<span class="op">=</span>ALPHA, weights<span class="op">=</span><span class="st">&quot;imagenet&quot;</span>) </span>
<span id="cb197-10"><a href="#cb197-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Top layer is last layer of the model</span></span>
<span id="cb197-11"><a href="#cb197-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb197-12"><a href="#cb197-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make all layers trainable</span></span>
<span id="cb197-13"><a href="#cb197-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> layer <span class="kw">in</span> model.layers:</span>
<span id="cb197-14"><a href="#cb197-14" aria-hidden="true" tabindex="-1"></a>        layer.trainable <span class="op">=</span> trainable</span>
<span id="cb197-15"><a href="#cb197-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-16"><a href="#cb197-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add all the UNET layers here</span></span>
<span id="cb197-17"><a href="#cb197-17" aria-hidden="true" tabindex="-1"></a>    convLayer_112by112 <span class="op">=</span> model.get_layer(<span class="st">&quot;conv_pw_1_relu&quot;</span>).output</span>
<span id="cb197-18"><a href="#cb197-18" aria-hidden="true" tabindex="-1"></a>    convLayer_56by56 <span class="op">=</span> model.get_layer(<span class="st">&quot;conv_pw_3_relu&quot;</span>).output</span>
<span id="cb197-19"><a href="#cb197-19" aria-hidden="true" tabindex="-1"></a>    convLayer_28by28 <span class="op">=</span> model.get_layer(<span class="st">&quot;conv_pw_5_relu&quot;</span>).output</span>
<span id="cb197-20"><a href="#cb197-20" aria-hidden="true" tabindex="-1"></a>    convLayer_14by14 <span class="op">=</span> model.get_layer(<span class="st">&quot;conv_pw_11_relu&quot;</span>).output</span>
<span id="cb197-21"><a href="#cb197-21" aria-hidden="true" tabindex="-1"></a>    convLayer_7by7 <span class="op">=</span> model.get_layer(<span class="st">&quot;conv_pw_13_relu&quot;</span>).output</span>
<span id="cb197-22"><a href="#cb197-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The last layer of mobilenet model is of dimensions (7x7x1024)</span></span>
<span id="cb197-23"><a href="#cb197-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-24"><a href="#cb197-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Start upsampling from 7x7 to 14x14 ...up to 224x224 to form UNET</span></span>
<span id="cb197-25"><a href="#cb197-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># concatinate with the original image layer of the same size from MobileNet</span></span>
<span id="cb197-26"><a href="#cb197-26" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> Concatenate()([UpSampling2D()(convLayer_7by7), convLayer_14by14])</span>
<span id="cb197-27"><a href="#cb197-27" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> Concatenate()([UpSampling2D()(x), convLayer_28by28])</span>
<span id="cb197-28"><a href="#cb197-28" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> Concatenate()([UpSampling2D()(x), convLayer_56by56])</span>
<span id="cb197-29"><a href="#cb197-29" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> Concatenate()([UpSampling2D()(x), convLayer_112by112])</span>
<span id="cb197-30"><a href="#cb197-30" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> UpSampling2D(name<span class="op">=</span><span class="st">&quot;unet_last&quot;</span>)(x) <span class="co"># upsample to 224x224</span></span>
<span id="cb197-31"><a href="#cb197-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-32"><a href="#cb197-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add classification layer</span></span>
<span id="cb197-33"><a href="#cb197-33" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> Conv2D(<span class="dv">1</span>, kernel_size<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">&quot;sigmoid&quot;</span>, name<span class="op">=</span><span class="st">&quot;masks&quot;</span>)(x)</span>
<span id="cb197-34"><a href="#cb197-34" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> Reshape((IMAGE_SIZE, IMAGE_SIZE))(x) </span>
<span id="cb197-35"><a href="#cb197-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-36"><a href="#cb197-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Model(inputs<span class="op">=</span>model.<span class="bu">input</span>, outputs<span class="op">=</span>x)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="281"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:47:58.017342Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:47:58.016931Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:47:59.056790Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:47:59.055909Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:47:58.017306Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb198"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Build a model </span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>input_shape <span class="op">=</span> (IMAGE_SIZE,IMAGE_SIZE,<span class="dv">3</span>)</span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>model_Unet <span class="op">=</span> create_UNetModelUsingMobileNet(input_shape)</span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a>model_Unet.summary()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Model: &quot;model_1&quot;
__________________________________________________________________________________________________
 Layer (type)                   Output Shape         Param #     Connected to                     
==================================================================================================
 input_4 (InputLayer)           [(None, 224, 224, 3  0           []                               
                                )]                                                                
                                                                                                  
 conv1 (Conv2D)                 (None, 112, 112, 32  864         [&#39;input_4[0][0]&#39;]                
                                )                                                                 
                                                                                                  
 conv1_bn (BatchNormalization)  (None, 112, 112, 32  128         [&#39;conv1[0][0]&#39;]                  
                                )                                                                 
                                                                                                  
 conv1_relu (ReLU)              (None, 112, 112, 32  0           [&#39;conv1_bn[0][0]&#39;]               
                                )                                                                 
                                                                                                  
 conv_dw_1 (DepthwiseConv2D)    (None, 112, 112, 32  288         [&#39;conv1_relu[0][0]&#39;]             
                                )                                                                 
                                                                                                  
 conv_dw_1_bn (BatchNormalizati  (None, 112, 112, 32  128        [&#39;conv_dw_1[0][0]&#39;]              
 on)                            )                                                                 
                                                                                                  
 conv_dw_1_relu (ReLU)          (None, 112, 112, 32  0           [&#39;conv_dw_1_bn[0][0]&#39;]           
                                )                                                                 
                                                                                                  
 conv_pw_1 (Conv2D)             (None, 112, 112, 64  2048        [&#39;conv_dw_1_relu[0][0]&#39;]         
                                )                                                                 
                                                                                                  
 conv_pw_1_bn (BatchNormalizati  (None, 112, 112, 64  256        [&#39;conv_pw_1[0][0]&#39;]              
 on)                            )                                                                 
                                                                                                  
 conv_pw_1_relu (ReLU)          (None, 112, 112, 64  0           [&#39;conv_pw_1_bn[0][0]&#39;]           
                                )                                                                 
                                                                                                  
 conv_pad_2 (ZeroPadding2D)     (None, 113, 113, 64  0           [&#39;conv_pw_1_relu[0][0]&#39;]         
                                )                                                                 
                                                                                                  
 conv_dw_2 (DepthwiseConv2D)    (None, 56, 56, 64)   576         [&#39;conv_pad_2[0][0]&#39;]             
                                                                                                  
 conv_dw_2_bn (BatchNormalizati  (None, 56, 56, 64)  256         [&#39;conv_dw_2[0][0]&#39;]              
 on)                                                                                              
                                                                                                  
 conv_dw_2_relu (ReLU)          (None, 56, 56, 64)   0           [&#39;conv_dw_2_bn[0][0]&#39;]           
                                                                                                  
 conv_pw_2 (Conv2D)             (None, 56, 56, 128)  8192        [&#39;conv_dw_2_relu[0][0]&#39;]         
                                                                                                  
 conv_pw_2_bn (BatchNormalizati  (None, 56, 56, 128)  512        [&#39;conv_pw_2[0][0]&#39;]              
 on)                                                                                              
                                                                                                  
 conv_pw_2_relu (ReLU)          (None, 56, 56, 128)  0           [&#39;conv_pw_2_bn[0][0]&#39;]           
                                                                                                  
 conv_dw_3 (DepthwiseConv2D)    (None, 56, 56, 128)  1152        [&#39;conv_pw_2_relu[0][0]&#39;]         
                                                                                                  
 conv_dw_3_bn (BatchNormalizati  (None, 56, 56, 128)  512        [&#39;conv_dw_3[0][0]&#39;]              
 on)                                                                                              
                                                                                                  
 conv_dw_3_relu (ReLU)          (None, 56, 56, 128)  0           [&#39;conv_dw_3_bn[0][0]&#39;]           
                                                                                                  
 conv_pw_3 (Conv2D)             (None, 56, 56, 128)  16384       [&#39;conv_dw_3_relu[0][0]&#39;]         
                                                                                                  
 conv_pw_3_bn (BatchNormalizati  (None, 56, 56, 128)  512        [&#39;conv_pw_3[0][0]&#39;]              
 on)                                                                                              
                                                                                                  
 conv_pw_3_relu (ReLU)          (None, 56, 56, 128)  0           [&#39;conv_pw_3_bn[0][0]&#39;]           
                                                                                                  
 conv_pad_4 (ZeroPadding2D)     (None, 57, 57, 128)  0           [&#39;conv_pw_3_relu[0][0]&#39;]         
                                                                                                  
 conv_dw_4 (DepthwiseConv2D)    (None, 28, 28, 128)  1152        [&#39;conv_pad_4[0][0]&#39;]             
                                                                                                  
 conv_dw_4_bn (BatchNormalizati  (None, 28, 28, 128)  512        [&#39;conv_dw_4[0][0]&#39;]              
 on)                                                                                              
                                                                                                  
 conv_dw_4_relu (ReLU)          (None, 28, 28, 128)  0           [&#39;conv_dw_4_bn[0][0]&#39;]           
                                                                                                  
 conv_pw_4 (Conv2D)             (None, 28, 28, 256)  32768       [&#39;conv_dw_4_relu[0][0]&#39;]         
                                                                                                  
 conv_pw_4_bn (BatchNormalizati  (None, 28, 28, 256)  1024       [&#39;conv_pw_4[0][0]&#39;]              
 on)                                                                                              
                                                                                                  
 conv_pw_4_relu (ReLU)          (None, 28, 28, 256)  0           [&#39;conv_pw_4_bn[0][0]&#39;]           
                                                                                                  
 conv_dw_5 (DepthwiseConv2D)    (None, 28, 28, 256)  2304        [&#39;conv_pw_4_relu[0][0]&#39;]         
                                                                                                  
 conv_dw_5_bn (BatchNormalizati  (None, 28, 28, 256)  1024       [&#39;conv_dw_5[0][0]&#39;]              
 on)                                                                                              
                                                                                                  
 conv_dw_5_relu (ReLU)          (None, 28, 28, 256)  0           [&#39;conv_dw_5_bn[0][0]&#39;]           
                                                                                                  
 conv_pw_5 (Conv2D)             (None, 28, 28, 256)  65536       [&#39;conv_dw_5_relu[0][0]&#39;]         
                                                                                                  
 conv_pw_5_bn (BatchNormalizati  (None, 28, 28, 256)  1024       [&#39;conv_pw_5[0][0]&#39;]              
 on)                                                                                              
                                                                                                  
 conv_pw_5_relu (ReLU)          (None, 28, 28, 256)  0           [&#39;conv_pw_5_bn[0][0]&#39;]           
                                                                                                  
 conv_pad_6 (ZeroPadding2D)     (None, 29, 29, 256)  0           [&#39;conv_pw_5_relu[0][0]&#39;]         
                                                                                                  
 conv_dw_6 (DepthwiseConv2D)    (None, 14, 14, 256)  2304        [&#39;conv_pad_6[0][0]&#39;]             
                                                                                                  
 conv_dw_6_bn (BatchNormalizati  (None, 14, 14, 256)  1024       [&#39;conv_dw_6[0][0]&#39;]              
 on)                                                                                              
                                                                                                  
 conv_dw_6_relu (ReLU)          (None, 14, 14, 256)  0           [&#39;conv_dw_6_bn[0][0]&#39;]           
                                                                                                  
 conv_pw_6 (Conv2D)             (None, 14, 14, 512)  131072      [&#39;conv_dw_6_relu[0][0]&#39;]         
                                                                                                  
 conv_pw_6_bn (BatchNormalizati  (None, 14, 14, 512)  2048       [&#39;conv_pw_6[0][0]&#39;]              
 on)                                                                                              
                                                                                                  
 conv_pw_6_relu (ReLU)          (None, 14, 14, 512)  0           [&#39;conv_pw_6_bn[0][0]&#39;]           
                                                                                                  
 conv_dw_7 (DepthwiseConv2D)    (None, 14, 14, 512)  4608        [&#39;conv_pw_6_relu[0][0]&#39;]         
                                                                                                  
 conv_dw_7_bn (BatchNormalizati  (None, 14, 14, 512)  2048       [&#39;conv_dw_7[0][0]&#39;]              
 on)                                                                                              
                                                                                                  
 conv_dw_7_relu (ReLU)          (None, 14, 14, 512)  0           [&#39;conv_dw_7_bn[0][0]&#39;]           
                                                                                                  
 conv_pw_7 (Conv2D)             (None, 14, 14, 512)  262144      [&#39;conv_dw_7_relu[0][0]&#39;]         
                                                                                                  
 conv_pw_7_bn (BatchNormalizati  (None, 14, 14, 512)  2048       [&#39;conv_pw_7[0][0]&#39;]              
 on)                                                                                              
                                                                                                  
 conv_pw_7_relu (ReLU)          (None, 14, 14, 512)  0           [&#39;conv_pw_7_bn[0][0]&#39;]           
                                                                                                  
 conv_dw_8 (DepthwiseConv2D)    (None, 14, 14, 512)  4608        [&#39;conv_pw_7_relu[0][0]&#39;]         
                                                                                                  
 conv_dw_8_bn (BatchNormalizati  (None, 14, 14, 512)  2048       [&#39;conv_dw_8[0][0]&#39;]              
 on)                                                                                              
                                                                                                  
 conv_dw_8_relu (ReLU)          (None, 14, 14, 512)  0           [&#39;conv_dw_8_bn[0][0]&#39;]           
                                                                                                  
 conv_pw_8 (Conv2D)             (None, 14, 14, 512)  262144      [&#39;conv_dw_8_relu[0][0]&#39;]         
                                                                                                  
 conv_pw_8_bn (BatchNormalizati  (None, 14, 14, 512)  2048       [&#39;conv_pw_8[0][0]&#39;]              
 on)                                                                                              
                                                                                                  
 conv_pw_8_relu (ReLU)          (None, 14, 14, 512)  0           [&#39;conv_pw_8_bn[0][0]&#39;]           
                                                                                                  
 conv_dw_9 (DepthwiseConv2D)    (None, 14, 14, 512)  4608        [&#39;conv_pw_8_relu[0][0]&#39;]         
                                                                                                  
 conv_dw_9_bn (BatchNormalizati  (None, 14, 14, 512)  2048       [&#39;conv_dw_9[0][0]&#39;]              
 on)                                                                                              
                                                                                                  
 conv_dw_9_relu (ReLU)          (None, 14, 14, 512)  0           [&#39;conv_dw_9_bn[0][0]&#39;]           
                                                                                                  
 conv_pw_9 (Conv2D)             (None, 14, 14, 512)  262144      [&#39;conv_dw_9_relu[0][0]&#39;]         
                                                                                                  
 conv_pw_9_bn (BatchNormalizati  (None, 14, 14, 512)  2048       [&#39;conv_pw_9[0][0]&#39;]              
 on)                                                                                              
                                                                                                  
 conv_pw_9_relu (ReLU)          (None, 14, 14, 512)  0           [&#39;conv_pw_9_bn[0][0]&#39;]           
                                                                                                  
 conv_dw_10 (DepthwiseConv2D)   (None, 14, 14, 512)  4608        [&#39;conv_pw_9_relu[0][0]&#39;]         
                                                                                                  
 conv_dw_10_bn (BatchNormalizat  (None, 14, 14, 512)  2048       [&#39;conv_dw_10[0][0]&#39;]             
 ion)                                                                                             
                                                                                                  
 conv_dw_10_relu (ReLU)         (None, 14, 14, 512)  0           [&#39;conv_dw_10_bn[0][0]&#39;]          
                                                                                                  
 conv_pw_10 (Conv2D)            (None, 14, 14, 512)  262144      [&#39;conv_dw_10_relu[0][0]&#39;]        
                                                                                                  
 conv_pw_10_bn (BatchNormalizat  (None, 14, 14, 512)  2048       [&#39;conv_pw_10[0][0]&#39;]             
 ion)                                                                                             
                                                                                                  
 conv_pw_10_relu (ReLU)         (None, 14, 14, 512)  0           [&#39;conv_pw_10_bn[0][0]&#39;]          
                                                                                                  
 conv_dw_11 (DepthwiseConv2D)   (None, 14, 14, 512)  4608        [&#39;conv_pw_10_relu[0][0]&#39;]        
                                                                                                  
 conv_dw_11_bn (BatchNormalizat  (None, 14, 14, 512)  2048       [&#39;conv_dw_11[0][0]&#39;]             
 ion)                                                                                             
                                                                                                  
 conv_dw_11_relu (ReLU)         (None, 14, 14, 512)  0           [&#39;conv_dw_11_bn[0][0]&#39;]          
                                                                                                  
 conv_pw_11 (Conv2D)            (None, 14, 14, 512)  262144      [&#39;conv_dw_11_relu[0][0]&#39;]        
                                                                                                  
 conv_pw_11_bn (BatchNormalizat  (None, 14, 14, 512)  2048       [&#39;conv_pw_11[0][0]&#39;]             
 ion)                                                                                             
                                                                                                  
 conv_pw_11_relu (ReLU)         (None, 14, 14, 512)  0           [&#39;conv_pw_11_bn[0][0]&#39;]          
                                                                                                  
 conv_pad_12 (ZeroPadding2D)    (None, 15, 15, 512)  0           [&#39;conv_pw_11_relu[0][0]&#39;]        
                                                                                                  
 conv_dw_12 (DepthwiseConv2D)   (None, 7, 7, 512)    4608        [&#39;conv_pad_12[0][0]&#39;]            
                                                                                                  
 conv_dw_12_bn (BatchNormalizat  (None, 7, 7, 512)   2048        [&#39;conv_dw_12[0][0]&#39;]             
 ion)                                                                                             
                                                                                                  
 conv_dw_12_relu (ReLU)         (None, 7, 7, 512)    0           [&#39;conv_dw_12_bn[0][0]&#39;]          
                                                                                                  
 conv_pw_12 (Conv2D)            (None, 7, 7, 1024)   524288      [&#39;conv_dw_12_relu[0][0]&#39;]        
                                                                                                  
 conv_pw_12_bn (BatchNormalizat  (None, 7, 7, 1024)  4096        [&#39;conv_pw_12[0][0]&#39;]             
 ion)                                                                                             
                                                                                                  
 conv_pw_12_relu (ReLU)         (None, 7, 7, 1024)   0           [&#39;conv_pw_12_bn[0][0]&#39;]          
                                                                                                  
 conv_dw_13 (DepthwiseConv2D)   (None, 7, 7, 1024)   9216        [&#39;conv_pw_12_relu[0][0]&#39;]        
                                                                                                  
 conv_dw_13_bn (BatchNormalizat  (None, 7, 7, 1024)  4096        [&#39;conv_dw_13[0][0]&#39;]             
 ion)                                                                                             
                                                                                                  
 conv_dw_13_relu (ReLU)         (None, 7, 7, 1024)   0           [&#39;conv_dw_13_bn[0][0]&#39;]          
                                                                                                  
 conv_pw_13 (Conv2D)            (None, 7, 7, 1024)   1048576     [&#39;conv_dw_13_relu[0][0]&#39;]        
                                                                                                  
 conv_pw_13_bn (BatchNormalizat  (None, 7, 7, 1024)  4096        [&#39;conv_pw_13[0][0]&#39;]             
 ion)                                                                                             
                                                                                                  
 conv_pw_13_relu (ReLU)         (None, 7, 7, 1024)   0           [&#39;conv_pw_13_bn[0][0]&#39;]          
                                                                                                  
 up_sampling2d_4 (UpSampling2D)  (None, 14, 14, 1024  0          [&#39;conv_pw_13_relu[0][0]&#39;]        
                                )                                                                 
                                                                                                  
 concatenate_4 (Concatenate)    (None, 14, 14, 1536  0           [&#39;up_sampling2d_4[0][0]&#39;,        
                                )                                 &#39;conv_pw_11_relu[0][0]&#39;]        
                                                                                                  
 up_sampling2d_5 (UpSampling2D)  (None, 28, 28, 1536  0          [&#39;concatenate_4[0][0]&#39;]          
                                )                                                                 
                                                                                                  
 concatenate_5 (Concatenate)    (None, 28, 28, 1792  0           [&#39;up_sampling2d_5[0][0]&#39;,        
                                )                                 &#39;conv_pw_5_relu[0][0]&#39;]         
                                                                                                  
 up_sampling2d_6 (UpSampling2D)  (None, 56, 56, 1792  0          [&#39;concatenate_5[0][0]&#39;]          
                                )                                                                 
                                                                                                  
 concatenate_6 (Concatenate)    (None, 56, 56, 1920  0           [&#39;up_sampling2d_6[0][0]&#39;,        
                                )                                 &#39;conv_pw_3_relu[0][0]&#39;]         
                                                                                                  
 up_sampling2d_7 (UpSampling2D)  (None, 112, 112, 19  0          [&#39;concatenate_6[0][0]&#39;]          
                                20)                                                               
                                                                                                  
 concatenate_7 (Concatenate)    (None, 112, 112, 19  0           [&#39;up_sampling2d_7[0][0]&#39;,        
                                84)                               &#39;conv_pw_1_relu[0][0]&#39;]         
                                                                                                  
 unet_last (UpSampling2D)       (None, 224, 224, 19  0           [&#39;concatenate_7[0][0]&#39;]          
                                84)                                                               
                                                                                                  
 masks (Conv2D)                 (None, 224, 224, 1)  1985        [&#39;unet_last[0][0]&#39;]              
                                                                                                  
 reshape_1 (Reshape)            (None, 224, 224)     0           [&#39;masks[0][0]&#39;]                  
                                                                                                  
==================================================================================================
Total params: 3,230,849
Trainable params: 3,208,961
Non-trainable params: 21,888
__________________________________________________________________________________________________
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="283"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:48:33.438466Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:48:33.437165Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:48:33.446803Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:48:33.445463Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:48:33.438421Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb200"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="co">#dice_coef 2 * the Area of Overlap divided by the total number of pixels in both images</span></span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dice_coef(y_true, y_pred):</span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a>    y_true <span class="op">=</span> tf.keras.layers.Flatten()(y_true)</span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> tf.keras.layers.Flatten()(y_pred)</span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a>    intersection <span class="op">=</span> tf.reduce_sum(y_true <span class="op">*</span> y_pred)</span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (<span class="fl">2.</span> <span class="op">*</span> intersection <span class="op">+</span> tf.keras.backend.epsilon()) <span class="op">/</span> (tf.reduce_sum(y_true) <span class="op">+</span> tf.reduce_sum(y_pred) <span class="op">+</span> tf.keras.backend.epsilon())</span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-8"><a href="#cb200-8" aria-hidden="true" tabindex="-1"></a><span class="co">## Loss is 1 - the coefficent of two images</span></span>
<span id="cb200-9"><a href="#cb200-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dice_loss(y_true, y_pred):</span>
<span id="cb200-10"><a href="#cb200-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fl">1.0</span> <span class="op">-</span> dice_coef(y_true, y_pred)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="285"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:48:47.454444Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:48:47.454038Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:48:47.460609Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:48:47.459573Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:48:47.454401Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb201"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Call Backs for ealy stopping and reduce learning rate </span></span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a><span class="co">## Reduce the learning rate when teh validation loss is same for 4 epocs</span></span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a>callbacks <span class="op">=</span> [</span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a>    ReduceLROnPlateau(monitor<span class="op">=</span><span class="st">&#39;val_loss&#39;</span>, factor<span class="op">=</span><span class="fl">0.1</span>, patience<span class="op">=</span><span class="dv">4</span>),</span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a>    EarlyStopping(monitor<span class="op">=</span><span class="st">&#39;val_loss&#39;</span>, patience<span class="op">=</span><span class="dv">10</span>, restore_best_weights<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb201-6"><a href="#cb201-6" aria-hidden="true" tabindex="-1"></a>]</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="286"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:48:53.959010Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:48:53.958640Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:48:53.981522Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:48:53.980452Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:48:53.958978Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb202"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Optimiser , metrics and loss for the model</span></span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> tf.keras.optimizers.Nadam(<span class="fl">0.001</span>)</span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a>metrics <span class="op">=</span> [dice_coef, Recall(), Precision()]</span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a>model_Unet.<span class="bu">compile</span>(loss<span class="op">=</span>dice_loss, optimizer<span class="op">=</span>opt, metrics<span class="op">=</span>metrics)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="287"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T12:48:56.312755Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T12:48:56.312344Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T12:48:56.670306Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T12:48:56.669199Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T12:48:56.312720Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb203"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>input_shape <span class="op">=</span> trainUNetDataGen[<span class="dv">0</span>][<span class="dv">0</span>].shape[<span class="dv">1</span>:]</span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Input shape of trainUNetDataGen:&quot;</span>, input_shape)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Input shape of trainUNetDataGen: (224, 224, 3)
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="314"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T14:01:24.801976Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T14:01:24.801483Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T14:22:47.541535Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T14:22:47.540324Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T14:01:24.801938Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb205"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Running the model</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a>BATCH_SIZE <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a>train_steps <span class="op">=</span> <span class="bu">len</span>(trainUNetDataGen)<span class="op">//</span>BATCH_SIZE</span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a>valid_steps <span class="op">=</span> <span class="bu">len</span>(validateUNetDataGen)<span class="op">//</span>BATCH_SIZE</span>
<span id="cb205-6"><a href="#cb205-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-7"><a href="#cb205-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(trainUNetDataGen) <span class="op">%</span> BATCH_SIZE <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="cb205-8"><a href="#cb205-8" aria-hidden="true" tabindex="-1"></a>    train_steps <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb205-9"><a href="#cb205-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(validateUNetDataGen) <span class="op">%</span> BATCH_SIZE <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="cb205-10"><a href="#cb205-10" aria-hidden="true" tabindex="-1"></a>    valid_steps <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb205-11"><a href="#cb205-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-12"><a href="#cb205-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-13"><a href="#cb205-13" aria-hidden="true" tabindex="-1"></a>history_Unet <span class="op">=</span> model_Unet.fit(trainUNetDataGen,</span>
<span id="cb205-14"><a href="#cb205-14" aria-hidden="true" tabindex="-1"></a>                        epochs<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb205-15"><a href="#cb205-15" aria-hidden="true" tabindex="-1"></a>                        steps_per_epoch<span class="op">=</span>train_steps,</span>
<span id="cb205-16"><a href="#cb205-16" aria-hidden="true" tabindex="-1"></a>                        validation_data<span class="op">=</span>validateUNetDataGen,</span>
<span id="cb205-17"><a href="#cb205-17" aria-hidden="true" tabindex="-1"></a>                        callbacks<span class="op">=</span>callbacks,</span>
<span id="cb205-18"><a href="#cb205-18" aria-hidden="true" tabindex="-1"></a>                        use_multiprocessing<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb205-19"><a href="#cb205-19" aria-hidden="true" tabindex="-1"></a>                        workers<span class="op">=</span><span class="dv">4</span>,</span>
<span id="cb205-20"><a href="#cb205-20" aria-hidden="true" tabindex="-1"></a>                        validation_steps<span class="op">=</span>valid_steps,                      </span>
<span id="cb205-21"><a href="#cb205-21" aria-hidden="true" tabindex="-1"></a>                        shuffle<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Epoch 1/10
313/313 [==============================] - ETA: 0s - loss: 0.7848 - dice_coef: 0.2152 - recall_1: 0.4938 - precision_1: 0.1660Epoch 1 - Loss: 0.7848 - Accuracy: 0.2152 - Validation Loss: 0.8806 - Validation Accuracy: 0.1194
313/313 [==============================] - 144s 459ms/step - loss: 0.7848 - dice_coef: 0.2152 - recall_1: 0.4938 - precision_1: 0.1660 - val_loss: 0.8806 - val_dice_coef: 0.1194 - val_recall_1: 0.5525 - val_precision_1: 0.1454 - lr: 0.0010
Epoch 2/10
313/313 [==============================] - ETA: 0s - loss: 0.7804 - dice_coef: 0.2196 - recall_1: 0.4737 - precision_1: 0.1752Epoch 2 - Loss: 0.7804 - Accuracy: 0.2196 - Validation Loss: 0.8847 - Validation Accuracy: 0.1153
313/313 [==============================] - 143s 457ms/step - loss: 0.7804 - dice_coef: 0.2196 - recall_1: 0.4737 - precision_1: 0.1752 - val_loss: 0.8847 - val_dice_coef: 0.1153 - val_recall_1: 0.7456 - val_precision_1: 0.1043 - lr: 0.0010
Epoch 3/10
313/313 [==============================] - ETA: 0s - loss: 0.7745 - dice_coef: 0.2255 - recall_1: 0.4885 - precision_1: 0.1821Epoch 3 - Loss: 0.7745 - Accuracy: 0.2255 - Validation Loss: 0.8755 - Validation Accuracy: 0.1245
313/313 [==============================] - 109s 346ms/step - loss: 0.7745 - dice_coef: 0.2255 - recall_1: 0.4885 - precision_1: 0.1821 - val_loss: 0.8755 - val_dice_coef: 0.1245 - val_recall_1: 0.5753 - val_precision_1: 0.1364 - lr: 0.0010
Epoch 4/10
313/313 [==============================] - ETA: 0s - loss: 0.7737 - dice_coef: 0.2263 - recall_1: 0.4482 - precision_1: 0.1876Epoch 4 - Loss: 0.7737 - Accuracy: 0.2263 - Validation Loss: 0.8803 - Validation Accuracy: 0.1197
313/313 [==============================] - 106s 339ms/step - loss: 0.7737 - dice_coef: 0.2263 - recall_1: 0.4482 - precision_1: 0.1876 - val_loss: 0.8803 - val_dice_coef: 0.1197 - val_recall_1: 0.6900 - val_precision_1: 0.1116 - lr: 0.0010
Epoch 5/10
313/313 [==============================] - ETA: 0s - loss: 0.7662 - dice_coef: 0.2338 - recall_1: 0.4863 - precision_1: 0.1921Epoch 5 - Loss: 0.7662 - Accuracy: 0.2338 - Validation Loss: 0.8657 - Validation Accuracy: 0.1343
313/313 [==============================] - 107s 340ms/step - loss: 0.7662 - dice_coef: 0.2338 - recall_1: 0.4863 - precision_1: 0.1921 - val_loss: 0.8657 - val_dice_coef: 0.1343 - val_recall_1: 0.6029 - val_precision_1: 0.1388 - lr: 0.0010
Epoch 6/10
313/313 [==============================] - ETA: 0s - loss: 0.7510 - dice_coef: 0.2490 - recall_1: 0.4749 - precision_1: 0.2144Epoch 6 - Loss: 0.7510 - Accuracy: 0.2490 - Validation Loss: 0.8763 - Validation Accuracy: 0.1237
313/313 [==============================] - 106s 339ms/step - loss: 0.7510 - dice_coef: 0.2490 - recall_1: 0.4749 - precision_1: 0.2144 - val_loss: 0.8763 - val_dice_coef: 0.1237 - val_recall_1: 0.6340 - val_precision_1: 0.1123 - lr: 0.0010
Epoch 7/10
313/313 [==============================] - ETA: 0s - loss: 0.7656 - dice_coef: 0.2344 - recall_1: 0.4761 - precision_1: 0.1901Epoch 7 - Loss: 0.7656 - Accuracy: 0.2344 - Validation Loss: 0.8806 - Validation Accuracy: 0.1194
313/313 [==============================] - 107s 340ms/step - loss: 0.7656 - dice_coef: 0.2344 - recall_1: 0.4761 - precision_1: 0.1901 - val_loss: 0.8806 - val_dice_coef: 0.1194 - val_recall_1: 0.6707 - val_precision_1: 0.1000 - lr: 0.0010
Epoch 8/10
313/313 [==============================] - ETA: 0s - loss: 0.7713 - dice_coef: 0.2287 - recall_1: 0.5099 - precision_1: 0.1811Epoch 8 - Loss: 0.7713 - Accuracy: 0.2287 - Validation Loss: 0.8709 - Validation Accuracy: 0.1291
313/313 [==============================] - 143s 455ms/step - loss: 0.7713 - dice_coef: 0.2287 - recall_1: 0.5099 - precision_1: 0.1811 - val_loss: 0.8709 - val_dice_coef: 0.1291 - val_recall_1: 0.5274 - val_precision_1: 0.1597 - lr: 0.0010
Epoch 9/10
313/313 [==============================] - ETA: 0s - loss: 0.7593 - dice_coef: 0.2407 - recall_1: 0.4590 - precision_1: 0.2049Epoch 9 - Loss: 0.7593 - Accuracy: 0.2407 - Validation Loss: 0.8753 - Validation Accuracy: 0.1247
313/313 [==============================] - 106s 339ms/step - loss: 0.7593 - dice_coef: 0.2407 - recall_1: 0.4590 - precision_1: 0.2049 - val_loss: 0.8753 - val_dice_coef: 0.1247 - val_recall_1: 0.5414 - val_precision_1: 0.1243 - lr: 0.0010
Epoch 10/10
313/313 [==============================] - ETA: 0s - loss: 0.7568 - dice_coef: 0.2432 - recall_1: 0.4754 - precision_1: 0.2055Epoch 10 - Loss: 0.7568 - Accuracy: 0.2432 - Validation Loss: 0.8681 - Validation Accuracy: 0.1319
313/313 [==============================] - 107s 341ms/step - loss: 0.7568 - dice_coef: 0.2432 - recall_1: 0.4754 - precision_1: 0.2055 - val_loss: 0.8681 - val_dice_coef: 0.1319 - val_recall_1: 0.6183 - val_precision_1: 0.1283 - lr: 1.0000e-04
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="315"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T14:24:25.932184Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T14:24:25.931766Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T14:24:26.440287Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T14:24:26.439349Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T14:24:25.932151Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb207"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="co">## PLot Matrix between training and validation data</span></span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb207-4"><a href="#cb207-4" aria-hidden="true" tabindex="-1"></a>plt.plot(history_Unet.history[<span class="st">&#39;dice_coef&#39;</span>],     label<span class="op">=</span><span class="st">&#39;Train Dice-Coef&#39;</span>,      color <span class="op">=</span> <span class="st">&quot;green&quot;</span> )<span class="op">;</span></span>
<span id="cb207-5"><a href="#cb207-5" aria-hidden="true" tabindex="-1"></a>plt.plot(history_Unet.history[<span class="st">&#39;val_dice_coef&#39;</span>], label<span class="op">=</span><span class="st">&#39;Val Dice-Coef&#39;</span>,  color <span class="op">=</span> <span class="st">&quot;yellow&quot;</span>)<span class="op">;</span></span>
<span id="cb207-6"><a href="#cb207-6" aria-hidden="true" tabindex="-1"></a>plt.plot(history_Unet.history[<span class="st">&#39;loss&#39;</span>],         label<span class="op">=</span><span class="st">&#39;Train Loss&#39;</span>,          color <span class="op">=</span> <span class="st">&quot;red&quot;</span>   )<span class="op">;</span></span>
<span id="cb207-7"><a href="#cb207-7" aria-hidden="true" tabindex="-1"></a>plt.plot(history_Unet.history[<span class="st">&#39;val_loss&#39;</span>],     label<span class="op">=</span><span class="st">&#39;Val Loss&#39;</span>,      color <span class="op">=</span> <span class="st">&quot;orange&quot;</span>)<span class="op">;</span></span>
<span id="cb207-8"><a href="#cb207-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Validation and Training - Loss and Dice Coefficient vs Epoch&quot;</span>)</span>
<span id="cb207-9"><a href="#cb207-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Epoch&quot;</span>)</span>
<span id="cb207-10"><a href="#cb207-10" aria-hidden="true" tabindex="-1"></a>plt.legend()<span class="op">;</span></span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/122fd2c056e47c0abd66493c6bf0f269e73a2f02.png" /></p>
</div>
</div>
<div class="cell markdown">
<h4
id="val_dice-oefficient-value-is-very-low-and-pretty-much-a-flat-curve-indicating-underfitting-indicating-model-has-not-learnt-sufficiently-it-has-no-sufficient-trainingmore-epochs-needed">val_dice-oefficient
value is very low and pretty much a flat curve, indicating underfitting
indicating model has not learnt sufficiently. It has no sufficient
training(more epochs needed).</h4>
<h4
id="we-have-used-an-image-size-of-224x224-as-against-the-original-size-of-1024x1024-using-a-higher-resolution-could-also-improve-training-capacity">We
have used an image size of 224x224 as against the original size of
1024x1024. Using a higher resolution, could also improve training
capacity</h4>
<h4
id="hyper-parameter-tuning-image_augmentation-using-different-architectures-will-help-in-increasing-model-performance-and-generalization">Hyper-parameter
tuning, image_augmentation, using different architectures will help in
increasing model performance and generalization.</h4>
</div>
<div class="cell code" data-execution_count="316"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T14:24:29.436044Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T14:24:29.434855Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T14:24:29.442481Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T14:24:29.441323Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T14:24:29.436002Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb208"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="co">##Preparing test data , picked up random 20 images</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a>test_CombinedData <span class="op">=</span> labels[<span class="dv">15000</span>:<span class="dv">15020</span>]</span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a>test_CombinedData.fillna(<span class="dv">0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="317"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T14:24:30.639743Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T14:24:30.639331Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T14:24:30.648468Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T14:24:30.647477Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T14:24:30.639710Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb209"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Check target distrubution in test dataset, there are both the classes available with equal sdistrubution</span></span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a>test_CombinedData.Target.value_counts()</span></code></pre></div>
<div class="output execute_result" data-execution_count="317">
<pre><code>0    10
1    10
Name: Target, dtype: int64</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="318"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T14:24:31.524945Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T14:24:31.524530Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T14:24:31.533659Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T14:24:31.532466Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T14:24:31.524909Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb211"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Setting the custom generator for test data</span></span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a>testUNetDataGen <span class="op">=</span> TrainGenerator(test_CombinedData)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="319"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T14:24:32.483686Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T14:24:32.482362Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T14:24:33.967595Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T14:24:33.966457Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T14:24:32.483643Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb212"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="co">## evaluating the model</span></span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a>test_steps <span class="op">=</span> (<span class="bu">len</span>(testUNetDataGen)<span class="op">//</span>BATCH_SIZE)</span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(testUNetDataGen) <span class="op">%</span> BATCH_SIZE <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="cb212-4"><a href="#cb212-4" aria-hidden="true" tabindex="-1"></a>    test_steps <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb212-5"><a href="#cb212-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-6"><a href="#cb212-6" aria-hidden="true" tabindex="-1"></a>model_Unet.evaluate(testUNetDataGen)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>5/5 [==============================] - 1s 155ms/step - loss: 0.6369 - dice_coef: 0.3631 - recall_1: 0.5143 - precision_1: 0.3300
</code></pre>
</div>
<div class="output execute_result" data-execution_count="319">
<pre><code>[0.6369339823722839,
 0.36306601762771606,
 0.5143372416496277,
 0.32997262477874756]</code></pre>
</div>
</div>
<section
id="model-evaluation--dice-coef--37--recall-is-less-at-57--precission-is-very-low--of-about-32"
class="cell markdown">
<h4>Model evaluation , dice coef = 37% , recall is less at 57% ,
precission is very low , of about 32%</h4>
</section>
<div class="cell code" data-execution_count="320"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T14:24:35.544251Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T14:24:35.543874Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T14:24:36.589017Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T14:24:36.588032Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T14:24:35.544217Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb215"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Precidt the test data that we have</span></span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a>pred_mask <span class="op">=</span> model_Unet.predict(testUNetDataGen)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>5/5 [==============================] - 1s 153ms/step
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="321"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T14:24:36.681947Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T14:24:36.681631Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T14:24:36.688076Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T14:24:36.687067Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T14:24:36.681917Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb217"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a>test_CombinedData <span class="op">=</span> test_CombinedData.reset_index()</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="322"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T14:24:38.119508Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T14:24:38.118770Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T14:24:38.136168Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T14:24:38.135048Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T14:24:38.119472Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb218"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix</span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> []</span>
<span id="cb218-3"><a href="#cb218-3" aria-hidden="true" tabindex="-1"></a>y_True <span class="op">=</span> []</span>
<span id="cb218-4"><a href="#cb218-4" aria-hidden="true" tabindex="-1"></a>imageList <span class="op">=</span> []</span>
<span id="cb218-5"><a href="#cb218-5" aria-hidden="true" tabindex="-1"></a>predMaskTemp <span class="op">=</span> []</span>
<span id="cb218-6"><a href="#cb218-6" aria-hidden="true" tabindex="-1"></a>IMAGE_HEIGHT <span class="op">=</span> <span class="dv">224</span></span>
<span id="cb218-7"><a href="#cb218-7" aria-hidden="true" tabindex="-1"></a>IMAGE_WIDTH <span class="op">=</span> <span class="dv">224</span></span>
<span id="cb218-8"><a href="#cb218-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> getPredictions(test_CombinedData):</span>
<span id="cb218-9"><a href="#cb218-9" aria-hidden="true" tabindex="-1"></a>    masks <span class="op">=</span> np.zeros((<span class="bu">int</span>(test_CombinedData.shape[<span class="dv">0</span>]), IMAGE_HEIGHT, IMAGE_WIDTH))</span>
<span id="cb218-10"><a href="#cb218-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> index, row <span class="kw">in</span> test_CombinedData.iterrows():</span>
<span id="cb218-11"><a href="#cb218-11" aria-hidden="true" tabindex="-1"></a>        patientId <span class="op">=</span> row.patientId</span>
<span id="cb218-12"><a href="#cb218-12" aria-hidden="true" tabindex="-1"></a><span class="co">#         print(patientId)</span></span>
<span id="cb218-13"><a href="#cb218-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-14"><a href="#cb218-14" aria-hidden="true" tabindex="-1"></a>        classlabel <span class="op">=</span> row[<span class="st">&quot;Target&quot;</span>]</span>
<span id="cb218-15"><a href="#cb218-15" aria-hidden="true" tabindex="-1"></a>        dcm_file <span class="op">=</span> <span class="st">&#39;/kaggle/input/pneumonia-detection/stage_2_train_images/stage_2_train_images/&#39;</span><span class="op">+</span><span class="st">&#39;</span><span class="sc">{}</span><span class="st">.dcm&#39;</span>.<span class="bu">format</span>(patientId)</span>
<span id="cb218-16"><a href="#cb218-16" aria-hidden="true" tabindex="-1"></a>        dcm_data <span class="op">=</span> pydicom.dcmread(dcm_file)</span>
<span id="cb218-17"><a href="#cb218-17" aria-hidden="true" tabindex="-1"></a>        img <span class="op">=</span> dcm_data.pixel_array</span>
<span id="cb218-18"><a href="#cb218-18" aria-hidden="true" tabindex="-1"></a>        resized_img <span class="op">=</span> cv2.resize(img,(IMAGE_HEIGHT,IMAGE_WIDTH), interpolation <span class="op">=</span> cv2.INTER_LINEAR)</span>
<span id="cb218-19"><a href="#cb218-19" aria-hidden="true" tabindex="-1"></a>        predMaskTemp.append(pred_mask[index])</span>
<span id="cb218-20"><a href="#cb218-20" aria-hidden="true" tabindex="-1"></a>        iou <span class="op">=</span> (pred_mask[index] <span class="op">&gt;</span> <span class="fl">0.5</span>) <span class="op">*</span> <span class="fl">1.0</span></span>
<span id="cb218-21"><a href="#cb218-21" aria-hidden="true" tabindex="-1"></a>        y_pred.append((<span class="dv">1</span> <span class="kw">in</span> iou) <span class="op">*</span> <span class="dv">1</span>)</span>
<span id="cb218-22"><a href="#cb218-22" aria-hidden="true" tabindex="-1"></a>        imageList.append(resized_img)</span>
<span id="cb218-23"><a href="#cb218-23" aria-hidden="true" tabindex="-1"></a>        y_True.append(classlabel)</span>
<span id="cb218-24"><a href="#cb218-24" aria-hidden="true" tabindex="-1"></a>        x_scale <span class="op">=</span> IMAGE_HEIGHT <span class="op">/</span> <span class="dv">1024</span></span>
<span id="cb218-25"><a href="#cb218-25" aria-hidden="true" tabindex="-1"></a>        y_scale <span class="op">=</span> IMAGE_WIDTH <span class="op">/</span> <span class="dv">1024</span></span>
<span id="cb218-26"><a href="#cb218-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-27"><a href="#cb218-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(classlabel <span class="op">==</span> <span class="dv">1</span>):</span>
<span id="cb218-28"><a href="#cb218-28" aria-hidden="true" tabindex="-1"></a>            x <span class="op">=</span> <span class="bu">int</span>(np.<span class="bu">round</span>(row[<span class="st">&#39;x&#39;</span>] <span class="op">*</span> x_scale))</span>
<span id="cb218-29"><a href="#cb218-29" aria-hidden="true" tabindex="-1"></a>            y <span class="op">=</span> <span class="bu">int</span>(np.<span class="bu">round</span>(row[<span class="st">&#39;y&#39;</span>] <span class="op">*</span> y_scale))</span>
<span id="cb218-30"><a href="#cb218-30" aria-hidden="true" tabindex="-1"></a>            w <span class="op">=</span> <span class="bu">int</span>(np.<span class="bu">round</span>(row[<span class="st">&#39;width&#39;</span>] <span class="op">*</span> x_scale))</span>
<span id="cb218-31"><a href="#cb218-31" aria-hidden="true" tabindex="-1"></a>            h <span class="op">=</span> <span class="bu">int</span>(np.<span class="bu">round</span>(row[<span class="st">&#39;height&#39;</span>] <span class="op">*</span> y_scale))</span>
<span id="cb218-32"><a href="#cb218-32" aria-hidden="true" tabindex="-1"></a>            masks[index][y:y<span class="op">+</span>h, x:x<span class="op">+</span>w] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb218-33"><a href="#cb218-33" aria-hidden="true" tabindex="-1"></a>    tmpImages <span class="op">=</span> np.array(imageList)</span>
<span id="cb218-34"><a href="#cb218-34" aria-hidden="true" tabindex="-1"></a>    tmpMask <span class="op">=</span> np.array(predMaskTemp)</span>
<span id="cb218-35"><a href="#cb218-35" aria-hidden="true" tabindex="-1"></a>    originalMask <span class="op">=</span> np.array(masks)</span>
<span id="cb218-36"><a href="#cb218-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (y_True,y_pred,tmpImages,tmpMask ,originalMask)</span>
<span id="cb218-37"><a href="#cb218-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb218-38"><a href="#cb218-38" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_confusion_matrix(y_true, y_pred):</span>
<span id="cb218-39"><a href="#cb218-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">&#39;&#39;&#39;Function to print confusion_matrix&#39;&#39;&#39;</span></span>
<span id="cb218-40"><a href="#cb218-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get confusion matrix array</span></span>
<span id="cb218-41"><a href="#cb218-41" aria-hidden="true" tabindex="-1"></a>    array <span class="op">=</span> confusion_matrix(y_true, y_pred)    </span>
<span id="cb218-42"><a href="#cb218-42" aria-hidden="true" tabindex="-1"></a>    df_cm <span class="op">=</span> pd.DataFrame(array, <span class="bu">range</span>(<span class="dv">2</span>), <span class="bu">range</span>(<span class="dv">2</span>))</span>
<span id="cb218-43"><a href="#cb218-43" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Total samples = &quot;</span>, <span class="bu">len</span>(test_CombinedData))</span>
<span id="cb218-44"><a href="#cb218-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot heatmap and get sns heatmap values</span></span>
<span id="cb218-45"><a href="#cb218-45" aria-hidden="true" tabindex="-1"></a>    sns.<span class="bu">set</span>(font_scale<span class="op">=</span><span class="fl">1.4</span>)<span class="op">;</span> <span class="co"># for label size</span></span>
<span id="cb218-46"><a href="#cb218-46" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> sns.heatmap(df_cm, annot<span class="op">=</span><span class="va">True</span>, annot_kws<span class="op">=</span>{<span class="st">&quot;size&quot;</span>: <span class="dv">16</span>}, fmt<span class="op">=</span><span class="st">&#39;g&#39;</span>, cbar<span class="op">=</span><span class="va">False</span>)<span class="op">;</span> </span>
<span id="cb218-47"><a href="#cb218-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add labels to heatmap</span></span>
<span id="cb218-48"><a href="#cb218-48" aria-hidden="true" tabindex="-1"></a>    labels <span class="op">=</span> [<span class="st">&#39;TN=&#39;</span>,<span class="st">&#39;FP=&#39;</span>,<span class="st">&#39;FN=&#39;</span>,<span class="st">&#39;TP=&#39;</span>]</span>
<span id="cb218-49"><a href="#cb218-49" aria-hidden="true" tabindex="-1"></a>    i<span class="op">=</span><span class="dv">0</span></span>
<span id="cb218-50"><a href="#cb218-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> result.texts:</span>
<span id="cb218-51"><a href="#cb218-51" aria-hidden="true" tabindex="-1"></a>        t.set_text(labels[i] <span class="op">+</span> t.get_text())</span>
<span id="cb218-52"><a href="#cb218-52" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb218-53"><a href="#cb218-53" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">&quot;Predicted Values&quot;</span>)</span>
<span id="cb218-54"><a href="#cb218-54" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">&#39;True Values&#39;</span>)</span>
<span id="cb218-55"><a href="#cb218-55" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb218-56"><a href="#cb218-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span></span></code></pre></div>
</div>
<div class="cell code" data-execution_count="323"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T14:24:39.194615Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T14:24:39.193709Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T14:24:39.343702Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T14:24:39.342635Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T14:24:39.194571Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb219"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Create predictions map</span></span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a>y_true,y_pred ,imagelist , maskList , originalMask <span class="op">=</span> getPredictions(test_CombinedData)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="324"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T14:24:40.628697Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T14:24:40.627871Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T14:24:41.176207Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T14:24:41.175199Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T14:24:40.628650Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb220"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a>plt.imshow(imagelist[<span class="dv">12</span>])<span class="op">;</span></span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/9ad72b5520193d0f0805a49011abdbfa6e1cd010.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="325"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T14:24:42.850633Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T14:24:42.849849Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T14:24:46.362790Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T14:24:46.361604Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T14:24:42.850597Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb221"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Visualising the train and output data </span></span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-3"><a href="#cb221-3" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">15</span>))</span>
<span id="cb221-4"><a href="#cb221-4" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> fig.add_subplot(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">1</span>)</span>
<span id="cb221-5"><a href="#cb221-5" aria-hidden="true" tabindex="-1"></a>imgplot <span class="op">=</span> plt.imshow(imagelist[<span class="dv">1</span>])</span>
<span id="cb221-6"><a href="#cb221-6" aria-hidden="true" tabindex="-1"></a>a.set_title(<span class="st">&#39;Original Images &#39;</span>,fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb221-7"><a href="#cb221-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-8"><a href="#cb221-8" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> fig.add_subplot(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">2</span>)</span>
<span id="cb221-9"><a href="#cb221-9" aria-hidden="true" tabindex="-1"></a>imgplot <span class="op">=</span> plt.imshow(imagelist[<span class="dv">12</span>])</span>
<span id="cb221-10"><a href="#cb221-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-11"><a href="#cb221-11" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> fig.add_subplot(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">3</span>)</span>
<span id="cb221-12"><a href="#cb221-12" aria-hidden="true" tabindex="-1"></a>imgplot <span class="op">=</span> plt.imshow(imagelist[<span class="dv">13</span>])</span>
<span id="cb221-13"><a href="#cb221-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-14"><a href="#cb221-14" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> fig.add_subplot(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">4</span>)</span>
<span id="cb221-15"><a href="#cb221-15" aria-hidden="true" tabindex="-1"></a>imgplot <span class="op">=</span> plt.imshow(imagelist[<span class="dv">15</span>])</span>
<span id="cb221-16"><a href="#cb221-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-17"><a href="#cb221-17" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">15</span>))</span>
<span id="cb221-18"><a href="#cb221-18" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> fig.add_subplot(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">1</span>)</span>
<span id="cb221-19"><a href="#cb221-19" aria-hidden="true" tabindex="-1"></a>imgplot <span class="op">=</span> plt.imshow(originalMask[<span class="dv">1</span>])</span>
<span id="cb221-20"><a href="#cb221-20" aria-hidden="true" tabindex="-1"></a>a.set_title(<span class="st">&#39;Oringial Mask (Truth) &#39;</span>,fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb221-21"><a href="#cb221-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-22"><a href="#cb221-22" aria-hidden="true" tabindex="-1"></a>a.set_xlabel(<span class="st">&#39;Pneumonia </span><span class="sc">{}</span><span class="st">:&#39;</span>.<span class="bu">format</span>(y_true[<span class="dv">1</span>]), fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb221-23"><a href="#cb221-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-24"><a href="#cb221-24" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> fig.add_subplot(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">2</span>)</span>
<span id="cb221-25"><a href="#cb221-25" aria-hidden="true" tabindex="-1"></a>imgplot <span class="op">=</span> plt.imshow(originalMask[<span class="dv">12</span>])</span>
<span id="cb221-26"><a href="#cb221-26" aria-hidden="true" tabindex="-1"></a>a.set_xlabel(<span class="st">&#39;Pneumonia </span><span class="sc">{}</span><span class="st">:&#39;</span>.<span class="bu">format</span>(y_true[<span class="dv">12</span>]), fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb221-27"><a href="#cb221-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-28"><a href="#cb221-28" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> fig.add_subplot(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">3</span>)</span>
<span id="cb221-29"><a href="#cb221-29" aria-hidden="true" tabindex="-1"></a>imgplot <span class="op">=</span> plt.imshow(originalMask[<span class="dv">13</span>])</span>
<span id="cb221-30"><a href="#cb221-30" aria-hidden="true" tabindex="-1"></a>a.set_xlabel(<span class="st">&#39;Pneumonia </span><span class="sc">{}</span><span class="st">:&#39;</span>.<span class="bu">format</span>(y_true[<span class="dv">13</span>]), fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb221-31"><a href="#cb221-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-32"><a href="#cb221-32" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> fig.add_subplot(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">4</span>)</span>
<span id="cb221-33"><a href="#cb221-33" aria-hidden="true" tabindex="-1"></a>imgplot <span class="op">=</span> plt.imshow(originalMask[<span class="dv">15</span>])</span>
<span id="cb221-34"><a href="#cb221-34" aria-hidden="true" tabindex="-1"></a>a.set_xlabel(<span class="st">&#39;Pneumonia </span><span class="sc">{}</span><span class="st">:&#39;</span>.<span class="bu">format</span>(y_true[<span class="dv">15</span>]), fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb221-35"><a href="#cb221-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-36"><a href="#cb221-36" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">15</span>))</span>
<span id="cb221-37"><a href="#cb221-37" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> fig.add_subplot(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">1</span>)</span>
<span id="cb221-38"><a href="#cb221-38" aria-hidden="true" tabindex="-1"></a>a.set_title(<span class="st">&#39;Predicted Mask  &#39;</span>,fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb221-39"><a href="#cb221-39" aria-hidden="true" tabindex="-1"></a>imgplot <span class="op">=</span> plt.imshow(maskList[<span class="dv">1</span>])</span>
<span id="cb221-40"><a href="#cb221-40" aria-hidden="true" tabindex="-1"></a>a.set_xlabel(<span class="st">&#39;Pneumonia </span><span class="sc">{}</span><span class="st">:&#39;</span>.<span class="bu">format</span>(y_pred[<span class="dv">1</span>]), fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb221-41"><a href="#cb221-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-42"><a href="#cb221-42" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> fig.add_subplot(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">2</span>)</span>
<span id="cb221-43"><a href="#cb221-43" aria-hidden="true" tabindex="-1"></a>imgplot <span class="op">=</span> plt.imshow(maskList[<span class="dv">12</span>])</span>
<span id="cb221-44"><a href="#cb221-44" aria-hidden="true" tabindex="-1"></a>a.set_xlabel(<span class="st">&#39;Pneumonia </span><span class="sc">{}</span><span class="st">:&#39;</span>.<span class="bu">format</span>(y_pred[<span class="dv">12</span>]), fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb221-45"><a href="#cb221-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-46"><a href="#cb221-46" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> fig.add_subplot(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">3</span>)</span>
<span id="cb221-47"><a href="#cb221-47" aria-hidden="true" tabindex="-1"></a>imgplot <span class="op">=</span> plt.imshow(maskList[<span class="dv">13</span>])</span>
<span id="cb221-48"><a href="#cb221-48" aria-hidden="true" tabindex="-1"></a>a.set_xlabel(<span class="st">&#39;Pneumonia </span><span class="sc">{}</span><span class="st">:&#39;</span>.<span class="bu">format</span>(y_pred[<span class="dv">13</span>]), fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb221-49"><a href="#cb221-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-50"><a href="#cb221-50" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> fig.add_subplot(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">4</span>)</span>
<span id="cb221-51"><a href="#cb221-51" aria-hidden="true" tabindex="-1"></a>imgplot <span class="op">=</span> plt.imshow(maskList[<span class="dv">15</span>])</span>
<span id="cb221-52"><a href="#cb221-52" aria-hidden="true" tabindex="-1"></a>a.set_xlabel(<span class="st">&#39;Pneumonia </span><span class="sc">{}</span><span class="st">:&#39;</span>.<span class="bu">format</span>(y_pred[<span class="dv">15</span>]), fontsize<span class="op">=</span><span class="dv">20</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="325">
<pre><code>Text(0.5, 0, &#39;Pneumonia 1:&#39;)</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/127e13f19bfb1c5412ae1add6bae4eba24a77763.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/f1fb331a8b1dab684125535b65c5ae22b99b5bec.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/2afd5afdab5f6a6d96085cfdbe8554e56e8c3420.png" /></p>
</div>
</div>
<div class="cell markdown">
<h4 id="we-could-see-that-the-first-one-is-mis-classifed">we could see
that the first one is mis-classifed</h4>
<h4 id="second-one-is-classified-correctly--there-are-no-masks">Second
one is classified correctly , there are no masks</h4>
<h4
id="thrid-is-predcited-correctly-and-the-bounding-box-is-also-almost-at-the-same-position">Thrid
is predcited correctly and the bounding box is also almost at the same
position</h4>
<h4
id="fourth-is-predicted-correctly-but-there-are-two-boudning-boxes-this-culd-be-because-there-are-duplicate-patient-id-and-we-are-picking-only-one-mask-to-display-inte-truth">fourth
is predicted correctly but there are two boudning boxes, this culd be
because there are duplicate patient id and we are picking only one mask
to display inte Truth</h4>
</div>
<div class="cell code" data-execution_count="326"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T14:24:46.365416Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T14:24:46.365007Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T14:24:46.718848Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T14:24:46.717772Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T14:24:46.365355Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb223"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_classification_report_heatmap(y_true, y_pred):</span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the classification report as a dictionary</span></span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a>    report_dict <span class="op">=</span> classification_report(y_true, y_pred, output_dict<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb223-4"><a href="#cb223-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-5"><a href="#cb223-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert the dictionary to a DataFrame</span></span>
<span id="cb223-6"><a href="#cb223-6" aria-hidden="true" tabindex="-1"></a>    report_df <span class="op">=</span> pd.DataFrame(report_dict).transpose()</span>
<span id="cb223-7"><a href="#cb223-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-8"><a href="#cb223-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot the heatmap using seaborn</span></span>
<span id="cb223-9"><a href="#cb223-9" aria-hidden="true" tabindex="-1"></a>    sns.<span class="bu">set</span>(font_scale<span class="op">=</span><span class="fl">1.4</span>)  <span class="co"># for label size</span></span>
<span id="cb223-10"><a href="#cb223-10" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">5</span>))</span>
<span id="cb223-11"><a href="#cb223-11" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> sns.heatmap(report_df, annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">&quot;YlGnBu&quot;</span>, fmt<span class="op">=</span><span class="st">&#39;.2f&#39;</span>, cbar<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb223-12"><a href="#cb223-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-13"><a href="#cb223-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add labels to the heatmap</span></span>
<span id="cb223-14"><a href="#cb223-14" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">&quot;Metrics&quot;</span>)</span>
<span id="cb223-15"><a href="#cb223-15" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">&#39;Classes&#39;</span>)</span>
<span id="cb223-16"><a href="#cb223-16" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">&quot;Classification Report Heatmap&quot;</span>)</span>
<span id="cb223-17"><a href="#cb223-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-18"><a href="#cb223-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Show the plot</span></span>
<span id="cb223-19"><a href="#cb223-19" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb223-20"><a href="#cb223-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-21"><a href="#cb223-21" aria-hidden="true" tabindex="-1"></a>print_classification_report_heatmap(y_true, y_pred)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_bc7a190689c7418989cd4a3c283b31c5/7a7110a0c9ed0e9348b9762617199e32b3033f95.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="327"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T14:24:46.969637Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T14:24:46.969261Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T14:24:47.603517Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T14:24:47.602449Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T14:24:46.969604Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb224"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a><span class="co"># DDirectory path to save the model</span></span>
<span id="cb224-4"><a href="#cb224-4" aria-hidden="true" tabindex="-1"></a>save_dir <span class="op">=</span> <span class="st">&quot;/kaggle/working/Models/&quot;</span></span>
<span id="cb224-5"><a href="#cb224-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-6"><a href="#cb224-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the directory if it doesn&#39;t exist</span></span>
<span id="cb224-7"><a href="#cb224-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb224-8"><a href="#cb224-8" aria-hidden="true" tabindex="-1"></a>os.makedirs(save_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb224-9"><a href="#cb224-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-10"><a href="#cb224-10" aria-hidden="true" tabindex="-1"></a><span class="co">## Save the model to the directory</span></span>
<span id="cb224-11"><a href="#cb224-11" aria-hidden="true" tabindex="-1"></a>model_path <span class="op">=</span> os.path.join(save_dir, <span class="st">&quot;model_Unet.pkl&quot;</span>)</span>
<span id="cb224-12"><a href="#cb224-12" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(model_path, <span class="st">&quot;wb&quot;</span>) <span class="im">as</span> f:</span>
<span id="cb224-13"><a href="#cb224-13" aria-hidden="true" tabindex="-1"></a>    pickle.dump(model_Unet, f)</span>
<span id="cb224-14"><a href="#cb224-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-15"><a href="#cb224-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Model saved to </span><span class="sc">{</span>model_path<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Model saved to /kaggle/working/Models/model_Unet.pkl
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="328"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-08-06T14:24:47.902720Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-08-06T14:24:47.901297Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-08-06T14:24:47.911439Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-08-06T14:24:47.910369Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2023-08-06T14:24:47.902676Z&quot;}"
data-trusted="true">
<div class="sourceCode" id="cb226"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a DataFrame to hold the submission data</span></span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a>submission_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb226-3"><a href="#cb226-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;patientId&#39;</span>: test_CombinedData[<span class="st">&#39;patientId&#39;</span>],</span>
<span id="cb226-4"><a href="#cb226-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Prediction&#39;</span>: y_pred</span>
<span id="cb226-5"><a href="#cb226-5" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb226-6"><a href="#cb226-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-7"><a href="#cb226-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Export the DataFrame to a CSV file</span></span>
<span id="cb226-8"><a href="#cb226-8" aria-hidden="true" tabindex="-1"></a>submission_filename <span class="op">=</span> <span class="st">&#39;Unet_submisiion.csv&#39;</span></span>
<span id="cb226-9"><a href="#cb226-9" aria-hidden="true" tabindex="-1"></a>submission_df.to_csv(submission_filename, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb226-10"><a href="#cb226-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-11"><a href="#cb226-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&#39;CSV file &quot;</span><span class="sc">{</span>submission_filename<span class="sc">}</span><span class="ss">&quot; created.&#39;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>CSV file &quot;Unet_submisiion.csv&quot; created.
</code></pre>
</div>
</div>
<div class="cell code">
<div class="sourceCode" id="cb228"><pre
class="sourceCode python"><code class="sourceCode python"></code></pre></div>
</div>
<div class="cell code">
<div class="sourceCode" id="cb229"><pre
class="sourceCode python"><code class="sourceCode python"></code></pre></div>
</div>
</body>
</html>
